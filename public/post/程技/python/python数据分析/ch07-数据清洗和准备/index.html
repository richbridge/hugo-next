<!doctype html><html lang=zh-CN data-theme=dark><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.147.7"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="第七章 数据清洗和准备"><meta itemprop=description content="保持简单的易用性和强大的功能。"><meta name=description content="保持简单的易用性和强大的功能。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif"><meta itemprop=keywords content="python"><meta property="og:type" content="article"><meta property="og:title" content="第七章 数据清洗和准备"><meta property="og:description" content="保持简单的易用性和强大的功能。"><meta property="og:image" content="https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="//localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch07-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87/"><meta property="og:site_name" content="樊尘刹记"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rich"><meta property="article:published_time" content="2023-09-25 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2023-09-25 00:00:00 +0000 UTC"><link type=text/css rel=stylesheet href=//localhost:1313/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=//localhost:1313/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=//localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.css?=1750130938"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><link rel=stylesheet type=text/css href="/css/custom_style.css?=1750130938"><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>第七章 数据清洗和准备 - 樊尘刹记</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>樊尘刹记</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>红尘湮灭，唯有尘刹</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>629</span></a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>友链</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#71-处理缺失数据>7.1 处理缺失数据</a><ul><li><a href=#711-滤除缺失数据>7.1.1 滤除缺失数据</a></li><li><a href=#712-填充缺失数据>7.1.2 填充缺失数据</a></li></ul></li><li><a href=#72-数据转换>7.2 数据转换</a><ul><li><a href=#721-移除重复数据>7.2.1 移除重复数据</a></li><li><a href=#722-利用函数或映射进行数据转换>7.2.2 利用函数或映射进行数据转换</a></li><li><a href=#723-替换值>7.2.3 替换值</a></li><li><a href=#724-重命名轴索引>7.2.4 重命名轴索引</a></li><li><a href=#725-离散化和面元划分>7.2.5 离散化和面元划分</a></li><li><a href=#726-检测和过滤异常值>7.2.6 检测和过滤异常值</a></li><li><a href=#727-排列和随机采样>7.2.7 排列和随机采样</a></li><li><a href=#728-计算指标哑变量>7.2.8 计算指标/哑变量</a></li></ul></li><li><a href=#73-字符串操作>7.3 字符串操作</a><ul><li><a href=#731-字符串对象方法>7.3.1 字符串对象方法</a></li><li><a href=#732-正则表达式>7.3.2 正则表达式</a></li><li><a href=#733-pandas的矢量化字符串函数>7.3.3 pandas的矢量化字符串函数</a></li></ul></li><li><a href=#74-总结>7.4 总结</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rich src=/imgs/img-lazy-loading.gif data-src=https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif><p class=site-author-name itemprop=name>Rich</p><div class=site-description itemprop=description>保持简单的易用性和强大的功能。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>629</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>8</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>99</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/richbridge title="Github → https://github.com/richbridge" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/richfan-38 title="知乎 → https://www.zhihu.com/people/richfan-38" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div><div class="mydefined animated" itemprop=custom><span>支持自定义CSS和Sidebar布局啦💄💄💄</span></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="0001-01-01 00:00:00 +0000 UTC"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2702735></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5708></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-01-24 00:00:00 +0000 UTC"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-i18n-translate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/richbridge rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=//localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch07-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif"><meta itemprop=name content="Rich"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rich"><meta itemprop=description content="保持简单的易用性和强大的功能。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="第七章 数据清洗和准备"><meta itemprop=description content="在数据分析和建模的过程中，相当多的时间要用在数据准备上：加载、清理、转换以及重塑。这些工作会占到分析师时间的80%或更多。有时，存储在文件和数据库中的数据的格式不适合某个特定的任务。许多研究者都选择使用通用编程语言（如Python、Perl、R或Java）或UNIX文本处理工具（如sed或awk）对数据格式进行专门处理。幸运的是，pandas和内置的Python标准库提供了一组高级的、灵活的、快速的工具，可以让你轻松地将数据规整为想要的格式。"></span><header class=post-header><h1 class=post-title itemprop="name headline">第七章 数据清洗和准备</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023-09-25 00:00:00 +00:00" itemprop="dateCreated datePublished" datetime="2023-09-25 00:00:00 +0000 UTC">2023-09-25
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E7%A8%8B%E6%8A%80/ itemprop=url rel=index><span itemprop=name>程技</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>10340</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>21分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch07-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>在数据分析和建模的过程中，相当多的时间要用在数据准备上：加载、清理、转换以及重塑。这些工作会占到分析师时间的80%或更多。有时，存储在文件和数据库中的数据的格式不适合某个特定的任务。许多研究者都选择使用通用编程语言（如Python、Perl、R或Java）或UNIX文本处理工具（如sed或awk）对数据格式进行专门处理。幸运的是，pandas和内置的Python标准库提供了一组高级的、灵活的、快速的工具，可以让你轻松地将数据规整为想要的格式。</p><a id=more></a><p>实际上，pandas的许多设计和实现都是由真实应用的需求所驱动的。</p><p>在本章中，我会讨论处理缺失数据、重复数据、字符串操作和其它分析数据转换的工具。下一章，我会关注于用多种方法合并、重塑数据集。</p><h2 id=71-处理缺失数据>7.1 处理缺失数据
<a class=header-anchor href=#71-%e5%a4%84%e7%90%86%e7%bc%ba%e5%a4%b1%e6%95%b0%e6%8d%ae></a></h2><p>在许多数据分析工作中，<code>缺失数据</code>是经常发生的。pandas的目标之一就是尽量轻松地处理缺失数据。例如，pandas对象的所有描述性统计默认都不包括缺失数据。</p><p>缺失数据在pandas中呈现的方式有些不完美，但对于大多数用户可以保证功能正常。对于数值数据，pandas使用浮点值NaN（Not a Number）表示缺失数据。我们称其为<code>哨兵值</code>，可以方便的检测出来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>10</span><span class=p>]:</span> <span class=n>string_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=s1>&#39;aardvark&#39;</span><span class=p>,</span> <span class=s1>&#39;artichoke&#39;</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=s1>&#39;avocado&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>11</span><span class=p>]:</span> <span class=n>string_data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>11</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>aardvark</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>artichoke</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>          <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>      <span class=n>avocado</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>12</span><span class=p>]:</span> <span class=n>string_data</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>12</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>     <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>bool</span></span></span></code></pre></td></tr></table></div></div><p>在pandas中，我们采用了R语言中的惯用法，即将缺失值表示为NA，它表示不可用not available。在统计应用中，NA数据可能是不存在的数据或者虽然存在，但是没有观察到（例如，数据采集中发生了问题）。<strong>当进行数据清洗以进行分析时，最好直接对缺失数据进行分析，以判断数据采集的问题或缺失数据可能导致的偏差</strong>。</p><p>Python内置的None值在对象数组中也可以作为NA：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>13</span><span class=p>]:</span> <span class=n>string_data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>14</span><span class=p>]:</span> <span class=n>string_data</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>14</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>     <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>bool</span></span></span></code></pre></td></tr></table></div></div><p>pandas项目中还在不断优化内部细节以更好处理缺失数据，像用户API功能，例如pandas.isnull，去除了许多恼人的细节。表7-1列出了一些关于缺失数据处理的函数。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024095928724.png alt="表7-1 NA处理方法"></p><h3 id=711-滤除缺失数据>7.1.1 滤除缺失数据
<a class=header-anchor href=#711-%e6%bb%a4%e9%99%a4%e7%bc%ba%e5%a4%b1%e6%95%b0%e6%8d%ae></a></h3><p>过滤掉缺失数据的办法有很多种。你可以通过pandas.isnull或布尔索引的手工方法，但dropna可能会更实用一些。对于一个Series，dropna返回一个仅含非空数据和索引值的Series：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>15</span><span class=p>]:</span> <span class=kn>from</span> <span class=nn>numpy</span> <span class=kn>import</span> <span class=n>nan</span> <span class=k>as</span> <span class=n>NA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>16</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=n>NA</span><span class=p>,</span> <span class=mf>3.5</span><span class=p>,</span> <span class=n>NA</span><span class=p>,</span> <span class=mi>7</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>17</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>17</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=mf>3.5</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mf>7.0</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>这等价于：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5>5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>18</span><span class=p>]:</span> <span class=n>data</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>notnull</span><span class=p>()]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>18</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=mf>3.5</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mf>7.0</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>而对于DataFrame对象，事情就有点复杂了。你可能希望丢弃全NA或含有NA的行或列。dropna默认丢弃任何含有缺失值的行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>19</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>([[</span><span class=mf>1.</span><span class=p>,</span> <span class=mf>6.5</span><span class=p>,</span> <span class=mf>3.</span><span class=p>],</span> <span class=p>[</span><span class=mf>1.</span><span class=p>,</span> <span class=n>NA</span><span class=p>,</span> <span class=n>NA</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                      <span class=p>[</span><span class=n>NA</span><span class=p>,</span> <span class=n>NA</span><span class=p>,</span> <span class=n>NA</span><span class=p>],</span> <span class=p>[</span><span class=n>NA</span><span class=p>,</span> <span class=mf>6.5</span><span class=p>,</span> <span class=mf>3.</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>20</span><span class=p>]:</span> <span class=n>cleaned</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>21</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>21</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>     <span class=mi>0</span>    <span class=mi>1</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mf>1.0</span>  <span class=mf>6.5</span>  <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mf>1.0</span>  <span class=n>NaN</span>  <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=n>NaN</span>  <span class=n>NaN</span>  <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=n>NaN</span>  <span class=mf>6.5</span>  <span class=mf>3.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>22</span><span class=p>]:</span> <span class=n>cleaned</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>22</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>     <span class=mi>0</span>    <span class=mi>1</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mf>1.0</span>  <span class=mf>6.5</span>  <span class=mf>3.0</span></span></span></code></pre></td></tr></table></div></div><p>传入how=&lsquo;all&rsquo;将只丢弃全为NA的那些行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5>5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>23</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>dropna</span><span class=p>(</span><span class=n>how</span><span class=o>=</span><span class=s1>&#39;all&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>23</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>     <span class=mi>0</span>    <span class=mi>1</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mf>1.0</span>  <span class=mf>6.5</span>  <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mf>1.0</span>  <span class=n>NaN</span>  <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=n>NaN</span>  <span class=mf>6.5</span>  <span class=mf>3.0</span></span></span></code></pre></td></tr></table></div></div><p>用这种方式丢弃列，只需传入axis=1即可：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>24</span><span class=p>]:</span> <span class=n>data</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>NA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>25</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>25</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>     <span class=mi>0</span>    <span class=mi>1</span>    <span class=mi>2</span>   <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mf>1.0</span>  <span class=mf>6.5</span>  <span class=mf>3.0</span> <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mf>1.0</span>  <span class=n>NaN</span>  <span class=n>NaN</span> <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=n>NaN</span>  <span class=n>NaN</span>  <span class=n>NaN</span> <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=n>NaN</span>  <span class=mf>6.5</span>  <span class=mf>3.0</span> <span class=n>NaN</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>26</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>dropna</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>how</span><span class=o>=</span><span class=s1>&#39;all&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>26</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>     <span class=mi>0</span>    <span class=mi>1</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mf>1.0</span>  <span class=mf>6.5</span>  <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mf>1.0</span>  <span class=n>NaN</span>  <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=n>NaN</span>  <span class=n>NaN</span>  <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=n>NaN</span>  <span class=mf>6.5</span>  <span class=mf>3.0</span></span></span></code></pre></td></tr></table></div></div><p>另一个滤除DataFrame行的问题涉及时间序列数据。假设你只想留下一部分观测数据，可以用thresh参数实现此目的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27>27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28>28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29>29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30>30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31>31</a>
</span><span class=lnt id=hl-7-32><a class=lnlinks href=#hl-7-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>27</span><span class=p>]:</span> <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>7</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>28</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:</span><span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>NA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>29</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>NA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>30</span><span class=p>]:</span> <span class=n>df</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>30</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span> <span class=o>-</span><span class=mf>0.204708</span>       <span class=n>NaN</span>       <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=o>-</span><span class=mf>0.555730</span>       <span class=n>NaN</span>       <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>0.092908</span>       <span class=n>NaN</span>  <span class=mf>0.769023</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mf>1.246435</span>       <span class=n>NaN</span> <span class=o>-</span><span class=mf>1.296221</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mf>0.274992</span>  <span class=mf>0.228913</span>  <span class=mf>1.352917</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=mf>0.886429</span> <span class=o>-</span><span class=mf>2.001637</span> <span class=o>-</span><span class=mf>0.371843</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=mf>1.669025</span> <span class=o>-</span><span class=mf>0.438570</span> <span class=o>-</span><span class=mf>0.539741</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>31</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>31</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mf>0.274992</span>  <span class=mf>0.228913</span>  <span class=mf>1.352917</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=mf>0.886429</span> <span class=o>-</span><span class=mf>2.001637</span> <span class=o>-</span><span class=mf>0.371843</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=mf>1.669025</span> <span class=o>-</span><span class=mf>0.438570</span> <span class=o>-</span><span class=mf>0.539741</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>32</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>dropna</span><span class=p>(</span><span class=n>thresh</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>32</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>0.092908</span>       <span class=n>NaN</span>  <span class=mf>0.769023</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mf>1.246435</span>       <span class=n>NaN</span> <span class=o>-</span><span class=mf>1.296221</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mf>0.274992</span>  <span class=mf>0.228913</span>  <span class=mf>1.352917</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=mf>0.886429</span> <span class=o>-</span><span class=mf>2.001637</span> <span class=o>-</span><span class=mf>0.371843</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=mf>1.669025</span> <span class=o>-</span><span class=mf>0.438570</span> <span class=o>-</span><span class=mf>0.539741</span></span></span></code></pre></td></tr></table></div></div><h3 id=712-填充缺失数据>7.1.2 填充缺失数据
<a class=header-anchor href=#712-%e5%a1%ab%e5%85%85%e7%bc%ba%e5%a4%b1%e6%95%b0%e6%8d%ae></a></h3><p>你可能不想滤除缺失数据（有可能会丢弃跟它有关的其他数据），而是希望通过其他方式填补那些“空洞”。对于大多数情况而言，fillna方法是最主要的函数。通过一个常数调用fillna就会将缺失值替换为那个常数值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>33</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>33</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span> <span class=o>-</span><span class=mf>0.204708</span>  <span class=mf>0.000000</span>  <span class=mf>0.000000</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=o>-</span><span class=mf>0.555730</span>  <span class=mf>0.000000</span>  <span class=mf>0.000000</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>0.092908</span>  <span class=mf>0.000000</span>  <span class=mf>0.769023</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mf>1.246435</span>  <span class=mf>0.000000</span> <span class=o>-</span><span class=mf>1.296221</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mf>0.274992</span>  <span class=mf>0.228913</span>  <span class=mf>1.352917</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=mf>0.886429</span> <span class=o>-</span><span class=mf>2.001637</span> <span class=o>-</span><span class=mf>0.371843</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=mf>1.669025</span> <span class=o>-</span><span class=mf>0.438570</span> <span class=o>-</span><span class=mf>0.539741</span></span></span></code></pre></td></tr></table></div></div><p>若是通过一个字典调用fillna，就可以实现对不同的列填充不同的值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>34</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>fillna</span><span class=p>({</span><span class=mi>1</span><span class=p>:</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mi>2</span><span class=p>:</span> <span class=mi>0</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>34</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span> <span class=o>-</span><span class=mf>0.204708</span>  <span class=mf>0.500000</span>  <span class=mf>0.000000</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=o>-</span><span class=mf>0.555730</span>  <span class=mf>0.500000</span>  <span class=mf>0.000000</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>0.092908</span>  <span class=mf>0.500000</span>  <span class=mf>0.769023</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mf>1.246435</span>  <span class=mf>0.500000</span> <span class=o>-</span><span class=mf>1.296221</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mf>0.274992</span>  <span class=mf>0.228913</span>  <span class=mf>1.352917</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=mf>0.886429</span> <span class=o>-</span><span class=mf>2.001637</span> <span class=o>-</span><span class=mf>0.371843</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=mf>1.669025</span> <span class=o>-</span><span class=mf>0.438570</span> <span class=o>-</span><span class=mf>0.539741</span></span></span></code></pre></td></tr></table></div></div><p>fillna默认会返回新对象，但也可以对现有对象进行就地修改：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>35</span><span class=p>]:</span> <span class=n>_</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>36</span><span class=p>]:</span> <span class=n>df</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>36</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span> <span class=o>-</span><span class=mf>0.204708</span>  <span class=mf>0.000000</span>  <span class=mf>0.000000</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=o>-</span><span class=mf>0.555730</span>  <span class=mf>0.000000</span>  <span class=mf>0.000000</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>0.092908</span>  <span class=mf>0.000000</span>  <span class=mf>0.769023</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mf>1.246435</span>  <span class=mf>0.000000</span> <span class=o>-</span><span class=mf>1.296221</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mf>0.274992</span>  <span class=mf>0.228913</span>  <span class=mf>1.352917</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=mf>0.886429</span> <span class=o>-</span><span class=mf>2.001637</span> <span class=o>-</span><span class=mf>0.371843</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=mf>1.669025</span> <span class=o>-</span><span class=mf>0.438570</span> <span class=o>-</span><span class=mf>0.539741</span></span></span></code></pre></td></tr></table></div></div><p>对reindexing有效的那些插值方法也可用于fillna：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>37</span><span class=p>]:</span> <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>38</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>2</span><span class=p>:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>NA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>39</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>4</span><span class=p>:,</span> <span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>NA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>40</span><span class=p>]:</span> <span class=n>df</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>40</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mf>0.476985</span>  <span class=mf>3.248944</span> <span class=o>-</span><span class=mf>1.021228</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=o>-</span><span class=mf>0.577087</span>  <span class=mf>0.124121</span>  <span class=mf>0.302614</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>0.523772</span>       <span class=n>NaN</span>  <span class=mf>1.343810</span>
</span></span><span class=line><span class=cl><span class=mi>3</span> <span class=o>-</span><span class=mf>0.713544</span>       <span class=n>NaN</span> <span class=o>-</span><span class=mf>2.370232</span>
</span></span><span class=line><span class=cl><span class=mi>4</span> <span class=o>-</span><span class=mf>1.860761</span>       <span class=n>NaN</span>       <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>5</span> <span class=o>-</span><span class=mf>1.265934</span>       <span class=n>NaN</span>       <span class=n>NaN</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>41</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=s1>&#39;ffill&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>41</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mf>0.476985</span>  <span class=mf>3.248944</span> <span class=o>-</span><span class=mf>1.021228</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=o>-</span><span class=mf>0.577087</span>  <span class=mf>0.124121</span>  <span class=mf>0.302614</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>0.523772</span>  <span class=mf>0.124121</span>  <span class=mf>1.343810</span>
</span></span><span class=line><span class=cl><span class=mi>3</span> <span class=o>-</span><span class=mf>0.713544</span>  <span class=mf>0.124121</span> <span class=o>-</span><span class=mf>2.370232</span>
</span></span><span class=line><span class=cl><span class=mi>4</span> <span class=o>-</span><span class=mf>1.860761</span>  <span class=mf>0.124121</span> <span class=o>-</span><span class=mf>2.370232</span>
</span></span><span class=line><span class=cl><span class=mi>5</span> <span class=o>-</span><span class=mf>1.265934</span>  <span class=mf>0.124121</span> <span class=o>-</span><span class=mf>2.370232</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>42</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=s1>&#39;ffill&#39;</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>42</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mf>0.476985</span>  <span class=mf>3.248944</span> <span class=o>-</span><span class=mf>1.021228</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=o>-</span><span class=mf>0.577087</span>  <span class=mf>0.124121</span>  <span class=mf>0.302614</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>0.523772</span>  <span class=mf>0.124121</span>  <span class=mf>1.343810</span>
</span></span><span class=line><span class=cl><span class=mi>3</span> <span class=o>-</span><span class=mf>0.713544</span>  <span class=mf>0.124121</span> <span class=o>-</span><span class=mf>2.370232</span>
</span></span><span class=line><span class=cl><span class=mi>4</span> <span class=o>-</span><span class=mf>1.860761</span>       <span class=n>NaN</span> <span class=o>-</span><span class=mf>2.370232</span>
</span></span><span class=line><span class=cl><span class=mi>5</span> <span class=o>-</span><span class=mf>1.265934</span>       <span class=n>NaN</span> <span class=o>-</span><span class=mf>2.370232</span></span></span></code></pre></td></tr></table></div></div><p>只要有些创新，你就可以利用fillna实现许多别的功能。比如说，你可以传入Series的平均值或中位数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>43</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mf>1.</span><span class=p>,</span> <span class=n>NA</span><span class=p>,</span> <span class=mf>3.5</span><span class=p>,</span> <span class=n>NA</span><span class=p>,</span> <span class=mi>7</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>44</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>44</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mf>1.000000</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=mf>3.833333</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=mf>3.500000</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=mf>3.833333</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mf>7.000000</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>表7-2列出了fillna的参考。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024100735442.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024100741805.png alt=fillna函数参数></p><h2 id=72-数据转换>7.2 数据转换
<a class=header-anchor href=#72-%e6%95%b0%e6%8d%ae%e8%bd%ac%e6%8d%a2></a></h2><p>本章到目前为止介绍的都是数据的重排。另一类重要操作则是过滤、清理以及其他的转换工作。</p><h3 id=721-移除重复数据>7.2.1 移除重复数据
<a class=header-anchor href=#721-%e7%a7%bb%e9%99%a4%e9%87%8d%e5%a4%8d%e6%95%b0%e6%8d%ae></a></h3><p>DataFrame中出现重复行有多种原因。下面就是一个例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>45</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s1>&#39;k1&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;one&#39;</span><span class=p>,</span> <span class=s1>&#39;two&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>3</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;two&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                      <span class=s1>&#39;k2&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>46</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>46</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>    <span class=n>k1</span>  <span class=n>k2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=n>one</span>   <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=n>two</span>   <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=n>one</span>   <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=n>two</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=n>one</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=n>two</span>   <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=n>two</span>   <span class=mi>4</span></span></span></code></pre></td></tr></table></div></div><p>DataFrame的duplicated方法返回一个布尔型Series，表示各行是否是重复行（前面出现过的行）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>47</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>duplicated</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>47</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>bool</span></span></span></code></pre></td></tr></table></div></div><p>还有一个与此相关的drop_duplicates方法，它会返回一个DataFrame，重复的数组会标为False：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>48</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>48</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>    <span class=n>k1</span>  <span class=n>k2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=n>one</span>   <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=n>two</span>   <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=n>one</span>   <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=n>two</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=n>one</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=n>two</span>   <span class=mi>4</span></span></span></code></pre></td></tr></table></div></div><p>这两个方法默认会判断全部列，你也可以指定部分列进行重复项判断。假设我们还有一列值，且只希望根据k1列过滤重复项：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6>6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>49</span><span class=p>]:</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;v1&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>50</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>([</span><span class=s1>&#39;k1&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>50</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>    <span class=n>k1</span>  <span class=n>k2</span>  <span class=n>v1</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=n>one</span>   <span class=mi>1</span>   <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=n>two</span>   <span class=mi>1</span>   <span class=mi>1</span></span></span></code></pre></td></tr></table></div></div><p>duplicated和drop_duplicates默认保留的是第一个出现的值组合。传入keep=&lsquo;last&rsquo;则保留最后一个：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6>6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7>7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8>8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>51</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>([</span><span class=s1>&#39;k1&#39;</span><span class=p>,</span> <span class=s1>&#39;k2&#39;</span><span class=p>],</span> <span class=n>keep</span><span class=o>=</span><span class=s1>&#39;last&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>51</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>    <span class=n>k1</span>  <span class=n>k2</span>  <span class=n>v1</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=n>one</span>   <span class=mi>1</span>   <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=n>two</span>   <span class=mi>1</span>   <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=n>one</span>   <span class=mi>2</span>   <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=n>two</span>   <span class=mi>3</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=n>one</span>   <span class=mi>3</span>   <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=n>two</span>   <span class=mi>4</span>   <span class=mi>6</span></span></span></code></pre></td></tr></table></div></div><h3 id=722-利用函数或映射进行数据转换>7.2.2 利用函数或映射进行数据转换
<a class=header-anchor href=#722-%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e6%88%96%e6%98%a0%e5%b0%84%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bd%ac%e6%8d%a2></a></h3><p>对于许多数据集，你可能希望根据数组、Series或DataFrame列中的值来实现转换工作。我们来看看下面这组有关肉类的数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span><span class=lnt id=hl-18-17><a class=lnlinks href=#hl-18-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>52</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s1>&#39;food&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;bacon&#39;</span><span class=p>,</span> <span class=s1>&#39;pulled pork&#39;</span><span class=p>,</span> <span class=s1>&#39;bacon&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                               <span class=s1>&#39;Pastrami&#39;</span><span class=p>,</span> <span class=s1>&#39;corned beef&#39;</span><span class=p>,</span> <span class=s1>&#39;Bacon&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                               <span class=s1>&#39;pastrami&#39;</span><span class=p>,</span> <span class=s1>&#39;honey ham&#39;</span><span class=p>,</span> <span class=s1>&#39;nova lox&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                      <span class=s1>&#39;ounces&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mf>7.5</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>53</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>53</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=n>food</span>  <span class=n>ounces</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>        <span class=n>bacon</span>     <span class=mf>4.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=n>pulled</span> <span class=n>pork</span>     <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>        <span class=n>bacon</span>    <span class=mf>12.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>     <span class=n>Pastrami</span>     <span class=mf>6.0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=n>corned</span> <span class=n>beef</span>     <span class=mf>7.5</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>        <span class=n>Bacon</span>     <span class=mf>8.0</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=n>pastrami</span>     <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>    <span class=n>honey</span> <span class=n>ham</span>     <span class=mf>5.0</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=n>nova</span> <span class=n>lox</span>     <span class=mf>6.0</span></span></span></code></pre></td></tr></table></div></div><p>假设你想要添加一列表示该肉类食物来源的动物类型。我们先编写一个不同肉类到动物的映射：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6>6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7>7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>meat_to_animal</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;bacon&#39;</span><span class=p>:</span> <span class=s1>&#39;pig&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;pulled pork&#39;</span><span class=p>:</span> <span class=s1>&#39;pig&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;pastrami&#39;</span><span class=p>:</span> <span class=s1>&#39;cow&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;corned beef&#39;</span><span class=p>:</span> <span class=s1>&#39;cow&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;honey ham&#39;</span><span class=p>:</span> <span class=s1>&#39;pig&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;nova lox&#39;</span><span class=p>:</span> <span class=s1>&#39;salmon&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Series的map方法可以接受一个函数或含有映射关系的字典型对象，但是这里有一个小问题，即有些肉类的首字母大写了，而另一些则没有。因此，我们还需要使用Series的str.lower方法，将各个值转换为小写：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25>25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26>26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27>27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28>28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29>29</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>55</span><span class=p>]:</span> <span class=n>lowercased</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;food&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>56</span><span class=p>]:</span> <span class=n>lowercased</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>56</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>          <span class=n>bacon</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>pulled</span> <span class=n>pork</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>          <span class=n>bacon</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>       <span class=n>pastrami</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=n>corned</span> <span class=n>beef</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>          <span class=n>bacon</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>       <span class=n>pastrami</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>      <span class=n>honey</span> <span class=n>ham</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>       <span class=n>nova</span> <span class=n>lox</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>food</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>57</span><span class=p>]:</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;animal&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>lowercased</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>meat_to_animal</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>58</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>58</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>          <span class=n>food</span>  <span class=n>ounces</span>  <span class=n>animal</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>        <span class=n>bacon</span>     <span class=mf>4.0</span>     <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=n>pulled</span> <span class=n>pork</span>     <span class=mf>3.0</span>     <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>        <span class=n>bacon</span>    <span class=mf>12.0</span>     <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>     <span class=n>Pastrami</span>     <span class=mf>6.0</span>     <span class=n>cow</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=n>corned</span> <span class=n>beef</span>     <span class=mf>7.5</span>     <span class=n>cow</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>        <span class=n>Bacon</span>     <span class=mf>8.0</span>     <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=n>pastrami</span>     <span class=mf>3.0</span>     <span class=n>cow</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>    <span class=n>honey</span> <span class=n>ham</span>     <span class=mf>5.0</span>     <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=n>nova</span> <span class=n>lox</span>     <span class=mf>6.0</span>  <span class=n>salmon</span></span></span></code></pre></td></tr></table></div></div><p>我们也可以传入一个能够完成全部这些工作的函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>59</span><span class=p>]:</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;food&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>meat_to_animal</span><span class=p>[</span><span class=n>x</span><span class=o>.</span><span class=n>lower</span><span class=p>()])</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>59</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>       <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>       <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>       <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>       <span class=n>cow</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>       <span class=n>cow</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>       <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>       <span class=n>cow</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>       <span class=n>pig</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>    <span class=n>salmon</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>food</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span></span></span></code></pre></td></tr></table></div></div><p>使用map是一种实现元素级转换以及其他数据清理工作的便捷方式。</p><h3 id=723-替换值>7.2.3 替换值
<a class=header-anchor href=#723-%e6%9b%bf%e6%8d%a2%e5%80%bc></a></h3><p>利用fillna方法填充缺失数据可以看做值替换的一种特殊情况。前面已经看到，map可用于修改对象的数据子集，而replace则提供了一种实现该功能的更简单、更灵活的方式。我们来看看下面这个Series：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>60</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mf>1.</span><span class=p>,</span> <span class=o>-</span><span class=mf>999.</span><span class=p>,</span> <span class=mf>2.</span><span class=p>,</span> <span class=o>-</span><span class=mf>999.</span><span class=p>,</span> <span class=o>-</span><span class=mf>1000.</span><span class=p>,</span> <span class=mf>3.</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>61</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>61</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>       <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=o>-</span><span class=mf>999.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>       <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=o>-</span><span class=mf>999.0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=o>-</span><span class=mf>1000.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>       <span class=mf>3.0</span></span></span></code></pre></td></tr></table></div></div><p>-999这个值可能是一个表示缺失数据的标记值。要将其替换为pandas能够理解的NA值，我们可以利用replace来产生一个新的Series（除非传入inplace=True）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1>1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2>2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3>3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4>4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5>5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6>6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7>7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8>8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>62</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=o>-</span><span class=mi>999</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>62</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>       <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>       <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>       <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>       <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=o>-</span><span class=mf>1000.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>       <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>如果你希望一次性替换多个值，可以传入一个由待替换值组成的列表以及一个替换值：：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1>1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2>2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3>3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4>4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5>5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6>6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7>7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8>8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>63</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>replace</span><span class=p>([</span><span class=o>-</span><span class=mi>999</span><span class=p>,</span> <span class=o>-</span><span class=mi>1000</span><span class=p>],</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>63</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>要让每个值有不同的替换值，可以传递一个替换列表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2>2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3>3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4>4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5>5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6>6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7>7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8>8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>64</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>replace</span><span class=p>([</span><span class=o>-</span><span class=mi>999</span><span class=p>,</span> <span class=o>-</span><span class=mi>1000</span><span class=p>],</span> <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>64</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>传入的参数也可以是字典：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2>2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3>3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4>4</a>
</span><span class=lnt id=hl-26-5><a class=lnlinks href=#hl-26-5>5</a>
</span><span class=lnt id=hl-26-6><a class=lnlinks href=#hl-26-6>6</a>
</span><span class=lnt id=hl-26-7><a class=lnlinks href=#hl-26-7>7</a>
</span><span class=lnt id=hl-26-8><a class=lnlinks href=#hl-26-8>8</a>
</span><span class=lnt id=hl-26-9><a class=lnlinks href=#hl-26-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>65</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>replace</span><span class=p>({</span><span class=o>-</span><span class=mi>999</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=o>-</span><span class=mi>1000</span><span class=p>:</span> <span class=mi>0</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>65</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>笔记：data.replace方法与data.str.replace不同，后者做的是字符串的元素级替换。我们会在后面学习Series的字符串方法。</p></blockquote><h3 id=724-重命名轴索引>7.2.4 重命名轴索引
<a class=header-anchor href=#724-%e9%87%8d%e5%91%bd%e5%90%8d%e8%bd%b4%e7%b4%a2%e5%bc%95></a></h3><p>跟Series中的值一样，轴标签也可以通过函数或映射进行转换，从而得到一个新的不同标签的对象。轴还可以被就地修改，而无需新建一个数据结构。接下来看看下面这个简单的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1>1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2>2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>66</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>12</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                     <span class=n>index</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;Ohio&#39;</span><span class=p>,</span> <span class=s1>&#39;Colorado&#39;</span><span class=p>,</span> <span class=s1>&#39;New York&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                     <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;one&#39;</span><span class=p>,</span> <span class=s1>&#39;two&#39;</span><span class=p>,</span> <span class=s1>&#39;three&#39;</span><span class=p>,</span> <span class=s1>&#39;four&#39;</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>跟Series一样，轴索引也有一个map方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1>1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2>2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3>3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>67</span><span class=p>]:</span> <span class=n>transform</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[:</span><span class=mi>4</span><span class=p>]</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>68</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>transform</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>68</span><span class=p>]:</span> <span class=n>Index</span><span class=p>([</span><span class=s1>&#39;OHIO&#39;</span><span class=p>,</span> <span class=s1>&#39;COLO&#39;</span><span class=p>,</span> <span class=s1>&#39;NEW &#39;</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=s1>&#39;object&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>你可以将其赋值给index，这样就可以对DataFrame进行就地修改：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1>1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2>2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3>3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4>4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5>5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6>6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7>7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>69</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>index</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>transform</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>70</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>70</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=n>one</span>  <span class=n>two</span>  <span class=n>three</span>  <span class=n>four</span>
</span></span><span class=line><span class=cl><span class=n>OHIO</span>    <span class=mi>0</span>    <span class=mi>1</span>      <span class=mi>2</span>     <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>COLO</span>    <span class=mi>4</span>    <span class=mi>5</span>      <span class=mi>6</span>     <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>NEW</span>     <span class=mi>8</span>    <span class=mi>9</span>     <span class=mi>10</span>    <span class=mi>11</span></span></span></code></pre></td></tr></table></div></div><p>如果想要创建数据集的转换版（而不是修改原始数据），比较实用的方法是rename：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3>3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4>4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5>5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>71</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=nb>str</span><span class=o>.</span><span class=n>title</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=nb>str</span><span class=o>.</span><span class=n>upper</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>71</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>      <span class=n>ONE</span>  <span class=n>TWO</span>  <span class=n>THREE</span>  <span class=n>FOUR</span>
</span></span><span class=line><span class=cl><span class=n>Ohio</span>    <span class=mi>0</span>    <span class=mi>1</span>      <span class=mi>2</span>     <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>Colo</span>    <span class=mi>4</span>    <span class=mi>5</span>      <span class=mi>6</span>     <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>New</span>     <span class=mi>8</span>    <span class=mi>9</span>     <span class=mi>10</span>    <span class=mi>11</span></span></span></code></pre></td></tr></table></div></div><p>特别说明一下，rename可以结合字典型对象实现对部分轴标签的更新：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1>1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2>2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3>3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4>4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5>5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6>6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>72</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;OHIO&#39;</span><span class=p>:</span> <span class=s1>&#39;INDIANA&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>             <span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;three&#39;</span><span class=p>:</span> <span class=s1>&#39;peekaboo&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>72</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=n>one</span>  <span class=n>two</span>  <span class=n>peekaboo</span>  <span class=n>four</span>
</span></span><span class=line><span class=cl><span class=n>INDIANA</span>    <span class=mi>0</span>    <span class=mi>1</span>         <span class=mi>2</span>     <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>COLO</span>       <span class=mi>4</span>    <span class=mi>5</span>         <span class=mi>6</span>     <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>NEW</span>        <span class=mi>8</span>    <span class=mi>9</span>        <span class=mi>10</span>    <span class=mi>11</span></span></span></code></pre></td></tr></table></div></div><p>rename可以实现复制DataFrame并对其索引和列标签进行赋值。如果希望就地修改某个数据集，传入inplace=True即可：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1>1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2>2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3>3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4>4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5>5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6>6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7>7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>73</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;OHIO&#39;</span><span class=p>:</span> <span class=s1>&#39;INDIANA&#39;</span><span class=p>},</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>74</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>74</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>         <span class=n>one</span>  <span class=n>two</span>  <span class=n>three</span>  <span class=n>four</span>
</span></span><span class=line><span class=cl><span class=n>INDIANA</span>    <span class=mi>0</span>    <span class=mi>1</span>      <span class=mi>2</span>     <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>COLO</span>       <span class=mi>4</span>    <span class=mi>5</span>      <span class=mi>6</span>     <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>NEW</span>        <span class=mi>8</span>    <span class=mi>9</span>     <span class=mi>10</span>    <span class=mi>11</span></span></span></code></pre></td></tr></table></div></div><h3 id=725-离散化和面元划分>7.2.5 离散化和面元划分
<a class=header-anchor href=#725-%e7%a6%bb%e6%95%a3%e5%8c%96%e5%92%8c%e9%9d%a2%e5%85%83%e5%88%92%e5%88%86></a></h3><p>为了便于分析，连续数据常常被离散化或拆分为“面元”（bin）。假设有一组人员数据，而你希望将它们划分为不同的年龄组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>75</span><span class=p>]:</span> <span class=n>ages</span> <span class=o>=</span> <span class=p>[</span><span class=mi>20</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=mi>23</span><span class=p>,</span> <span class=mi>37</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>32</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>接下来将这些数据划分为“18到25”、“26到35”、“35到60”以及“60以上”几个面元。要实现该功能，你需要使用pandas的cut函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1>1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2>2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3>3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4>4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5>5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6>6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7>7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8>8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>76</span><span class=p>]:</span> <span class=n>bins</span> <span class=o>=</span> <span class=p>[</span><span class=mi>18</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>100</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>77</span><span class=p>]:</span> <span class=n>cats</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>cut</span><span class=p>(</span><span class=n>ages</span><span class=p>,</span> <span class=n>bins</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>78</span><span class=p>]:</span> <span class=n>cats</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>78</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[(</span><span class=mi>18</span><span class=p>,</span> <span class=mi>25</span><span class=p>],</span> <span class=p>(</span><span class=mi>18</span><span class=p>,</span> <span class=mi>25</span><span class=p>],</span> <span class=p>(</span><span class=mi>18</span><span class=p>,</span> <span class=mi>25</span><span class=p>],</span> <span class=p>(</span><span class=mi>25</span><span class=p>,</span> <span class=mi>35</span><span class=p>],</span> <span class=p>(</span><span class=mi>18</span><span class=p>,</span> <span class=mi>25</span><span class=p>],</span> <span class=o>...</span><span class=p>,</span> <span class=p>(</span><span class=mi>25</span><span class=p>,</span> <span class=mi>35</span><span class=p>],</span> <span class=p>(</span><span class=mi>60</span><span class=p>,</span> <span class=mi>100</span><span class=p>],</span> <span class=p>(</span><span class=mi>35</span><span class=p>,</span><span class=mi>60</span><span class=p>],</span> <span class=p>(</span><span class=mi>35</span><span class=p>,</span> <span class=mi>60</span><span class=p>],</span> <span class=p>(</span><span class=mi>25</span><span class=p>,</span> <span class=mi>35</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>Length</span><span class=p>:</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=n>int64</span><span class=p>]):</span> <span class=p>[(</span><span class=mi>18</span><span class=p>,</span> <span class=mi>25</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=mi>25</span><span class=p>,</span> <span class=mi>35</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=mi>35</span><span class=p>,</span> <span class=mi>60</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=mi>60</span><span class=p>,</span> <span class=mi>100</span><span class=p>]]</span></span></span></code></pre></td></tr></table></div></div><p>pandas返回的是一个特殊的Categorical对象。结果展示了pandas.cut划分的面元。你可以将其看做一组表示面元名称的字符串。它的底层含有一个表示不同分类名称的类型数组，以及一个codes属性中的年龄数据的标签：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>79</span><span class=p>]:</span> <span class=n>cats</span><span class=o>.</span><span class=n>codes</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>79</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=n>int8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>80</span><span class=p>]:</span> <span class=n>cats</span><span class=o>.</span><span class=n>categories</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>80</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>IntervalIndex</span><span class=p>([(</span><span class=mi>18</span><span class=p>,</span> <span class=mi>25</span><span class=p>],</span> <span class=p>(</span><span class=mi>25</span><span class=p>,</span> <span class=mi>35</span><span class=p>],</span> <span class=p>(</span><span class=mi>35</span><span class=p>,</span> <span class=mi>60</span><span class=p>],</span> <span class=p>(</span><span class=mi>60</span><span class=p>,</span> <span class=mi>100</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>              <span class=n>closed</span><span class=o>=</span><span class=s1>&#39;right&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>dtype</span><span class=o>=</span><span class=s1>&#39;interval[int64]&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>81</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>value_counts</span><span class=p>(</span><span class=n>cats</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>81</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>18</span><span class=p>,</span> <span class=mi>25</span><span class=p>]</span>     <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>35</span><span class=p>,</span> <span class=mi>60</span><span class=p>]</span>     <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>25</span><span class=p>,</span> <span class=mi>35</span><span class=p>]</span>     <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>60</span><span class=p>,</span> <span class=mi>100</span><span class=p>]</span>    <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int64</span></span></span></code></pre></td></tr></table></div></div><p>pd.value_counts(cats)是pandas.cut结果的面元计数。</p><p>跟“区间”的数学符号一样，圆括号表示开端，而方括号则表示闭端（包括）。哪边是闭端可以通过right=False进行修改：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1>1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2>2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3>3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4>4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5>5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>82</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>cut</span><span class=p>(</span><span class=n>ages</span><span class=p>,</span> <span class=p>[</span><span class=mi>18</span><span class=p>,</span> <span class=mi>26</span><span class=p>,</span> <span class=mi>36</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>100</span><span class=p>],</span> <span class=n>right</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>82</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=mi>18</span><span class=p>,</span> <span class=mi>26</span><span class=p>),</span> <span class=p>[</span><span class=mi>18</span><span class=p>,</span> <span class=mi>26</span><span class=p>),</span> <span class=p>[</span><span class=mi>18</span><span class=p>,</span> <span class=mi>26</span><span class=p>),</span> <span class=p>[</span><span class=mi>26</span><span class=p>,</span> <span class=mi>36</span><span class=p>),</span> <span class=p>[</span><span class=mi>18</span><span class=p>,</span> <span class=mi>26</span><span class=p>),</span> <span class=o>...</span><span class=p>,</span> <span class=p>[</span><span class=mi>26</span><span class=p>,</span> <span class=mi>36</span><span class=p>),</span> <span class=p>[</span><span class=mi>61</span><span class=p>,</span> <span class=mi>100</span><span class=p>),</span> <span class=p>[</span><span class=mi>36</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=mi>61</span><span class=p>),</span> <span class=p>[</span><span class=mi>36</span><span class=p>,</span> <span class=mi>61</span><span class=p>),</span> <span class=p>[</span><span class=mi>26</span><span class=p>,</span> <span class=mi>36</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>Length</span><span class=p>:</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=n>int64</span><span class=p>]):</span> <span class=p>[[</span><span class=mi>18</span><span class=p>,</span> <span class=mi>26</span><span class=p>)</span> <span class=o>&lt;</span> <span class=p>[</span><span class=mi>26</span><span class=p>,</span> <span class=mi>36</span><span class=p>)</span> <span class=o>&lt;</span> <span class=p>[</span><span class=mi>36</span><span class=p>,</span> <span class=mi>61</span><span class=p>)</span> <span class=o>&lt;</span> <span class=p>[</span><span class=mi>61</span><span class=p>,</span> <span class=mi>100</span><span class=p>)]</span></span></span></code></pre></td></tr></table></div></div><p>你可 以通过传递一个列表或数组到labels，设置自己的面元名称：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1>1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2>2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3>3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4>4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5>5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6>6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7>7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>83</span><span class=p>]:</span> <span class=n>group_names</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Youth&#39;</span><span class=p>,</span> <span class=s1>&#39;YoungAdult&#39;</span><span class=p>,</span> <span class=s1>&#39;MiddleAged&#39;</span><span class=p>,</span> <span class=s1>&#39;Senior&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>84</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>cut</span><span class=p>(</span><span class=n>ages</span><span class=p>,</span> <span class=n>bins</span><span class=p>,</span> <span class=n>labels</span><span class=o>=</span><span class=n>group_names</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>84</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>Youth</span><span class=p>,</span> <span class=n>Youth</span><span class=p>,</span> <span class=n>Youth</span><span class=p>,</span> <span class=n>YoungAdult</span><span class=p>,</span> <span class=n>Youth</span><span class=p>,</span> <span class=o>...</span><span class=p>,</span> <span class=n>YoungAdult</span><span class=p>,</span> <span class=n>Senior</span><span class=p>,</span> <span class=n>MiddleAged</span><span class=p>,</span> <span class=n>Mid</span>
</span></span><span class=line><span class=cl><span class=n>dleAged</span><span class=p>,</span> <span class=n>YoungAdult</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Length</span><span class=p>:</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>Youth</span> <span class=o>&lt;</span> <span class=n>YoungAdult</span> <span class=o>&lt;</span> <span class=n>MiddleAged</span> <span class=o>&lt;</span> <span class=n>Senior</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>如果向cut传入的是面元的数量而不是确切的面元边界，则它会根据数据的最小值和最大值计算等长面元。下面这个例子中，我们将一些均匀分布的数据分成四组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1>1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2>2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3>3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4>4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5>5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6>6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7>7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8>8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>85</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>86</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>cut</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=n>precision</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>86</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[(</span><span class=mf>0.34</span><span class=p>,</span> <span class=mf>0.55</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.34</span><span class=p>,</span> <span class=mf>0.55</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.76</span><span class=p>,</span> <span class=mf>0.97</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.76</span><span class=p>,</span> <span class=mf>0.97</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.34</span><span class=p>,</span> <span class=mf>0.55</span><span class=p>],</span> <span class=o>...</span><span class=p>,</span> <span class=p>(</span><span class=mf>0.34</span>
</span></span><span class=line><span class=cl><span class=p>,</span> <span class=mf>0.55</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.34</span><span class=p>,</span> <span class=mf>0.55</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.55</span><span class=p>,</span> <span class=mf>0.76</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.34</span><span class=p>,</span> <span class=mf>0.55</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.12</span><span class=p>,</span> <span class=mf>0.34</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>Length</span><span class=p>:</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=n>float64</span><span class=p>]):</span> <span class=p>[(</span><span class=mf>0.12</span><span class=p>,</span> <span class=mf>0.34</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=mf>0.34</span><span class=p>,</span> <span class=mf>0.55</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=mf>0.55</span><span class=p>,</span> <span class=mf>0.76</span><span class=p>]</span> <span class=o>&lt;</span> 
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mf>0.76</span><span class=p>,</span> <span class=mf>0.97</span><span class=p>]]</span></span></span></code></pre></td></tr></table></div></div><p>选项precision=2，限定小数只有两位。</p><p>qcut是一个非常类似于cut的函数，它可以根据样本分位数对数据进行面元划分。根据数据的分布情况，cut可能无法使各个面元中含有相同数量的数据点。而qcut由于使用的是样本分位数，因此可以得到大小基本相等的面元：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12>12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13>13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14>14</a>
</span><span class=lnt id=hl-39-15><a class=lnlinks href=#hl-39-15>15</a>
</span><span class=lnt id=hl-39-16><a class=lnlinks href=#hl-39-16>16</a>
</span><span class=lnt id=hl-39-17><a class=lnlinks href=#hl-39-17>17</a>
</span><span class=lnt id=hl-39-18><a class=lnlinks href=#hl-39-18>18</a>
</span><span class=lnt id=hl-39-19><a class=lnlinks href=#hl-39-19>19</a>
</span><span class=lnt id=hl-39-20><a class=lnlinks href=#hl-39-20>20</a>
</span><span class=lnt id=hl-39-21><a class=lnlinks href=#hl-39-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>87</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span>  <span class=c1># Normally distributed</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>88</span><span class=p>]:</span> <span class=n>cats</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>qcut</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>  <span class=c1># Cut into quartiles</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>89</span><span class=p>]:</span> <span class=n>cats</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>89</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[(</span><span class=o>-</span><span class=mf>0.0265</span><span class=p>,</span> <span class=mf>0.62</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.62</span><span class=p>,</span> <span class=mf>3.928</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.68</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.62</span><span class=p>,</span> <span class=mf>3.928</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.0265</span><span class=p>,</span> <span class=mf>0.62</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>,</span> <span class=o>...</span><span class=p>,</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.68</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.68</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>2.95</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.68</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.62</span><span class=p>,</span> <span class=mf>3.928</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.68</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=o>-</span><span class=mf>0.0265</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>Length</span><span class=p>:</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=n>float64</span><span class=p>]):</span> <span class=p>[(</span><span class=o>-</span><span class=mf>2.95</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.68</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.68</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.0265</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=mf>0.62</span><span class=p>]</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>                                    <span class=p>(</span><span class=mf>0.62</span><span class=p>,</span> <span class=mf>3.928</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>90</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>value_counts</span><span class=p>(</span><span class=n>cats</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>90</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mf>0.62</span><span class=p>,</span> <span class=mf>3.928</span><span class=p>]</span>       <span class=mi>250</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=o>-</span><span class=mf>0.0265</span><span class=p>,</span> <span class=mf>0.62</span><span class=p>]</span>     <span class=mi>250</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=o>-</span><span class=mf>0.68</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>]</span>    <span class=mi>250</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=o>-</span><span class=mf>2.95</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.68</span><span class=p>]</span>      <span class=mi>250</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int64</span></span></span></code></pre></td></tr></table></div></div><p>与cut类似，你也可以传递自定义的分位数（0到1之间的数值，包含端点）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1>1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2>2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3>3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4>4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5>5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6>6</a>
</span><span class=lnt id=hl-40-7><a class=lnlinks href=#hl-40-7>7</a>
</span><span class=lnt id=hl-40-8><a class=lnlinks href=#hl-40-8>8</a>
</span><span class=lnt id=hl-40-9><a class=lnlinks href=#hl-40-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>91</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>qcut</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=mf>1.</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>91</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[(</span><span class=o>-</span><span class=mf>0.0265</span><span class=p>,</span> <span class=mf>1.286</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.0265</span><span class=p>,</span> <span class=mf>1.286</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>1.187</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.0265</span><span class=p>,</span> <span class=mf>1.286</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.026</span>
</span></span><span class=line><span class=cl><span class=mi>5</span><span class=p>,</span> <span class=mf>1.286</span><span class=p>],</span> <span class=o>...</span><span class=p>,</span> <span class=p>(</span><span class=o>-</span><span class=mf>1.187</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>1.187</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>2.95</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.187</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.0265</span><span class=p>,</span> 
</span></span><span class=line><span class=cl><span class=mf>1.286</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>1.187</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>Length</span><span class=p>:</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=n>float64</span><span class=p>]):</span> <span class=p>[(</span><span class=o>-</span><span class=mf>2.95</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.187</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=o>-</span><span class=mf>1.187</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0265</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.026</span>
</span></span><span class=line><span class=cl><span class=mi>5</span><span class=p>,</span> <span class=mf>1.286</span><span class=p>]</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>                                    <span class=p>(</span><span class=mf>1.286</span><span class=p>,</span> <span class=mf>3.928</span><span class=p>]]</span></span></span></code></pre></td></tr></table></div></div><p>本章稍后在讲解聚合和分组运算时会再次用到cut和qcut，因为这两个离散化函数对分位和分组分析非常重要。</p><h3 id=726-检测和过滤异常值>7.2.6 检测和过滤异常值
<a class=header-anchor href=#726-%e6%a3%80%e6%b5%8b%e5%92%8c%e8%bf%87%e6%bb%a4%e5%bc%82%e5%b8%b8%e5%80%bc></a></h3><p>过滤或变换异常值（outlier）在很大程度上就是运用数组运算。来看一个含有正态分布数据的DataFrame：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1> 1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2> 2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3> 3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4> 4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5> 5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6> 6</a>
</span><span class=lnt id=hl-41-7><a class=lnlinks href=#hl-41-7> 7</a>
</span><span class=lnt id=hl-41-8><a class=lnlinks href=#hl-41-8> 8</a>
</span><span class=lnt id=hl-41-9><a class=lnlinks href=#hl-41-9> 9</a>
</span><span class=lnt id=hl-41-10><a class=lnlinks href=#hl-41-10>10</a>
</span><span class=lnt id=hl-41-11><a class=lnlinks href=#hl-41-11>11</a>
</span><span class=lnt id=hl-41-12><a class=lnlinks href=#hl-41-12>12</a>
</span><span class=lnt id=hl-41-13><a class=lnlinks href=#hl-41-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>92</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>93</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>describe</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>93</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>                 <span class=mi>0</span>            <span class=mi>1</span>            <span class=mi>2</span>            <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>count</span>  <span class=mf>1000.000000</span>  <span class=mf>1000.000000</span>  <span class=mf>1000.000000</span>  <span class=mf>1000.000000</span>
</span></span><span class=line><span class=cl><span class=n>mean</span>      <span class=mf>0.049091</span>     <span class=mf>0.026112</span>    <span class=o>-</span><span class=mf>0.002544</span>    <span class=o>-</span><span class=mf>0.051827</span>
</span></span><span class=line><span class=cl><span class=n>std</span>       <span class=mf>0.996947</span>     <span class=mf>1.007458</span>     <span class=mf>0.995232</span>     <span class=mf>0.998311</span>
</span></span><span class=line><span class=cl><span class=nb>min</span>      <span class=o>-</span><span class=mf>3.645860</span>    <span class=o>-</span><span class=mf>3.184377</span>    <span class=o>-</span><span class=mf>3.745356</span>    <span class=o>-</span><span class=mf>3.428254</span>
</span></span><span class=line><span class=cl><span class=mi>25</span><span class=o>%</span>      <span class=o>-</span><span class=mf>0.599807</span>    <span class=o>-</span><span class=mf>0.612162</span>    <span class=o>-</span><span class=mf>0.687373</span>    <span class=o>-</span><span class=mf>0.747478</span>
</span></span><span class=line><span class=cl><span class=mi>50</span><span class=o>%</span>       <span class=mf>0.047101</span>    <span class=o>-</span><span class=mf>0.013609</span>    <span class=o>-</span><span class=mf>0.022158</span>    <span class=o>-</span><span class=mf>0.088274</span>
</span></span><span class=line><span class=cl><span class=mi>75</span><span class=o>%</span>       <span class=mf>0.756646</span>     <span class=mf>0.695298</span>     <span class=mf>0.699046</span>     <span class=mf>0.623331</span>
</span></span><span class=line><span class=cl><span class=nb>max</span>       <span class=mf>2.653656</span>     <span class=mf>3.525865</span>     <span class=mf>2.735527</span>     <span class=mf>3.366626</span></span></span></code></pre></td></tr></table></div></div><p>假设你想要找出某列中绝对值大小超过3的值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1>1</a>
</span><span class=lnt id=hl-42-2><a class=lnlinks href=#hl-42-2>2</a>
</span><span class=lnt id=hl-42-3><a class=lnlinks href=#hl-42-3>3</a>
</span><span class=lnt id=hl-42-4><a class=lnlinks href=#hl-42-4>4</a>
</span><span class=lnt id=hl-42-5><a class=lnlinks href=#hl-42-5>5</a>
</span><span class=lnt id=hl-42-6><a class=lnlinks href=#hl-42-6>6</a>
</span><span class=lnt id=hl-42-7><a class=lnlinks href=#hl-42-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>94</span><span class=p>]:</span> <span class=n>col</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>95</span><span class=p>]:</span> <span class=n>col</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>col</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>95</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>41</span>    <span class=o>-</span><span class=mf>3.399312</span>
</span></span><span class=line><span class=cl><span class=mi>136</span>   <span class=o>-</span><span class=mf>3.745356</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>要选出全部含有“超过3或－3的值”的行，你可以在布尔型DataFrame中使用any方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1> 1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2> 2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3> 3</a>
</span><span class=lnt id=hl-43-4><a class=lnlinks href=#hl-43-4> 4</a>
</span><span class=lnt id=hl-43-5><a class=lnlinks href=#hl-43-5> 5</a>
</span><span class=lnt id=hl-43-6><a class=lnlinks href=#hl-43-6> 6</a>
</span><span class=lnt id=hl-43-7><a class=lnlinks href=#hl-43-7> 7</a>
</span><span class=lnt id=hl-43-8><a class=lnlinks href=#hl-43-8> 8</a>
</span><span class=lnt id=hl-43-9><a class=lnlinks href=#hl-43-9> 9</a>
</span><span class=lnt id=hl-43-10><a class=lnlinks href=#hl-43-10>10</a>
</span><span class=lnt id=hl-43-11><a class=lnlinks href=#hl-43-11>11</a>
</span><span class=lnt id=hl-43-12><a class=lnlinks href=#hl-43-12>12</a>
</span><span class=lnt id=hl-43-13><a class=lnlinks href=#hl-43-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>96</span><span class=p>]:</span> <span class=n>data</span><span class=p>[(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>96</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>            <span class=mi>0</span>         <span class=mi>1</span>         <span class=mi>2</span>         <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>41</span>   <span class=mf>0.457246</span> <span class=o>-</span><span class=mf>0.025907</span> <span class=o>-</span><span class=mf>3.399312</span> <span class=o>-</span><span class=mf>0.974657</span>
</span></span><span class=line><span class=cl><span class=mi>60</span>   <span class=mf>1.951312</span>  <span class=mf>3.260383</span>  <span class=mf>0.963301</span>  <span class=mf>1.201206</span>
</span></span><span class=line><span class=cl><span class=mi>136</span>  <span class=mf>0.508391</span> <span class=o>-</span><span class=mf>0.196713</span> <span class=o>-</span><span class=mf>3.745356</span> <span class=o>-</span><span class=mf>1.520113</span>
</span></span><span class=line><span class=cl><span class=mi>235</span> <span class=o>-</span><span class=mf>0.242459</span> <span class=o>-</span><span class=mf>3.056990</span>  <span class=mf>1.918403</span> <span class=o>-</span><span class=mf>0.578828</span>
</span></span><span class=line><span class=cl><span class=mi>258</span>  <span class=mf>0.682841</span>  <span class=mf>0.326045</span>  <span class=mf>0.425384</span> <span class=o>-</span><span class=mf>3.428254</span>
</span></span><span class=line><span class=cl><span class=mi>322</span>  <span class=mf>1.179227</span> <span class=o>-</span><span class=mf>3.184377</span>  <span class=mf>1.369891</span> <span class=o>-</span><span class=mf>1.074833</span>
</span></span><span class=line><span class=cl><span class=mi>544</span> <span class=o>-</span><span class=mf>3.548824</span>  <span class=mf>1.553205</span> <span class=o>-</span><span class=mf>2.186301</span>  <span class=mf>1.277104</span>
</span></span><span class=line><span class=cl><span class=mi>635</span> <span class=o>-</span><span class=mf>0.578093</span>  <span class=mf>0.193299</span>  <span class=mf>1.397822</span>  <span class=mf>3.366626</span>
</span></span><span class=line><span class=cl><span class=mi>782</span> <span class=o>-</span><span class=mf>0.207434</span>  <span class=mf>3.525865</span>  <span class=mf>0.283070</span>  <span class=mf>0.544635</span>
</span></span><span class=line><span class=cl><span class=mi>803</span> <span class=o>-</span><span class=mf>3.645860</span>  <span class=mf>0.255475</span> <span class=o>-</span><span class=mf>0.549574</span> <span class=o>-</span><span class=mf>1.907459</span></span></span></code></pre></td></tr></table></div></div><p>根据这些条件，就可以对值进行设置。下面的代码可以将值限制在区间－3到3以内：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1> 1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2> 2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3> 3</a>
</span><span class=lnt id=hl-44-4><a class=lnlinks href=#hl-44-4> 4</a>
</span><span class=lnt id=hl-44-5><a class=lnlinks href=#hl-44-5> 5</a>
</span><span class=lnt id=hl-44-6><a class=lnlinks href=#hl-44-6> 6</a>
</span><span class=lnt id=hl-44-7><a class=lnlinks href=#hl-44-7> 7</a>
</span><span class=lnt id=hl-44-8><a class=lnlinks href=#hl-44-8> 8</a>
</span><span class=lnt id=hl-44-9><a class=lnlinks href=#hl-44-9> 9</a>
</span><span class=lnt id=hl-44-10><a class=lnlinks href=#hl-44-10>10</a>
</span><span class=lnt id=hl-44-11><a class=lnlinks href=#hl-44-11>11</a>
</span><span class=lnt id=hl-44-12><a class=lnlinks href=#hl-44-12>12</a>
</span><span class=lnt id=hl-44-13><a class=lnlinks href=#hl-44-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>97</span><span class=p>]:</span> <span class=n>data</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>*</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>98</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>describe</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>98</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>                 <span class=mi>0</span>            <span class=mi>1</span>            <span class=mi>2</span>            <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>count</span>  <span class=mf>1000.000000</span>  <span class=mf>1000.000000</span>  <span class=mf>1000.000000</span>  <span class=mf>1000.000000</span>
</span></span><span class=line><span class=cl><span class=n>mean</span>      <span class=mf>0.050286</span>     <span class=mf>0.025567</span>    <span class=o>-</span><span class=mf>0.001399</span>    <span class=o>-</span><span class=mf>0.051765</span>
</span></span><span class=line><span class=cl><span class=n>std</span>       <span class=mf>0.992920</span>     <span class=mf>1.004214</span>     <span class=mf>0.991414</span>     <span class=mf>0.995761</span>
</span></span><span class=line><span class=cl><span class=nb>min</span>      <span class=o>-</span><span class=mf>3.000000</span>    <span class=o>-</span><span class=mf>3.000000</span>    <span class=o>-</span><span class=mf>3.000000</span>    <span class=o>-</span><span class=mf>3.000000</span>
</span></span><span class=line><span class=cl><span class=mi>25</span><span class=o>%</span>      <span class=o>-</span><span class=mf>0.599807</span>    <span class=o>-</span><span class=mf>0.612162</span>    <span class=o>-</span><span class=mf>0.687373</span>    <span class=o>-</span><span class=mf>0.747478</span>
</span></span><span class=line><span class=cl><span class=mi>50</span><span class=o>%</span>       <span class=mf>0.047101</span>    <span class=o>-</span><span class=mf>0.013609</span>    <span class=o>-</span><span class=mf>0.022158</span>    <span class=o>-</span><span class=mf>0.088274</span>
</span></span><span class=line><span class=cl><span class=mi>75</span><span class=o>%</span>       <span class=mf>0.756646</span>     <span class=mf>0.695298</span>     <span class=mf>0.699046</span>     <span class=mf>0.623331</span>
</span></span><span class=line><span class=cl><span class=nb>max</span>       <span class=mf>2.653656</span>     <span class=mf>3.000000</span>     <span class=mf>2.735527</span>     <span class=mf>3.000000</span></span></span></code></pre></td></tr></table></div></div><p>根据数据的值是正还是负，np.sign(data)可以生成1和-1：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1>1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2>2</a>
</span><span class=lnt id=hl-45-3><a class=lnlinks href=#hl-45-3>3</a>
</span><span class=lnt id=hl-45-4><a class=lnlinks href=#hl-45-4>4</a>
</span><span class=lnt id=hl-45-5><a class=lnlinks href=#hl-45-5>5</a>
</span><span class=lnt id=hl-45-6><a class=lnlinks href=#hl-45-6>6</a>
</span><span class=lnt id=hl-45-7><a class=lnlinks href=#hl-45-7>7</a>
</span><span class=lnt id=hl-45-8><a class=lnlinks href=#hl-45-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>99</span><span class=p>]:</span> <span class=n>np</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>99</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>     <span class=mi>0</span>    <span class=mi>1</span>    <span class=mi>2</span>    <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>0</span> <span class=o>-</span><span class=mf>1.0</span>  <span class=mf>1.0</span> <span class=o>-</span><span class=mf>1.0</span>  <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mf>1.0</span> <span class=o>-</span><span class=mf>1.0</span>  <span class=mf>1.0</span> <span class=o>-</span><span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>1.0</span>  <span class=mf>1.0</span>  <span class=mf>1.0</span> <span class=o>-</span><span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span> <span class=o>-</span><span class=mf>1.0</span> <span class=o>-</span><span class=mf>1.0</span>  <span class=mf>1.0</span> <span class=o>-</span><span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span> <span class=o>-</span><span class=mf>1.0</span>  <span class=mf>1.0</span> <span class=o>-</span><span class=mf>1.0</span> <span class=o>-</span><span class=mf>1.0</span></span></span></code></pre></td></tr></table></div></div><h3 id=727-排列和随机采样>7.2.7 排列和随机采样
<a class=header-anchor href=#727-%e6%8e%92%e5%88%97%e5%92%8c%e9%9a%8f%e6%9c%ba%e9%87%87%e6%a0%b7></a></h3><p>利用numpy.random.permutation函数可以轻松实现对Series或DataFrame的列的排列工作（permuting，随机重排序）。通过需要排列的轴的长度调用permutation，可产生一个表示新顺序的整数数组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1>1</a>
</span><span class=lnt id=hl-46-2><a class=lnlinks href=#hl-46-2>2</a>
</span><span class=lnt id=hl-46-3><a class=lnlinks href=#hl-46-3>3</a>
</span><span class=lnt id=hl-46-4><a class=lnlinks href=#hl-46-4>4</a>
</span><span class=lnt id=hl-46-5><a class=lnlinks href=#hl-46-5>5</a>
</span><span class=lnt id=hl-46-6><a class=lnlinks href=#hl-46-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>100</span><span class=p>]:</span> <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=mi>4</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>((</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>101</span><span class=p>]:</span> <span class=n>sampler</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>102</span><span class=p>]:</span> <span class=n>sampler</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>102</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>然后就可以在基于iloc的索引操作或take函数中使用该数组了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-47-1><a class=lnlinks href=#hl-47-1> 1</a>
</span><span class=lnt id=hl-47-2><a class=lnlinks href=#hl-47-2> 2</a>
</span><span class=lnt id=hl-47-3><a class=lnlinks href=#hl-47-3> 3</a>
</span><span class=lnt id=hl-47-4><a class=lnlinks href=#hl-47-4> 4</a>
</span><span class=lnt id=hl-47-5><a class=lnlinks href=#hl-47-5> 5</a>
</span><span class=lnt id=hl-47-6><a class=lnlinks href=#hl-47-6> 6</a>
</span><span class=lnt id=hl-47-7><a class=lnlinks href=#hl-47-7> 7</a>
</span><span class=lnt id=hl-47-8><a class=lnlinks href=#hl-47-8> 8</a>
</span><span class=lnt id=hl-47-9><a class=lnlinks href=#hl-47-9> 9</a>
</span><span class=lnt id=hl-47-10><a class=lnlinks href=#hl-47-10>10</a>
</span><span class=lnt id=hl-47-11><a class=lnlinks href=#hl-47-11>11</a>
</span><span class=lnt id=hl-47-12><a class=lnlinks href=#hl-47-12>12</a>
</span><span class=lnt id=hl-47-13><a class=lnlinks href=#hl-47-13>13</a>
</span><span class=lnt id=hl-47-14><a class=lnlinks href=#hl-47-14>14</a>
</span><span class=lnt id=hl-47-15><a class=lnlinks href=#hl-47-15>15</a>
</span><span class=lnt id=hl-47-16><a class=lnlinks href=#hl-47-16>16</a>
</span><span class=lnt id=hl-47-17><a class=lnlinks href=#hl-47-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>103</span><span class=p>]:</span> <span class=n>df</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>103</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>    <span class=mi>0</span>   <span class=mi>1</span>   <span class=mi>2</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=mi>0</span>   <span class=mi>1</span>   <span class=mi>2</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>4</span>   <span class=mi>5</span>   <span class=mi>6</span>   <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mi>8</span>   <span class=mi>9</span>  <span class=mi>10</span>  <span class=mi>11</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mi>12</span>  <span class=mi>13</span>  <span class=mi>14</span>  <span class=mi>15</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mi>16</span>  <span class=mi>17</span>  <span class=mi>18</span>  <span class=mi>19</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>104</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>sampler</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>104</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>    <span class=mi>0</span>   <span class=mi>1</span>   <span class=mi>2</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mi>12</span>  <span class=mi>13</span>  <span class=mi>14</span>  <span class=mi>15</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>4</span>   <span class=mi>5</span>   <span class=mi>6</span>   <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mi>16</span>  <span class=mi>17</span>  <span class=mi>18</span>  <span class=mi>19</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mi>8</span>   <span class=mi>9</span>  <span class=mi>10</span>  <span class=mi>11</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=mi>0</span>   <span class=mi>1</span>   <span class=mi>2</span>   <span class=mi>3</span></span></span></code></pre></td></tr></table></div></div><p>如果不想用替换的方式选取随机子集，可以在Series和DataFrame上使用sample方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1>1</a>
</span><span class=lnt id=hl-48-2><a class=lnlinks href=#hl-48-2>2</a>
</span><span class=lnt id=hl-48-3><a class=lnlinks href=#hl-48-3>3</a>
</span><span class=lnt id=hl-48-4><a class=lnlinks href=#hl-48-4>4</a>
</span><span class=lnt id=hl-48-5><a class=lnlinks href=#hl-48-5>5</a>
</span><span class=lnt id=hl-48-6><a class=lnlinks href=#hl-48-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>105</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=n>n</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>105</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>    <span class=mi>0</span>   <span class=mi>1</span>   <span class=mi>2</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mi>12</span>  <span class=mi>13</span>  <span class=mi>14</span>  <span class=mi>15</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mi>16</span>  <span class=mi>17</span>  <span class=mi>18</span>  <span class=mi>19</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mi>8</span>   <span class=mi>9</span>  <span class=mi>10</span>  <span class=mi>11</span></span></span></code></pre></td></tr></table></div></div><p>要通过替换的方式产生样本（允许重复选择），可以传递replace=True到sample：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1> 1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2> 2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3> 3</a>
</span><span class=lnt id=hl-49-4><a class=lnlinks href=#hl-49-4> 4</a>
</span><span class=lnt id=hl-49-5><a class=lnlinks href=#hl-49-5> 5</a>
</span><span class=lnt id=hl-49-6><a class=lnlinks href=#hl-49-6> 6</a>
</span><span class=lnt id=hl-49-7><a class=lnlinks href=#hl-49-7> 7</a>
</span><span class=lnt id=hl-49-8><a class=lnlinks href=#hl-49-8> 8</a>
</span><span class=lnt id=hl-49-9><a class=lnlinks href=#hl-49-9> 9</a>
</span><span class=lnt id=hl-49-10><a class=lnlinks href=#hl-49-10>10</a>
</span><span class=lnt id=hl-49-11><a class=lnlinks href=#hl-49-11>11</a>
</span><span class=lnt id=hl-49-12><a class=lnlinks href=#hl-49-12>12</a>
</span><span class=lnt id=hl-49-13><a class=lnlinks href=#hl-49-13>13</a>
</span><span class=lnt id=hl-49-14><a class=lnlinks href=#hl-49-14>14</a>
</span><span class=lnt id=hl-49-15><a class=lnlinks href=#hl-49-15>15</a>
</span><span class=lnt id=hl-49-16><a class=lnlinks href=#hl-49-16>16</a>
</span><span class=lnt id=hl-49-17><a class=lnlinks href=#hl-49-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>106</span><span class=p>]:</span> <span class=n>choices</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>5</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>107</span><span class=p>]:</span> <span class=n>draws</span> <span class=o>=</span> <span class=n>choices</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=n>n</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>replace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>108</span><span class=p>]:</span> <span class=n>draws</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>108</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int64</span></span></span></code></pre></td></tr></table></div></div><h3 id=728-计算指标哑变量>7.2.8 计算指标/哑变量
<a class=header-anchor href=#728-%e8%ae%a1%e7%ae%97%e6%8c%87%e6%a0%87%e5%93%91%e5%8f%98%e9%87%8f></a></h3><p>另一种常用于统计建模或机器学习的转换方式是：将分类变量（categorical variable）转换为“哑变量”或“指标矩阵”。</p><p>如果DataFrame的某一列中含有k个不同的值，则可以派生出一个k列矩阵或DataFrame（其值全为1和0）。pandas有一个get_dummies函数可以实现该功能（其实自己动手做一个也不难）。使用之前的一个DataFrame例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1> 1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2> 2</a>
</span><span class=lnt id=hl-50-3><a class=lnlinks href=#hl-50-3> 3</a>
</span><span class=lnt id=hl-50-4><a class=lnlinks href=#hl-50-4> 4</a>
</span><span class=lnt id=hl-50-5><a class=lnlinks href=#hl-50-5> 5</a>
</span><span class=lnt id=hl-50-6><a class=lnlinks href=#hl-50-6> 6</a>
</span><span class=lnt id=hl-50-7><a class=lnlinks href=#hl-50-7> 7</a>
</span><span class=lnt id=hl-50-8><a class=lnlinks href=#hl-50-8> 8</a>
</span><span class=lnt id=hl-50-9><a class=lnlinks href=#hl-50-9> 9</a>
</span><span class=lnt id=hl-50-10><a class=lnlinks href=#hl-50-10>10</a>
</span><span class=lnt id=hl-50-11><a class=lnlinks href=#hl-50-11>11</a>
</span><span class=lnt id=hl-50-12><a class=lnlinks href=#hl-50-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>109</span><span class=p>]:</span> <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s1>&#39;key&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>.....</span><span class=p>:</span>                    <span class=s1>&#39;data1&#39;</span><span class=p>:</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>110</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>get_dummies</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>110</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>a</span>  <span class=n>b</span>  <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>1</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mi>0</span>  <span class=mi>1</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mi>1</span>  <span class=mi>0</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mi>1</span>  <span class=mi>0</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=mi>0</span>  <span class=mi>1</span>  <span class=mi>0</span></span></span></code></pre></td></tr></table></div></div><p>有时候，你可能想给指标DataFrame的列加上一个前缀，以便能够跟其他数据进行合并。get_dummies的prefix参数可以实现该功能：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1> 1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2> 2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3> 3</a>
</span><span class=lnt id=hl-51-4><a class=lnlinks href=#hl-51-4> 4</a>
</span><span class=lnt id=hl-51-5><a class=lnlinks href=#hl-51-5> 5</a>
</span><span class=lnt id=hl-51-6><a class=lnlinks href=#hl-51-6> 6</a>
</span><span class=lnt id=hl-51-7><a class=lnlinks href=#hl-51-7> 7</a>
</span><span class=lnt id=hl-51-8><a class=lnlinks href=#hl-51-8> 8</a>
</span><span class=lnt id=hl-51-9><a class=lnlinks href=#hl-51-9> 9</a>
</span><span class=lnt id=hl-51-10><a class=lnlinks href=#hl-51-10>10</a>
</span><span class=lnt id=hl-51-11><a class=lnlinks href=#hl-51-11>11</a>
</span><span class=lnt id=hl-51-12><a class=lnlinks href=#hl-51-12>12</a>
</span><span class=lnt id=hl-51-13><a class=lnlinks href=#hl-51-13>13</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>111</span><span class=p>]:</span> <span class=n>dummies</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>get_dummies</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>],</span> <span class=n>prefix</span><span class=o>=</span><span class=s1>&#39;key&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>112</span><span class=p>]:</span> <span class=n>df_with_dummy</span> <span class=o>=</span> <span class=n>df</span><span class=p>[[</span><span class=s1>&#39;data1&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>dummies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>113</span><span class=p>]:</span> <span class=n>df_with_dummy</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>113</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>data1</span>  <span class=n>key_a</span>  <span class=n>key_b</span>  <span class=n>key_c</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>      <span class=mi>0</span>      <span class=mi>0</span>      <span class=mi>1</span>      <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>      <span class=mi>1</span>      <span class=mi>0</span>      <span class=mi>1</span>      <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>      <span class=mi>2</span>      <span class=mi>1</span>      <span class=mi>0</span>      <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>      <span class=mi>3</span>      <span class=mi>0</span>      <span class=mi>0</span>      <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>      <span class=mi>4</span>      <span class=mi>1</span>      <span class=mi>0</span>      <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>      <span class=mi>5</span>      <span class=mi>0</span>      <span class=mi>1</span>      <span class=mi>0</span></span></span></code></pre></td></tr></table></div></div><p>如果DataFrame中的某行同属于多个分类，则事情就会有点复杂。看一下MovieLens 1M数据集，14章会更深入地研究它：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-52-1><a class=lnlinks href=#hl-52-1> 1</a>
</span><span class=lnt id=hl-52-2><a class=lnlinks href=#hl-52-2> 2</a>
</span><span class=lnt id=hl-52-3><a class=lnlinks href=#hl-52-3> 3</a>
</span><span class=lnt id=hl-52-4><a class=lnlinks href=#hl-52-4> 4</a>
</span><span class=lnt id=hl-52-5><a class=lnlinks href=#hl-52-5> 5</a>
</span><span class=lnt id=hl-52-6><a class=lnlinks href=#hl-52-6> 6</a>
</span><span class=lnt id=hl-52-7><a class=lnlinks href=#hl-52-7> 7</a>
</span><span class=lnt id=hl-52-8><a class=lnlinks href=#hl-52-8> 8</a>
</span><span class=lnt id=hl-52-9><a class=lnlinks href=#hl-52-9> 9</a>
</span><span class=lnt id=hl-52-10><a class=lnlinks href=#hl-52-10>10</a>
</span><span class=lnt id=hl-52-11><a class=lnlinks href=#hl-52-11>11</a>
</span><span class=lnt id=hl-52-12><a class=lnlinks href=#hl-52-12>12</a>
</span><span class=lnt id=hl-52-13><a class=lnlinks href=#hl-52-13>13</a>
</span><span class=lnt id=hl-52-14><a class=lnlinks href=#hl-52-14>14</a>
</span><span class=lnt id=hl-52-15><a class=lnlinks href=#hl-52-15>15</a>
</span><span class=lnt id=hl-52-16><a class=lnlinks href=#hl-52-16>16</a>
</span><span class=lnt id=hl-52-17><a class=lnlinks href=#hl-52-17>17</a>
</span><span class=lnt id=hl-52-18><a class=lnlinks href=#hl-52-18>18</a>
</span><span class=lnt id=hl-52-19><a class=lnlinks href=#hl-52-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>114</span><span class=p>]:</span> <span class=n>mnames</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;movie_id&#39;</span><span class=p>,</span> <span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=s1>&#39;genres&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>115</span><span class=p>]:</span> <span class=n>movies</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_table</span><span class=p>(</span><span class=s1>&#39;datasets/movielens/movies.dat&#39;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;::&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=o>.....</span><span class=p>:</span>                        <span class=n>header</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=n>mnames</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>116</span><span class=p>]:</span> <span class=n>movies</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>116</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>movie_id</span>                               <span class=n>title</span>                        <span class=n>genres</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>         <span class=mi>1</span>                    <span class=n>Toy</span> <span class=n>Story</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>   <span class=n>Animation</span><span class=o>|</span><span class=n>Children</span><span class=s1>&#39;s|Comedy</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>         <span class=mi>2</span>                      <span class=n>Jumanji</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>  <span class=n>Adventure</span><span class=o>|</span><span class=n>Children</span><span class=s1>&#39;s|Fantasy</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>         <span class=mi>3</span>             <span class=n>Grumpier</span> <span class=n>Old</span> <span class=n>Men</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>                <span class=n>Comedy</span><span class=o>|</span><span class=n>Romance</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>         <span class=mi>4</span>            <span class=n>Waiting</span> <span class=n>to</span> <span class=n>Exhale</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>                  <span class=n>Comedy</span><span class=o>|</span><span class=n>Drama</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>         <span class=mi>5</span>  <span class=n>Father</span> <span class=n>of</span> <span class=n>the</span> <span class=n>Bride</span> <span class=n>Part</span> <span class=n>II</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>                        <span class=n>Comedy</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>         <span class=mi>6</span>                         <span class=n>Heat</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>         <span class=n>Action</span><span class=o>|</span><span class=n>Crime</span><span class=o>|</span><span class=n>Thriller</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>         <span class=mi>7</span>                      <span class=n>Sabrina</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>                <span class=n>Comedy</span><span class=o>|</span><span class=n>Romance</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>         <span class=mi>8</span>                 <span class=n>Tom</span> <span class=ow>and</span> <span class=n>Huck</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>          <span class=n>Adventure</span><span class=o>|</span><span class=n>Children</span><span class=s1>&#39;s</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>         <span class=mi>9</span>                 <span class=n>Sudden</span> <span class=n>Death</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Action</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>        <span class=mi>10</span>                    <span class=n>GoldenEye</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>     <span class=n>Action</span><span class=o>|</span><span class=n>Adventure</span><span class=o>|</span><span class=n>Thriller</span></span></span></code></pre></td></tr></table></div></div><p>要为每个genre添加指标变量就需要做一些数据规整操作。首先，我们从数据集中抽取出不同的genre值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-53-1><a class=lnlinks href=#hl-53-1>1</a>
</span><span class=lnt id=hl-53-2><a class=lnlinks href=#hl-53-2>2</a>
</span><span class=lnt id=hl-53-3><a class=lnlinks href=#hl-53-3>3</a>
</span><span class=lnt id=hl-53-4><a class=lnlinks href=#hl-53-4>4</a>
</span><span class=lnt id=hl-53-5><a class=lnlinks href=#hl-53-5>5</a>
</span><span class=lnt id=hl-53-6><a class=lnlinks href=#hl-53-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>117</span><span class=p>]:</span> <span class=n>all_genres</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>118</span><span class=p>]:</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>movies</span><span class=o>.</span><span class=n>genres</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=o>.....</span><span class=p>:</span>     <span class=n>all_genres</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>119</span><span class=p>]:</span> <span class=n>genres</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>all_genres</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>现在有：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-54-1><a class=lnlinks href=#hl-54-1>1</a>
</span><span class=lnt id=hl-54-2><a class=lnlinks href=#hl-54-2>2</a>
</span><span class=lnt id=hl-54-3><a class=lnlinks href=#hl-54-3>3</a>
</span><span class=lnt id=hl-54-4><a class=lnlinks href=#hl-54-4>4</a>
</span><span class=lnt id=hl-54-5><a class=lnlinks href=#hl-54-5>5</a>
</span><span class=lnt id=hl-54-6><a class=lnlinks href=#hl-54-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>120</span><span class=p>]:</span> <span class=n>genres</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>120</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([</span><span class=s1>&#39;Animation&#39;</span><span class=p>,</span> <span class=s2>&#34;Children&#39;s&#34;</span><span class=p>,</span> <span class=s1>&#39;Comedy&#39;</span><span class=p>,</span> <span class=s1>&#39;Adventure&#39;</span><span class=p>,</span> <span class=s1>&#39;Fantasy&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>       <span class=s1>&#39;Romance&#39;</span><span class=p>,</span> <span class=s1>&#39;Drama&#39;</span><span class=p>,</span> <span class=s1>&#39;Action&#39;</span><span class=p>,</span> <span class=s1>&#39;Crime&#39;</span><span class=p>,</span> <span class=s1>&#39;Thriller&#39;</span><span class=p>,</span><span class=s1>&#39;Horror&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>       <span class=s1>&#39;Sci-Fi&#39;</span><span class=p>,</span> <span class=s1>&#39;Documentary&#39;</span><span class=p>,</span> <span class=s1>&#39;War&#39;</span><span class=p>,</span> <span class=s1>&#39;Musical&#39;</span><span class=p>,</span> <span class=s1>&#39;Mystery&#39;</span><span class=p>,</span> <span class=s1>&#39;Film-Noir&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>       <span class=s1>&#39;Western&#39;</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>object</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>构建指标DataFrame的方法之一是从一个全零DataFrame开始：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-55-1><a class=lnlinks href=#hl-55-1>1</a>
</span><span class=lnt id=hl-55-2><a class=lnlinks href=#hl-55-2>2</a>
</span><span class=lnt id=hl-55-3><a class=lnlinks href=#hl-55-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>121</span><span class=p>]:</span> <span class=n>zero_matrix</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=nb>len</span><span class=p>(</span><span class=n>movies</span><span class=p>),</span> <span class=nb>len</span><span class=p>(</span><span class=n>genres</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>122</span><span class=p>]:</span> <span class=n>dummies</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>zero_matrix</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=n>genres</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>现在，迭代每一部电影，并将dummies各行的条目设为1。要这么做，我们使用dummies.columns来计算每个类型的列索引：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-56-1><a class=lnlinks href=#hl-56-1>1</a>
</span><span class=lnt id=hl-56-2><a class=lnlinks href=#hl-56-2>2</a>
</span><span class=lnt id=hl-56-3><a class=lnlinks href=#hl-56-3>3</a>
</span><span class=lnt id=hl-56-4><a class=lnlinks href=#hl-56-4>4</a>
</span><span class=lnt id=hl-56-5><a class=lnlinks href=#hl-56-5>5</a>
</span><span class=lnt id=hl-56-6><a class=lnlinks href=#hl-56-6>6</a>
</span><span class=lnt id=hl-56-7><a class=lnlinks href=#hl-56-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>123</span><span class=p>]:</span> <span class=n>gen</span> <span class=o>=</span> <span class=n>movies</span><span class=o>.</span><span class=n>genres</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>124</span><span class=p>]:</span> <span class=n>gen</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>124</span><span class=p>]:</span> <span class=p>[</span><span class=s1>&#39;Animation&#39;</span><span class=p>,</span> <span class=s2>&#34;Children&#39;s&#34;</span><span class=p>,</span> <span class=s1>&#39;Comedy&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>125</span><span class=p>]:</span> <span class=n>dummies</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_indexer</span><span class=p>(</span><span class=n>gen</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>125</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>然后，根据索引，使用.iloc设定值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-57-1><a class=lnlinks href=#hl-57-1>1</a>
</span><span class=lnt id=hl-57-2><a class=lnlinks href=#hl-57-2>2</a>
</span><span class=lnt id=hl-57-3><a class=lnlinks href=#hl-57-3>3</a>
</span><span class=lnt id=hl-57-4><a class=lnlinks href=#hl-57-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>126</span><span class=p>]:</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>gen</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>movies</span><span class=o>.</span><span class=n>genres</span><span class=p>):</span>
</span></span><span class=line><span class=cl>   <span class=o>.....</span><span class=p>:</span>     <span class=n>indices</span> <span class=o>=</span> <span class=n>dummies</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>get_indexer</span><span class=p>(</span><span class=n>gen</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>   <span class=o>.....</span><span class=p>:</span>     <span class=n>dummies</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>indices</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>   <span class=o>.....</span><span class=p>:</span></span></span></code></pre></td></tr></table></div></div><p>然后，和以前一样，再将其与movies合并起来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-58-1><a class=lnlinks href=#hl-58-1> 1</a>
</span><span class=lnt id=hl-58-2><a class=lnlinks href=#hl-58-2> 2</a>
</span><span class=lnt id=hl-58-3><a class=lnlinks href=#hl-58-3> 3</a>
</span><span class=lnt id=hl-58-4><a class=lnlinks href=#hl-58-4> 4</a>
</span><span class=lnt id=hl-58-5><a class=lnlinks href=#hl-58-5> 5</a>
</span><span class=lnt id=hl-58-6><a class=lnlinks href=#hl-58-6> 6</a>
</span><span class=lnt id=hl-58-7><a class=lnlinks href=#hl-58-7> 7</a>
</span><span class=lnt id=hl-58-8><a class=lnlinks href=#hl-58-8> 8</a>
</span><span class=lnt id=hl-58-9><a class=lnlinks href=#hl-58-9> 9</a>
</span><span class=lnt id=hl-58-10><a class=lnlinks href=#hl-58-10>10</a>
</span><span class=lnt id=hl-58-11><a class=lnlinks href=#hl-58-11>11</a>
</span><span class=lnt id=hl-58-12><a class=lnlinks href=#hl-58-12>12</a>
</span><span class=lnt id=hl-58-13><a class=lnlinks href=#hl-58-13>13</a>
</span><span class=lnt id=hl-58-14><a class=lnlinks href=#hl-58-14>14</a>
</span><span class=lnt id=hl-58-15><a class=lnlinks href=#hl-58-15>15</a>
</span><span class=lnt id=hl-58-16><a class=lnlinks href=#hl-58-16>16</a>
</span><span class=lnt id=hl-58-17><a class=lnlinks href=#hl-58-17>17</a>
</span><span class=lnt id=hl-58-18><a class=lnlinks href=#hl-58-18>18</a>
</span><span class=lnt id=hl-58-19><a class=lnlinks href=#hl-58-19>19</a>
</span><span class=lnt id=hl-58-20><a class=lnlinks href=#hl-58-20>20</a>
</span><span class=lnt id=hl-58-21><a class=lnlinks href=#hl-58-21>21</a>
</span><span class=lnt id=hl-58-22><a class=lnlinks href=#hl-58-22>22</a>
</span><span class=lnt id=hl-58-23><a class=lnlinks href=#hl-58-23>23</a>
</span><span class=lnt id=hl-58-24><a class=lnlinks href=#hl-58-24>24</a>
</span><span class=lnt id=hl-58-25><a class=lnlinks href=#hl-58-25>25</a>
</span><span class=lnt id=hl-58-26><a class=lnlinks href=#hl-58-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>127</span><span class=p>]:</span> <span class=n>movies_windic</span> <span class=o>=</span> <span class=n>movies</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>dummies</span><span class=o>.</span><span class=n>add_prefix</span><span class=p>(</span><span class=s1>&#39;Genre_&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>128</span><span class=p>]:</span> <span class=n>movies_windic</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>128</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>movie_id</span>                                       <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>title</span>                           <span class=n>Toy</span> <span class=n>Story</span> <span class=p>(</span><span class=mi>1995</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>genres</span>               <span class=n>Animation</span><span class=o>|</span><span class=n>Children</span><span class=s1>&#39;s|Comedy</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Animation</span>                                <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Children</span><span class=s1>&#39;s                               1</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Comedy</span>                                   <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Adventure</span>                                <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Fantasy</span>                                  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Romance</span>                                  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Drama</span>                                    <span class=mi>0</span>
</span></span><span class=line><span class=cl>                                <span class=o>...</span>             
</span></span><span class=line><span class=cl><span class=n>Genre_Crime</span>                                    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Thriller</span>                                 <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Horror</span>                                   <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Sci</span><span class=o>-</span><span class=n>Fi</span>                                   <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Documentary</span>                              <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_War</span>                                      <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Musical</span>                                  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Mystery</span>                                  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Film</span><span class=o>-</span><span class=n>Noir</span>                                <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Genre_Western</span>                                  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>Length</span><span class=p>:</span> <span class=mi>21</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>笔记：对于很大的数据，用这种方式构建多成员指标变量就会变得非常慢。最好使用更低级的函数，将其写入NumPy数组，然后结果包装在DataFrame中。</p></blockquote><p>一个对统计应用有用的秘诀是：结合get_dummies和诸如cut之类的离散化函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-59-1><a class=lnlinks href=#hl-59-1> 1</a>
</span><span class=lnt id=hl-59-2><a class=lnlinks href=#hl-59-2> 2</a>
</span><span class=lnt id=hl-59-3><a class=lnlinks href=#hl-59-3> 3</a>
</span><span class=lnt id=hl-59-4><a class=lnlinks href=#hl-59-4> 4</a>
</span><span class=lnt id=hl-59-5><a class=lnlinks href=#hl-59-5> 5</a>
</span><span class=lnt id=hl-59-6><a class=lnlinks href=#hl-59-6> 6</a>
</span><span class=lnt id=hl-59-7><a class=lnlinks href=#hl-59-7> 7</a>
</span><span class=lnt id=hl-59-8><a class=lnlinks href=#hl-59-8> 8</a>
</span><span class=lnt id=hl-59-9><a class=lnlinks href=#hl-59-9> 9</a>
</span><span class=lnt id=hl-59-10><a class=lnlinks href=#hl-59-10>10</a>
</span><span class=lnt id=hl-59-11><a class=lnlinks href=#hl-59-11>11</a>
</span><span class=lnt id=hl-59-12><a class=lnlinks href=#hl-59-12>12</a>
</span><span class=lnt id=hl-59-13><a class=lnlinks href=#hl-59-13>13</a>
</span><span class=lnt id=hl-59-14><a class=lnlinks href=#hl-59-14>14</a>
</span><span class=lnt id=hl-59-15><a class=lnlinks href=#hl-59-15>15</a>
</span><span class=lnt id=hl-59-16><a class=lnlinks href=#hl-59-16>16</a>
</span><span class=lnt id=hl-59-17><a class=lnlinks href=#hl-59-17>17</a>
</span><span class=lnt id=hl-59-18><a class=lnlinks href=#hl-59-18>18</a>
</span><span class=lnt id=hl-59-19><a class=lnlinks href=#hl-59-19>19</a>
</span><span class=lnt id=hl-59-20><a class=lnlinks href=#hl-59-20>20</a>
</span><span class=lnt id=hl-59-21><a class=lnlinks href=#hl-59-21>21</a>
</span><span class=lnt id=hl-59-22><a class=lnlinks href=#hl-59-22>22</a>
</span><span class=lnt id=hl-59-23><a class=lnlinks href=#hl-59-23>23</a>
</span><span class=lnt id=hl-59-24><a class=lnlinks href=#hl-59-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>129</span><span class=p>]:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>12345</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>130</span><span class=p>]:</span> <span class=n>values</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>131</span><span class=p>]:</span> <span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>131</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([</span> <span class=mf>0.9296</span><span class=p>,</span>  <span class=mf>0.3164</span><span class=p>,</span>  <span class=mf>0.1839</span><span class=p>,</span>  <span class=mf>0.2046</span><span class=p>,</span>  <span class=mf>0.5677</span><span class=p>,</span>  <span class=mf>0.5955</span><span class=p>,</span>  <span class=mf>0.9645</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mf>0.6532</span><span class=p>,</span>  <span class=mf>0.7489</span><span class=p>,</span>  <span class=mf>0.6536</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>132</span><span class=p>]:</span> <span class=n>bins</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.6</span><span class=p>,</span> <span class=mf>0.8</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>133</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>get_dummies</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>cut</span><span class=p>(</span><span class=n>values</span><span class=p>,</span> <span class=n>bins</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>133</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>]</span>  <span class=p>(</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>]</span>  <span class=p>(</span><span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.6</span><span class=p>]</span>  <span class=p>(</span><span class=mf>0.6</span><span class=p>,</span> <span class=mf>0.8</span><span class=p>]</span>  <span class=p>(</span><span class=mf>0.8</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>           <span class=mi>0</span>           <span class=mi>1</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>           <span class=mi>1</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>           <span class=mi>0</span>           <span class=mi>1</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>1</span>           <span class=mi>0</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>1</span>           <span class=mi>0</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>1</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>1</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>0</span>           <span class=mi>1</span>           <span class=mi>0</span></span></span></code></pre></td></tr></table></div></div><p>我们用numpy.random.seed，使这个例子具有确定性。本书后面会介绍pandas.get_dummies。</p><h2 id=73-字符串操作>7.3 字符串操作
<a class=header-anchor href=#73-%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%93%8d%e4%bd%9c></a></h2><p>Python能够成为流行的数据处理语言，部分原因是其简单易用的字符串和文本处理功能。大部分文本运算都直接做成了字符串对象的内置方法。对于更为复杂的模式匹配和文本操作，则可能需要用到正则表达式。pandas对此进行了加强，它使你能够对整组数据应用字符串表达式和正则表达式，而且能处理烦人的缺失数据。</p><h3 id=731-字符串对象方法>7.3.1 字符串对象方法
<a class=header-anchor href=#731-%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%af%b9%e8%b1%a1%e6%96%b9%e6%b3%95></a></h3><p>对于许多字符串处理和脚本应用，内置的字符串方法已经能够满足要求了。例如，以逗号分隔的字符串可以用split拆分成数段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-60-1><a class=lnlinks href=#hl-60-1>1</a>
</span><span class=lnt id=hl-60-2><a class=lnlinks href=#hl-60-2>2</a>
</span><span class=lnt id=hl-60-3><a class=lnlinks href=#hl-60-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>134</span><span class=p>]:</span> <span class=n>val</span> <span class=o>=</span> <span class=s1>&#39;a,b,  guido&#39;</span>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>135</span><span class=p>]:</span> <span class=n>val</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>135</span><span class=p>]:</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;  guido&#39;</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>split常常与strip一起使用，以去除空白符（包括换行符）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-61-1><a class=lnlinks href=#hl-61-1>1</a>
</span><span class=lnt id=hl-61-2><a class=lnlinks href=#hl-61-2>2</a>
</span><span class=lnt id=hl-61-3><a class=lnlinks href=#hl-61-3>3</a>
</span><span class=lnt id=hl-61-4><a class=lnlinks href=#hl-61-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>136</span><span class=p>]:</span> <span class=n>pieces</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>val</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>137</span><span class=p>]:</span> <span class=n>pieces</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>137</span><span class=p>]:</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;guido&#39;</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>利用加法，可以将这些子字符串以双冒号分隔符的形式连接起来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-62-1><a class=lnlinks href=#hl-62-1>1</a>
</span><span class=lnt id=hl-62-2><a class=lnlinks href=#hl-62-2>2</a>
</span><span class=lnt id=hl-62-3><a class=lnlinks href=#hl-62-3>3</a>
</span><span class=lnt id=hl-62-4><a class=lnlinks href=#hl-62-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>138</span><span class=p>]:</span> <span class=n>first</span><span class=p>,</span> <span class=n>second</span><span class=p>,</span> <span class=n>third</span> <span class=o>=</span> <span class=n>pieces</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>139</span><span class=p>]:</span> <span class=n>first</span> <span class=o>+</span> <span class=s1>&#39;::&#39;</span> <span class=o>+</span> <span class=n>second</span> <span class=o>+</span> <span class=s1>&#39;::&#39;</span> <span class=o>+</span> <span class=n>third</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>139</span><span class=p>]:</span> <span class=s1>&#39;a::b::guido&#39;</span></span></span></code></pre></td></tr></table></div></div><p>但这种方式并不是很实用。一种更快更符合Python风格的方式是，向字符串"::&ldquo;的join方法传入一个列表或元组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-63-1><a class=lnlinks href=#hl-63-1>1</a>
</span><span class=lnt id=hl-63-2><a class=lnlinks href=#hl-63-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>140</span><span class=p>]:</span> <span class=s1>&#39;::&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>pieces</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>140</span><span class=p>]:</span> <span class=s1>&#39;a::b::guido&#39;</span></span></span></code></pre></td></tr></table></div></div><p>其它方法关注的是子串定位。检测子串的最佳方式是利用Python的in关键字，还可以使用index和find：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-64-1><a class=lnlinks href=#hl-64-1>1</a>
</span><span class=lnt id=hl-64-2><a class=lnlinks href=#hl-64-2>2</a>
</span><span class=lnt id=hl-64-3><a class=lnlinks href=#hl-64-3>3</a>
</span><span class=lnt id=hl-64-4><a class=lnlinks href=#hl-64-4>4</a>
</span><span class=lnt id=hl-64-5><a class=lnlinks href=#hl-64-5>5</a>
</span><span class=lnt id=hl-64-6><a class=lnlinks href=#hl-64-6>6</a>
</span><span class=lnt id=hl-64-7><a class=lnlinks href=#hl-64-7>7</a>
</span><span class=lnt id=hl-64-8><a class=lnlinks href=#hl-64-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>141</span><span class=p>]:</span> <span class=s1>&#39;guido&#39;</span> <span class=ow>in</span> <span class=n>val</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>141</span><span class=p>]:</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>142</span><span class=p>]:</span> <span class=n>val</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>142</span><span class=p>]:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>143</span><span class=p>]:</span> <span class=n>val</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>143</span><span class=p>]:</span> <span class=o>-</span><span class=mi>1</span></span></span></code></pre></td></tr></table></div></div><p>注意find和index的区别：如果找不到字符串，index将会引发一个异常（而不是返回－1）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-65-1><a class=lnlinks href=#hl-65-1>1</a>
</span><span class=lnt id=hl-65-2><a class=lnlinks href=#hl-65-2>2</a>
</span><span class=lnt id=hl-65-3><a class=lnlinks href=#hl-65-3>3</a>
</span><span class=lnt id=hl-65-4><a class=lnlinks href=#hl-65-4>4</a>
</span><span class=lnt id=hl-65-5><a class=lnlinks href=#hl-65-5>5</a>
</span><span class=lnt id=hl-65-6><a class=lnlinks href=#hl-65-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>144</span><span class=p>]:</span> <span class=n>val</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>---------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=ne>ValueError</span>                                <span class=n>Traceback</span> <span class=p>(</span><span class=n>most</span> <span class=n>recent</span> <span class=n>call</span> <span class=n>last</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>ipython</span><span class=o>-</span><span class=nb>input</span><span class=o>-</span><span class=mi>144</span><span class=o>-</span><span class=mi>280</span><span class=n>f8b2856ce</span><span class=o>&gt;</span> <span class=ow>in</span> <span class=o>&lt;</span><span class=n>module</span><span class=o>&gt;</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>----&gt;</span> <span class=mi>1</span> <span class=n>val</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=ne>ValueError</span><span class=p>:</span> <span class=n>substring</span> <span class=ow>not</span> <span class=n>found</span></span></span></code></pre></td></tr></table></div></div><p>与此相关，count可以返回指定子串的出现次数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-66-1><a class=lnlinks href=#hl-66-1>1</a>
</span><span class=lnt id=hl-66-2><a class=lnlinks href=#hl-66-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>145</span><span class=p>]:</span> <span class=n>val</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>145</span><span class=p>]:</span> <span class=mi>2</span></span></span></code></pre></td></tr></table></div></div><p>replace用于将指定模式替换为另一个模式。通过传入空字符串，它也常常用于删除模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-67-1><a class=lnlinks href=#hl-67-1>1</a>
</span><span class=lnt id=hl-67-2><a class=lnlinks href=#hl-67-2>2</a>
</span><span class=lnt id=hl-67-3><a class=lnlinks href=#hl-67-3>3</a>
</span><span class=lnt id=hl-67-4><a class=lnlinks href=#hl-67-4>4</a>
</span><span class=lnt id=hl-67-5><a class=lnlinks href=#hl-67-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>146</span><span class=p>]:</span> <span class=n>val</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=s1>&#39;::&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>146</span><span class=p>]:</span> <span class=s1>&#39;a::b::  guido&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>147</span><span class=p>]:</span> <span class=n>val</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>147</span><span class=p>]:</span> <span class=s1>&#39;ab  guido&#39;</span></span></span></code></pre></td></tr></table></div></div><p>表7-3列出了Python内置的字符串方法。</p><p>这些运算大部分都能使用正则表达式实现（马上就会看到）。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024101334802.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024101343117.png alt></p><p>casefold 将字符转换为小写，并将任何特定区域的变量字符组合转换成一个通用的可比较形式。</p><h3 id=732-正则表达式>7.3.2 正则表达式
<a class=header-anchor href=#732-%e6%ad%a3%e5%88%99%e8%a1%a8%e8%be%be%e5%bc%8f></a></h3><p>正则表达式提供了一种灵活的在文本中搜索或匹配（通常比前者复杂）字符串模式的方式。正则表达式，常称作regex，是根据正则表达式语言编写的字符串。Python内置的re模块负责对字符串应用正则表达式。我将通过一些例子说明其使用方法。</p><blockquote><p>笔记：正则表达式的编写技巧可以自成一章，超出了本书的范围。从网上和其它书可以找到许多非常不错的教程和参考资料。</p></blockquote><p>re模块的函数可以分为三个大类：模式匹配、替换以及拆分。当然，它们之间是相辅相成的。一个regex描述了需要在文本中定位的一个模式，它可以用于许多目的。我们先来看一个简单的例子：假设我想要拆分一个字符串，分隔符为数量不定的一组空白符（制表符、空格、换行符等）。描述一个或多个空白符的regex是\s+：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-68-1><a class=lnlinks href=#hl-68-1>1</a>
</span><span class=lnt id=hl-68-2><a class=lnlinks href=#hl-68-2>2</a>
</span><span class=lnt id=hl-68-3><a class=lnlinks href=#hl-68-3>3</a>
</span><span class=lnt id=hl-68-4><a class=lnlinks href=#hl-68-4>4</a>
</span><span class=lnt id=hl-68-5><a class=lnlinks href=#hl-68-5>5</a>
</span><span class=lnt id=hl-68-6><a class=lnlinks href=#hl-68-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>148</span><span class=p>]:</span> <span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>149</span><span class=p>]:</span> <span class=n>text</span> <span class=o>=</span> <span class=s2>&#34;foo    bar</span><span class=se>\t</span><span class=s2> baz  </span><span class=se>\t</span><span class=s2>qux&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>150</span><span class=p>]:</span> <span class=n>re</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;\s+&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>150</span><span class=p>]:</span> <span class=p>[</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=s1>&#39;baz&#39;</span><span class=p>,</span> <span class=s1>&#39;qux&#39;</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>调用<code>re.split('\s+',text)</code>时，正则表达式会先被编译，然后再在text上调用其split方法。你可以用re.compile自己编译regex以得到一个可重用的regex对象：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-69-1><a class=lnlinks href=#hl-69-1>1</a>
</span><span class=lnt id=hl-69-2><a class=lnlinks href=#hl-69-2>2</a>
</span><span class=lnt id=hl-69-3><a class=lnlinks href=#hl-69-3>3</a>
</span><span class=lnt id=hl-69-4><a class=lnlinks href=#hl-69-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>151</span><span class=p>]:</span> <span class=n>regex</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=s1>&#39;\s+&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>152</span><span class=p>]:</span> <span class=n>regex</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>152</span><span class=p>]:</span> <span class=p>[</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=s1>&#39;baz&#39;</span><span class=p>,</span> <span class=s1>&#39;qux&#39;</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>如果只希望得到匹配regex的所有模式，则可以使用findall方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-70-1><a class=lnlinks href=#hl-70-1>1</a>
</span><span class=lnt id=hl-70-2><a class=lnlinks href=#hl-70-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>153</span><span class=p>]:</span> <span class=n>regex</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>153</span><span class=p>]:</span> <span class=p>[</span><span class=s1>&#39;    &#39;</span><span class=p>,</span> <span class=s1>&#39;</span><span class=se>\t</span><span class=s1> &#39;</span><span class=p>,</span> <span class=s1>&#39;  </span><span class=se>\t</span><span class=s1>&#39;</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>笔记：如果想避免正则表达式中不需要的转义（\），则可以使用原始字符串字面量如r&rsquo;C:\x&rsquo;（也可以编写其等价式&rsquo;C:\x&rsquo;）。</p></blockquote><p>如果打算对许多字符串应用同一条正则表达式，强烈建议通过re.compile创建regex对象。这样将可以节省大量的CPU时间。</p><p>match和search跟findall功能类似。findall返回的是字符串中所有的匹配项，而search则只返回第一个匹配项。match更加严格，它只匹配字符串的首部。来看一个小例子，假设我们有一段文本以及一条能够识别大部分电子邮件地址的正则表达式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-71-1><a class=lnlinks href=#hl-71-1>1</a>
</span><span class=lnt id=hl-71-2><a class=lnlinks href=#hl-71-2>2</a>
</span><span class=lnt id=hl-71-3><a class=lnlinks href=#hl-71-3>3</a>
</span><span class=lnt id=hl-71-4><a class=lnlinks href=#hl-71-4>4</a>
</span><span class=lnt id=hl-71-5><a class=lnlinks href=#hl-71-5>5</a>
</span><span class=lnt id=hl-71-6><a class=lnlinks href=#hl-71-6>6</a>
</span><span class=lnt id=hl-71-7><a class=lnlinks href=#hl-71-7>7</a>
</span><span class=lnt id=hl-71-8><a class=lnlinks href=#hl-71-8>8</a>
</span><span class=lnt id=hl-71-9><a class=lnlinks href=#hl-71-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>text</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;Dave dave@google.com
</span></span></span><span class=line><span class=cl><span class=s2>Steve steve@gmail.com
</span></span></span><span class=line><span class=cl><span class=s2>Rob rob@gmail.com
</span></span></span><span class=line><span class=cl><span class=s2>Ryan ryan@yahoo.com
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>pattern</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># re.IGNORECASE makes the regex case-insensitive</span>
</span></span><span class=line><span class=cl><span class=n>regex</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>IGNORECASE</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>对text使用findall将得到一组电子邮件地址：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-72-1><a class=lnlinks href=#hl-72-1>1</a>
</span><span class=lnt id=hl-72-2><a class=lnlinks href=#hl-72-2>2</a>
</span><span class=lnt id=hl-72-3><a class=lnlinks href=#hl-72-3>3</a>
</span><span class=lnt id=hl-72-4><a class=lnlinks href=#hl-72-4>4</a>
</span><span class=lnt id=hl-72-5><a class=lnlinks href=#hl-72-5>5</a>
</span><span class=lnt id=hl-72-6><a class=lnlinks href=#hl-72-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>155</span><span class=p>]:</span> <span class=n>regex</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>155</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;dave@google.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;steve@gmail.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;rob@gmail.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;ryan@yahoo.com&#39;</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>search返回的是文本中第一个电子邮件地址（以特殊的匹配项对象形式返回）。对于上面那个regex，匹配项对象只能告诉我们模式在原字符串中的起始和结束位置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-73-1><a class=lnlinks href=#hl-73-1>1</a>
</span><span class=lnt id=hl-73-2><a class=lnlinks href=#hl-73-2>2</a>
</span><span class=lnt id=hl-73-3><a class=lnlinks href=#hl-73-3>3</a>
</span><span class=lnt id=hl-73-4><a class=lnlinks href=#hl-73-4>4</a>
</span><span class=lnt id=hl-73-5><a class=lnlinks href=#hl-73-5>5</a>
</span><span class=lnt id=hl-73-6><a class=lnlinks href=#hl-73-6>6</a>
</span><span class=lnt id=hl-73-7><a class=lnlinks href=#hl-73-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>156</span><span class=p>]:</span> <span class=n>m</span> <span class=o>=</span> <span class=n>regex</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>157</span><span class=p>]:</span> <span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>157</span><span class=p>]:</span> <span class=o>&lt;</span><span class=n>_sre</span><span class=o>.</span><span class=n>SRE_Match</span> <span class=nb>object</span><span class=p>;</span> <span class=n>span</span><span class=o>=</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>20</span><span class=p>),</span> <span class=k>match</span><span class=o>=</span><span class=s1>&#39;dave@google.com&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>158</span><span class=p>]:</span> <span class=n>text</span><span class=p>[</span><span class=n>m</span><span class=o>.</span><span class=n>start</span><span class=p>():</span><span class=n>m</span><span class=o>.</span><span class=n>end</span><span class=p>()]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>158</span><span class=p>]:</span> <span class=s1>&#39;dave@google.com&#39;</span></span></span></code></pre></td></tr></table></div></div><p>regex.match则将返回None，因为它只匹配出现在字符串开头的模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-74-1><a class=lnlinks href=#hl-74-1>1</a>
</span><span class=lnt id=hl-74-2><a class=lnlinks href=#hl-74-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>159</span><span class=p>]:</span> <span class=nb>print</span><span class=p>(</span><span class=n>regex</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=n>text</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kc>None</span></span></span></code></pre></td></tr></table></div></div><p>相关的，sub方法可以将匹配到的模式替换为指定字符串，并返回所得到的新字符串：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-75-1><a class=lnlinks href=#hl-75-1>1</a>
</span><span class=lnt id=hl-75-2><a class=lnlinks href=#hl-75-2>2</a>
</span><span class=lnt id=hl-75-3><a class=lnlinks href=#hl-75-3>3</a>
</span><span class=lnt id=hl-75-4><a class=lnlinks href=#hl-75-4>4</a>
</span><span class=lnt id=hl-75-5><a class=lnlinks href=#hl-75-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>160</span><span class=p>]:</span> <span class=nb>print</span><span class=p>(</span><span class=n>regex</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=s1>&#39;REDACTED&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>Dave</span> <span class=n>REDACTED</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span> <span class=n>REDACTED</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span> <span class=n>REDACTED</span>
</span></span><span class=line><span class=cl><span class=n>Ryan</span> <span class=n>REDACTED</span></span></span></code></pre></td></tr></table></div></div><p>假设你不仅想要找出电子邮件地址，还想将各个地址分成3个部分：用户名、域名以及域后缀。要实现此功能，只需将待分段的模式的各部分用圆括号包起来即可：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-76-1><a class=lnlinks href=#hl-76-1>1</a>
</span><span class=lnt id=hl-76-2><a class=lnlinks href=#hl-76-2>2</a>
</span><span class=lnt id=hl-76-3><a class=lnlinks href=#hl-76-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>161</span><span class=p>]:</span> <span class=n>pattern</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]{2,4})&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>162</span><span class=p>]:</span> <span class=n>regex</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>IGNORECASE</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>由这种修改过的正则表达式所产生的匹配项对象，可以通过其groups方法返回一个由模式各段组成的元组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-77-1><a class=lnlinks href=#hl-77-1>1</a>
</span><span class=lnt id=hl-77-2><a class=lnlinks href=#hl-77-2>2</a>
</span><span class=lnt id=hl-77-3><a class=lnlinks href=#hl-77-3>3</a>
</span><span class=lnt id=hl-77-4><a class=lnlinks href=#hl-77-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>163</span><span class=p>]:</span> <span class=n>m</span> <span class=o>=</span> <span class=n>regex</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=s1>&#39;wesm@bright.net&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>164</span><span class=p>]:</span> <span class=n>m</span><span class=o>.</span><span class=n>groups</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>164</span><span class=p>]:</span> <span class=p>(</span><span class=s1>&#39;wesm&#39;</span><span class=p>,</span> <span class=s1>&#39;bright&#39;</span><span class=p>,</span> <span class=s1>&#39;net&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>对于带有分组功能的模式，findall会返回一个元组列表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-78-1><a class=lnlinks href=#hl-78-1>1</a>
</span><span class=lnt id=hl-78-2><a class=lnlinks href=#hl-78-2>2</a>
</span><span class=lnt id=hl-78-3><a class=lnlinks href=#hl-78-3>3</a>
</span><span class=lnt id=hl-78-4><a class=lnlinks href=#hl-78-4>4</a>
</span><span class=lnt id=hl-78-5><a class=lnlinks href=#hl-78-5>5</a>
</span><span class=lnt id=hl-78-6><a class=lnlinks href=#hl-78-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>165</span><span class=p>]:</span> <span class=n>regex</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>165</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=p>[(</span><span class=s1>&#39;dave&#39;</span><span class=p>,</span> <span class=s1>&#39;google&#39;</span><span class=p>,</span> <span class=s1>&#39;com&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl> <span class=p>(</span><span class=s1>&#39;steve&#39;</span><span class=p>,</span> <span class=s1>&#39;gmail&#39;</span><span class=p>,</span> <span class=s1>&#39;com&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl> <span class=p>(</span><span class=s1>&#39;rob&#39;</span><span class=p>,</span> <span class=s1>&#39;gmail&#39;</span><span class=p>,</span> <span class=s1>&#39;com&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl> <span class=p>(</span><span class=s1>&#39;ryan&#39;</span><span class=p>,</span> <span class=s1>&#39;yahoo&#39;</span><span class=p>,</span> <span class=s1>&#39;com&#39;</span><span class=p>)]</span></span></span></code></pre></td></tr></table></div></div><p>sub还能通过诸如\1、\2之类的特殊符号访问各匹配项中的分组。符号\1对应第一个匹配的组，\2对应第二个匹配的组，以此类推：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-79-1><a class=lnlinks href=#hl-79-1>1</a>
</span><span class=lnt id=hl-79-2><a class=lnlinks href=#hl-79-2>2</a>
</span><span class=lnt id=hl-79-3><a class=lnlinks href=#hl-79-3>3</a>
</span><span class=lnt id=hl-79-4><a class=lnlinks href=#hl-79-4>4</a>
</span><span class=lnt id=hl-79-5><a class=lnlinks href=#hl-79-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>166</span><span class=p>]:</span> <span class=nb>print</span><span class=p>(</span><span class=n>regex</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;Username: \1, Domain: \2, Suffix: \3&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>Dave</span> <span class=n>Username</span><span class=p>:</span> <span class=n>dave</span><span class=p>,</span> <span class=n>Domain</span><span class=p>:</span> <span class=n>google</span><span class=p>,</span> <span class=n>Suffix</span><span class=p>:</span> <span class=n>com</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span> <span class=n>Username</span><span class=p>:</span> <span class=n>steve</span><span class=p>,</span> <span class=n>Domain</span><span class=p>:</span> <span class=n>gmail</span><span class=p>,</span> <span class=n>Suffix</span><span class=p>:</span> <span class=n>com</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span> <span class=n>Username</span><span class=p>:</span> <span class=n>rob</span><span class=p>,</span> <span class=n>Domain</span><span class=p>:</span> <span class=n>gmail</span><span class=p>,</span> <span class=n>Suffix</span><span class=p>:</span> <span class=n>com</span>
</span></span><span class=line><span class=cl><span class=n>Ryan</span> <span class=n>Username</span><span class=p>:</span> <span class=n>ryan</span><span class=p>,</span> <span class=n>Domain</span><span class=p>:</span> <span class=n>yahoo</span><span class=p>,</span> <span class=n>Suffix</span><span class=p>:</span> <span class=n>com</span></span></span></code></pre></td></tr></table></div></div><p>Python中还有许多的正则表达式，但大部分都超出了本书的范围。表7-4是一个简要概括。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024102452195.png alt></p><h3 id=733-pandas的矢量化字符串函数>7.3.3 pandas的矢量化字符串函数
<a class=header-anchor href=#733-pandas%e7%9a%84%e7%9f%a2%e9%87%8f%e5%8c%96%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%87%bd%e6%95%b0></a></h3><p>清理待分析的散乱数据时，常常需要做一些字符串规整化工作。更为复杂的情况是，含有字符串的列有时还含有缺失数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-80-1><a class=lnlinks href=#hl-80-1> 1</a>
</span><span class=lnt id=hl-80-2><a class=lnlinks href=#hl-80-2> 2</a>
</span><span class=lnt id=hl-80-3><a class=lnlinks href=#hl-80-3> 3</a>
</span><span class=lnt id=hl-80-4><a class=lnlinks href=#hl-80-4> 4</a>
</span><span class=lnt id=hl-80-5><a class=lnlinks href=#hl-80-5> 5</a>
</span><span class=lnt id=hl-80-6><a class=lnlinks href=#hl-80-6> 6</a>
</span><span class=lnt id=hl-80-7><a class=lnlinks href=#hl-80-7> 7</a>
</span><span class=lnt id=hl-80-8><a class=lnlinks href=#hl-80-8> 8</a>
</span><span class=lnt id=hl-80-9><a class=lnlinks href=#hl-80-9> 9</a>
</span><span class=lnt id=hl-80-10><a class=lnlinks href=#hl-80-10>10</a>
</span><span class=lnt id=hl-80-11><a class=lnlinks href=#hl-80-11>11</a>
</span><span class=lnt id=hl-80-12><a class=lnlinks href=#hl-80-12>12</a>
</span><span class=lnt id=hl-80-13><a class=lnlinks href=#hl-80-13>13</a>
</span><span class=lnt id=hl-80-14><a class=lnlinks href=#hl-80-14>14</a>
</span><span class=lnt id=hl-80-15><a class=lnlinks href=#hl-80-15>15</a>
</span><span class=lnt id=hl-80-16><a class=lnlinks href=#hl-80-16>16</a>
</span><span class=lnt id=hl-80-17><a class=lnlinks href=#hl-80-17>17</a>
</span><span class=lnt id=hl-80-18><a class=lnlinks href=#hl-80-18>18</a>
</span><span class=lnt id=hl-80-19><a class=lnlinks href=#hl-80-19>19</a>
</span><span class=lnt id=hl-80-20><a class=lnlinks href=#hl-80-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>167</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;Dave&#39;</span><span class=p>:</span> <span class=s1>&#39;dave@google.com&#39;</span><span class=p>,</span> <span class=s1>&#39;Steve&#39;</span><span class=p>:</span> <span class=s1>&#39;steve@gmail.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=o>.....</span><span class=p>:</span>         <span class=s1>&#39;Rob&#39;</span><span class=p>:</span> <span class=s1>&#39;rob@gmail.com&#39;</span><span class=p>,</span> <span class=s1>&#39;Wes&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>168</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>169</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>169</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Dave</span>     <span class=n>dave</span><span class=nd>@google.com</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span>        <span class=n>rob</span><span class=nd>@gmail.com</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span>    <span class=n>steve</span><span class=nd>@gmail.com</span>
</span></span><span class=line><span class=cl><span class=n>Wes</span>                  <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>170</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>170</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Dave</span>     <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span>      <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span>    <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>Wes</span>       <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>bool</span></span></span></code></pre></td></tr></table></div></div><p>通过data.map，所有字符串和正则表达式方法都能被应用于（传入lambda表达式或其他函数）各个值，但是如果存在NA（null）就会报错。为了解决这个问题，Series有一些能够跳过NA值的面向数组方法，进行字符串操作。通过Series的str属性即可访问这些方法。例如，我们可以通过str.contains检查各个电子邮件地址是否含有"gmail&rdquo;：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-81-1><a class=lnlinks href=#hl-81-1>1</a>
</span><span class=lnt id=hl-81-2><a class=lnlinks href=#hl-81-2>2</a>
</span><span class=lnt id=hl-81-3><a class=lnlinks href=#hl-81-3>3</a>
</span><span class=lnt id=hl-81-4><a class=lnlinks href=#hl-81-4>4</a>
</span><span class=lnt id=hl-81-5><a class=lnlinks href=#hl-81-5>5</a>
</span><span class=lnt id=hl-81-6><a class=lnlinks href=#hl-81-6>6</a>
</span><span class=lnt id=hl-81-7><a class=lnlinks href=#hl-81-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>171</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>contains</span><span class=p>(</span><span class=s1>&#39;gmail&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>171</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Dave</span>     <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span>       <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span>     <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>Wes</span>        <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span></span></span></code></pre></td></tr></table></div></div><p>也可以使用正则表达式，还可以加上任意re选项（如IGNORECASE）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-82-1><a class=lnlinks href=#hl-82-1> 1</a>
</span><span class=lnt id=hl-82-2><a class=lnlinks href=#hl-82-2> 2</a>
</span><span class=lnt id=hl-82-3><a class=lnlinks href=#hl-82-3> 3</a>
</span><span class=lnt id=hl-82-4><a class=lnlinks href=#hl-82-4> 4</a>
</span><span class=lnt id=hl-82-5><a class=lnlinks href=#hl-82-5> 5</a>
</span><span class=lnt id=hl-82-6><a class=lnlinks href=#hl-82-6> 6</a>
</span><span class=lnt id=hl-82-7><a class=lnlinks href=#hl-82-7> 7</a>
</span><span class=lnt id=hl-82-8><a class=lnlinks href=#hl-82-8> 8</a>
</span><span class=lnt id=hl-82-9><a class=lnlinks href=#hl-82-9> 9</a>
</span><span class=lnt id=hl-82-10><a class=lnlinks href=#hl-82-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>172</span><span class=p>]:</span> <span class=n>pattern</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>172</span><span class=p>]:</span> <span class=s1>&#39;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)</span><span class=se>\\</span><span class=s1>.([A-Z]{2,4})&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>173</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>IGNORECASE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>173</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Dave</span>     <span class=p>[(</span><span class=n>dave</span><span class=p>,</span> <span class=n>google</span><span class=p>,</span> <span class=n>com</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span>        <span class=p>[(</span><span class=n>rob</span><span class=p>,</span> <span class=n>gmail</span><span class=p>,</span> <span class=n>com</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span>    <span class=p>[(</span><span class=n>steve</span><span class=p>,</span> <span class=n>gmail</span><span class=p>,</span> <span class=n>com</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>Wes</span>                        <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span></span></span></code></pre></td></tr></table></div></div><p>有两个办法可以实现矢量化的元素获取操作：要么使用str.get，要么在str属性上使用索引：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-83-1><a class=lnlinks href=#hl-83-1>1</a>
</span><span class=lnt id=hl-83-2><a class=lnlinks href=#hl-83-2>2</a>
</span><span class=lnt id=hl-83-3><a class=lnlinks href=#hl-83-3>3</a>
</span><span class=lnt id=hl-83-4><a class=lnlinks href=#hl-83-4>4</a>
</span><span class=lnt id=hl-83-5><a class=lnlinks href=#hl-83-5>5</a>
</span><span class=lnt id=hl-83-6><a class=lnlinks href=#hl-83-6>6</a>
</span><span class=lnt id=hl-83-7><a class=lnlinks href=#hl-83-7>7</a>
</span><span class=lnt id=hl-83-8><a class=lnlinks href=#hl-83-8>8</a>
</span><span class=lnt id=hl-83-9><a class=lnlinks href=#hl-83-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>174</span><span class=p>]:</span> <span class=n>matches</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>IGNORECASE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>175</span><span class=p>]:</span> <span class=n>matches</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>175</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Dave</span>     <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span>      <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span>    <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>Wes</span>       <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span></span></span></code></pre></td></tr></table></div></div><p>要访问嵌入列表中的元素，我们可以传递索引到这两个函数中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-84-1><a class=lnlinks href=#hl-84-1> 1</a>
</span><span class=lnt id=hl-84-2><a class=lnlinks href=#hl-84-2> 2</a>
</span><span class=lnt id=hl-84-3><a class=lnlinks href=#hl-84-3> 3</a>
</span><span class=lnt id=hl-84-4><a class=lnlinks href=#hl-84-4> 4</a>
</span><span class=lnt id=hl-84-5><a class=lnlinks href=#hl-84-5> 5</a>
</span><span class=lnt id=hl-84-6><a class=lnlinks href=#hl-84-6> 6</a>
</span><span class=lnt id=hl-84-7><a class=lnlinks href=#hl-84-7> 7</a>
</span><span class=lnt id=hl-84-8><a class=lnlinks href=#hl-84-8> 8</a>
</span><span class=lnt id=hl-84-9><a class=lnlinks href=#hl-84-9> 9</a>
</span><span class=lnt id=hl-84-10><a class=lnlinks href=#hl-84-10>10</a>
</span><span class=lnt id=hl-84-11><a class=lnlinks href=#hl-84-11>11</a>
</span><span class=lnt id=hl-84-12><a class=lnlinks href=#hl-84-12>12</a>
</span><span class=lnt id=hl-84-13><a class=lnlinks href=#hl-84-13>13</a>
</span><span class=lnt id=hl-84-14><a class=lnlinks href=#hl-84-14>14</a>
</span><span class=lnt id=hl-84-15><a class=lnlinks href=#hl-84-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>176</span><span class=p>]:</span> <span class=n>matches</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>176</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Dave</span>    <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span>     <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span>   <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>Wes</span>     <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>177</span><span class=p>]:</span> <span class=n>matches</span><span class=o>.</span><span class=n>str</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>177</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Dave</span>    <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span>     <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span>   <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>Wes</span>     <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>你可以利用这种方法对字符串进行截取：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-85-1><a class=lnlinks href=#hl-85-1>1</a>
</span><span class=lnt id=hl-85-2><a class=lnlinks href=#hl-85-2>2</a>
</span><span class=lnt id=hl-85-3><a class=lnlinks href=#hl-85-3>3</a>
</span><span class=lnt id=hl-85-4><a class=lnlinks href=#hl-85-4>4</a>
</span><span class=lnt id=hl-85-5><a class=lnlinks href=#hl-85-5>5</a>
</span><span class=lnt id=hl-85-6><a class=lnlinks href=#hl-85-6>6</a>
</span><span class=lnt id=hl-85-7><a class=lnlinks href=#hl-85-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>178</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>str</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>178</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Dave</span>     <span class=n>dave</span><span class=o>@</span>
</span></span><span class=line><span class=cl><span class=n>Rob</span>      <span class=n>rob</span><span class=nd>@g</span>
</span></span><span class=line><span class=cl><span class=n>Steve</span>    <span class=n>steve</span>
</span></span><span class=line><span class=cl><span class=n>Wes</span>        <span class=n>NaN</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span></span></span></code></pre></td></tr></table></div></div><p>表7-5介绍了更多的pandas字符串方法。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024102507010.png alt="表7-5 部分矢量化字符串方法"></p><h2 id=74-总结>7.4 总结
<a class=header-anchor href=#74-%e6%80%bb%e7%bb%93></a></h2><p>高效的数据准备可以让你将更多的时间用于数据分析，花较少的时间用于准备工作，这样就可以极大地提高生产力。我们在本章中学习了许多工具，但覆盖并不全面。下一章，我们会学习pandas的聚合与分组。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/python/>python</a></div><div class=post-share-tools><div class=post-share-loading><i class="fa-solid fa-ellipsis fa-spin"></i></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class=a2a_dd href=https://www.addtoany.com/share></a><a class=a2a_button_wechat></a><a class=a2a_button_qzone></a><a class=a2a_button_sina_weibo></a><a class=a2a_button_douban></a><a class=a2a_button_facebook></a><a class=a2a_button_x></a><a class=a2a_button_email></a><a class=a2a_button_printfriendly></a></div></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="Rich - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="Rich - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
第七章 数据清洗和准备</li><li class=post-copyright-author><strong>本文作者： </strong>Rich</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=//localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch07-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87/ title="第七章 数据清洗和准备">//localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch07-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/white.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/rss.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch06-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD%E5%AD%98%E5%82%A8%E4%B8%8E%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/ rel=next title="第六章 数据加载、存储与文件格式"><i class="fa fa-chevron-left"></i> 第六章 数据加载、存储与文件格式</a></div><div class="post-nav-prev post-nav-item"><a href=/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch03-python%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%87%BD%E6%95%B0%E5%92%8C%E6%96%87%E4%BB%B6/ rel=prev title="第三章 Python 的数据结构、函数和文件">第三章 Python 的数据结构、函数和文件
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=i18n-translate class=i18n-translate><i class="fa fa-language"></i><div id=lang-select class=lang-select><div id=lang-selected class=selected-option><span class="flag-icon flag-icon-zh-cn"></span>
<span class=selected-language>简体中文</span>
<i class="fa fa-chevron-down"></i></div><div id=lang-options class=lang-options><div class=lang-option lang-code=zh-cn lang-name=简体中文 lang-url=/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch07-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87/><span class="flag-icon flag-icon-zh-cn"></span>
<span class=lang-name>简体中文</span></div></div></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rich</span></div></div></footer><script class=next-config data-name=page type=application/json>{"clipboard":{"js":{"alias":"clipboard","file":"dist/clipboard.min.js","name":"clipboard.js","version":"2.0.11"}},"comments":false,"expired":false,"isHome":false,"isPage":true,"path":"ch07-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87","permalink":"//localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch07-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87/","title":"第七章 数据清洗和准备","toc":true,"waline":{"commentcnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}}}</script><script type=text/javascript src=//localhost:1313/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=//localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"hostname":"//localhost:1313/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":true,"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"slideInRight","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":true},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"//localhost:1313/js/3rd"}},"version":"4.8.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src="/js/main.js?=1750130937" defer></script><script type=text/javascript src="/js/clipboard.js?=1750130938" defer></script></body></html>