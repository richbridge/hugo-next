<!doctype html><html lang=zh-CN data-theme=light><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.147.7"><link rel="shortcut icon" type=image/x-icon href=https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/logo/favicon.avif><link rel=icon type=image/x-icon href=https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/logo/favicon.avif><link rel=icon type=image/png sizes=16x16 href=https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/logo/favicon.avif><link rel=icon type=image/png sizes=32x32 href=https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/logo/favicon.avif><link rel=apple-touch-icon sizes=180x180 href=https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/logo/favicon.avif><meta itemprop=name content="第十三章 Python 建模库介绍"><meta itemprop=description content="保持简单的易用性和强大的功能。"><meta name=description content="保持简单的易用性和强大的功能。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif"><meta itemprop=keywords content="python"><meta property="og:type" content="article"><meta property="og:title" content="第十三章 Python 建模库介绍"><meta property="og:description" content="保持简单的易用性和强大的功能。"><meta property="og:image" content="https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="http://localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch13-python%E5%BB%BA%E6%A8%A1%E5%BA%93%E4%BB%8B%E7%BB%8D/"><meta property="og:site_name" content="樊尘刹记"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rich"><meta property="article:published_time" content="2023-09-25 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2023-09-25 00:00:00 +0000 UTC"><link type=text/css rel=stylesheet href=http://localhost:1313/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=http://localhost:1313/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=http://localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.css?=1750143569"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><link rel=stylesheet type=text/css href="/css/custom_style.css?=1750143569"><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>第十三章 Python 建模库介绍 - 樊尘刹记</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>樊尘刹记</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>红尘湮灭，唯有尘刹</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>629</span></a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>友链</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class=search-result-container><div class=algolia-hits></div></div><div class=search-footer><div class=algolia-pagination></div><div class=search-meta-info><div class="search-hit-stats algolia-stats"></div><div class=search-vendor><span>Search By</span>
<a title=Algolia target=_blank href="https://www.algolia.com/?utm_source=instantsearch.js&utm_medium=website&utm_content=localhost%3a1313&utm_campaign=poweredby"><img src=/imgs/algolia-logo.svg></a></div></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#131-pandas与模型代码的接口>13.1 pandas与模型代码的接口</a></li><li><a href=#132-用patsy创建模型描述>13.2 用Patsy创建模型描述</a><ul><li><a href=#1321-用patsy公式进行数据转换>13.2.1 用Patsy公式进行数据转换</a></li><li><a href=#1322-分类数据和patsy>13.2.2 分类数据和Patsy</a></li></ul></li><li><a href=#133-statsmodels介绍>13.3 statsmodels介绍</a><ul><li><a href=#1331-估计线性模型>13.3.1 估计线性模型</a></li><li><a href=#1332-估计时间序列过程>13.3.2 估计时间序列过程</a></li></ul></li><li><a href=#134-scikit-learn介绍>13.4 scikit-learn介绍</a></li><li><a href=#135-继续学习>13.5 继续学习</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rich src=/imgs/img-lazy-loading.gif data-src=https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif><p class=site-author-name itemprop=name>Rich</p><div class=site-description itemprop=description>保持简单的易用性和强大的功能。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>629</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>8</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>99</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/richbridge title="Github → https://github.com/richbridge" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/richfan-38 title="知乎 → https://www.zhihu.com/people/richfan-38" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div><div class="mydefined animated" itemprop=custom><span>💄💄💄</span></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="0001-01-01 00:00:00 +0000 UTC"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2702735></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5708></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-01-24 00:00:00 +0000 UTC"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-i18n-translate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/richbridge rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=http://localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch13-python%E5%BB%BA%E6%A8%A1%E5%BA%93%E4%BB%8B%E7%BB%8D/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif"><meta itemprop=name content="Rich"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rich"><meta itemprop=description content="保持简单的易用性和强大的功能。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="第十三章 Python 建模库介绍"><meta itemprop=description content="本书中，我已经介绍了Python数据分析的编程基础。因为数据分析师和科学家总是在数据规整和准备上花费大量时间，这本书的重点在于掌握这些功能。
开发模型选用什么库取决于应用本身。许多统计问题可以用简单方法解决，比如普通的最小二乘回归，其它问题可能需要复杂的机器学习方法。幸运的是，Python已经成为了运用这些分析方法的语言之一，因此读完此书，你可以探索许多工具。"></span><header class=post-header><h1 class=post-title itemprop="name headline">第十三章 Python 建模库介绍</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023-09-25 00:00:00 +00:00" itemprop="dateCreated datePublished" datetime="2023-09-25 00:00:00 +0000 UTC">2023-09-25
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E7%A8%8B%E6%8A%80/ itemprop=url rel=index><span itemprop=name>程技</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>7190</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>15分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch13-python%E5%BB%BA%E6%A8%A1%E5%BA%93%E4%BB%8B%E7%BB%8D/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>本书中，我已经介绍了Python数据分析的编程基础。因为数据分析师和科学家总是在数据规整和准备上花费大量时间，这本书的重点在于掌握这些功能。</p><p>开发模型选用什么库取决于应用本身。许多统计问题可以用简单方法解决，比如普通的最小二乘回归，其它问题可能需要复杂的机器学习方法。幸运的是，Python已经成为了运用这些分析方法的语言之一，因此读完此书，你可以探索许多工具。</p><a id=more></a><p>本章中，我会回顾一些pandas的特点，在你胶着于pandas数据规整和模型拟合和评分时，它们可能派上用场。然后我会简短介绍两个流行的建模工具，statsmodels和scikit-learn。这二者每个都值得再写一本书，我就不做全面的介绍，而是建议你学习两个项目的线上文档和其它基于Python的数据科学、统计和机器学习的书籍。</p><h2 id=131-pandas与模型代码的接口>13.1 pandas与模型代码的接口
<a class=header-anchor href=#131-pandas%e4%b8%8e%e6%a8%a1%e5%9e%8b%e4%bb%a3%e7%a0%81%e7%9a%84%e6%8e%a5%e5%8f%a3></a></h2><p>模型开发的通常工作流是使用pandas进行数据加载和清洗，然后切换到建模库进行建模。**开发模型的重要一环是机器学习中的“特征工程”。**它可以描述从原始数据集中提取信息的任何数据转换或分析，这些数据集可能在建模中有用。本书中学习的数据聚合和GroupBy工具常用于特征工程中。</p><p>优秀的特征工程超出了本书的范围，我会尽量直白地介绍一些用于数据操作和建模切换的方法。</p><p>pandas与其它分析库通常是靠NumPy的数组联系起来的。将DataFrame转换为NumPy数组，可以使用.values属性：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span><span class=lnt id=hl-0-24><a class=lnlinks href=#hl-0-24>24</a>
</span><span class=lnt id=hl-0-25><a class=lnlinks href=#hl-0-25>25</a>
</span><span class=lnt id=hl-0-26><a class=lnlinks href=#hl-0-26>26</a>
</span><span class=lnt id=hl-0-27><a class=lnlinks href=#hl-0-27>27</a>
</span><span class=lnt id=hl-0-28><a class=lnlinks href=#hl-0-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>10</span><span class=p>]:</span> <span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>11</span><span class=p>]:</span> <span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>12</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;x0&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;x1&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>0.01</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.25</span><span class=p>,</span> <span class=o>-</span><span class=mf>4.1</span><span class=p>,</span> <span class=mf>0.</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;y&#39;</span><span class=p>:</span> <span class=p>[</span><span class=o>-</span><span class=mf>1.5</span><span class=p>,</span> <span class=mf>0.</span><span class=p>,</span> <span class=mf>3.6</span><span class=p>,</span> <span class=mf>1.3</span><span class=p>,</span> <span class=o>-</span><span class=mf>2.</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>13</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>13</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>x0</span>    <span class=n>x1</span>    <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=mi>1</span>  <span class=mf>0.01</span> <span class=o>-</span><span class=mf>1.5</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>2</span> <span class=o>-</span><span class=mf>0.01</span>  <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mi>3</span>  <span class=mf>0.25</span>  <span class=mf>3.6</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=mi>4</span> <span class=o>-</span><span class=mf>4.10</span>  <span class=mf>1.3</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=mi>5</span>  <span class=mf>0.00</span> <span class=o>-</span><span class=mf>2.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>14</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>columns</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>14</span><span class=p>]:</span> <span class=n>Index</span><span class=p>([</span><span class=s1>&#39;x0&#39;</span><span class=p>,</span> <span class=s1>&#39;x1&#39;</span><span class=p>,</span> <span class=s1>&#39;y&#39;</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=s1>&#39;object&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>15</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>15</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([[</span> <span class=mf>1.</span>  <span class=p>,</span>  <span class=mf>0.01</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.5</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>2.</span>  <span class=p>,</span> <span class=o>-</span><span class=mf>0.01</span><span class=p>,</span>  <span class=mf>0.</span>  <span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>3.</span>  <span class=p>,</span>  <span class=mf>0.25</span><span class=p>,</span>  <span class=mf>3.6</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>4.</span>  <span class=p>,</span> <span class=o>-</span><span class=mf>4.1</span> <span class=p>,</span>  <span class=mf>1.3</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>5.</span>  <span class=p>,</span>  <span class=mf>0.</span>  <span class=p>,</span> <span class=o>-</span><span class=mf>2.</span>  <span class=p>]])</span></span></span></code></pre></td></tr></table></div></div><p>要转换回DataFrame，可以传递一个二维ndarray，可带有列名：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>16</span><span class=p>]:</span> <span class=n>df2</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;one&#39;</span><span class=p>,</span> <span class=s1>&#39;two&#39;</span><span class=p>,</span> <span class=s1>&#39;three&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>17</span><span class=p>]:</span> <span class=n>df2</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>17</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>one</span>   <span class=n>two</span>  <span class=n>three</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mf>1.0</span>  <span class=mf>0.01</span>   <span class=o>-</span><span class=mf>1.5</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mf>2.0</span> <span class=o>-</span><span class=mf>0.01</span>    <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mf>3.0</span>  <span class=mf>0.25</span>    <span class=mf>3.6</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mf>4.0</span> <span class=o>-</span><span class=mf>4.10</span>    <span class=mf>1.3</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mf>5.0</span>  <span class=mf>0.00</span>   <span class=o>-</span><span class=mf>2.0</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>笔记：最好当数据是均匀的时候使用.values属性。例如，全是数值类型。如果数据是不均匀的，结果会是Python对象的ndarray：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>18</span><span class=p>]:</span> <span class=n>df3</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>19</span><span class=p>]:</span> <span class=n>df3</span><span class=p>[</span><span class=s1>&#39;strings&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>,</span> <span class=s1>&#39;e&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>20</span><span class=p>]:</span> <span class=n>df3</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>20</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>  <span class=n>x0</span>    <span class=n>x1</span>    <span class=n>y</span> <span class=n>strings</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=mi>1</span>  <span class=mf>0.01</span> <span class=o>-</span><span class=mf>1.5</span>       <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>2</span> <span class=o>-</span><span class=mf>0.01</span>  <span class=mf>0.0</span>       <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mi>3</span>  <span class=mf>0.25</span>  <span class=mf>3.6</span>       <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=mi>4</span> <span class=o>-</span><span class=mf>4.10</span>  <span class=mf>1.3</span>       <span class=n>d</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=mi>5</span>  <span class=mf>0.00</span> <span class=o>-</span><span class=mf>2.0</span>       <span class=n>e</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>21</span><span class=p>]:</span> <span class=n>df3</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>21</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([[</span><span class=mi>1</span><span class=p>,</span> <span class=mf>0.01</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.5</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mf>0.25</span><span class=p>,</span> <span class=mf>3.6</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=o>-</span><span class=mf>4.1</span><span class=p>,</span> <span class=mf>1.3</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=o>-</span><span class=mf>2.0</span><span class=p>,</span> <span class=s1>&#39;e&#39;</span><span class=p>]],</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>object</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div></blockquote><p>对于一些模型，你可能只想使用列的子集。我建议你使用loc，用values作索引：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5>5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6>6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7>7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8>8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>22</span><span class=p>]:</span> <span class=n>model_cols</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;x0&#39;</span><span class=p>,</span> <span class=s1>&#39;x1&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>23</span><span class=p>]:</span> <span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=n>model_cols</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>23</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([[</span> <span class=mf>1.</span>  <span class=p>,</span>  <span class=mf>0.01</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>2.</span>  <span class=p>,</span> <span class=o>-</span><span class=mf>0.01</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>3.</span>  <span class=p>,</span>  <span class=mf>0.25</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>4.</span>  <span class=p>,</span> <span class=o>-</span><span class=mf>4.1</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>5.</span>  <span class=p>,</span>  <span class=mf>0.</span>  <span class=p>]])</span></span></span></code></pre></td></tr></table></div></div><p>一些库原生支持pandas，会自动完成工作：从DataFrame转换到NumPy，将模型的参数名添加到输出表的列或Series。其它情况，你可以手工进行“元数据管理”。</p><p>在第12章，我们学习了pandas的Categorical类型和pandas.get_dummies函数。假设数据集中有一个非数值列：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>24</span><span class=p>]:</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;category&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Categorical</span><span class=p>([</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                                   <span class=n>categories</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>25</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>25</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>x0</span>    <span class=n>x1</span>    <span class=n>y</span> <span class=n>category</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=mi>1</span>  <span class=mf>0.01</span> <span class=o>-</span><span class=mf>1.5</span>        <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>2</span> <span class=o>-</span><span class=mf>0.01</span>  <span class=mf>0.0</span>        <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mi>3</span>  <span class=mf>0.25</span>  <span class=mf>3.6</span>        <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=mi>4</span> <span class=o>-</span><span class=mf>4.10</span>  <span class=mf>1.3</span>        <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=mi>5</span>  <span class=mf>0.00</span> <span class=o>-</span><span class=mf>2.0</span>        <span class=n>b</span></span></span></code></pre></td></tr></table></div></div><p>如果我们想替换category列为虚变量，我们可以创建虚变量，删除category列，然后添加到结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>26</span><span class=p>]:</span> <span class=n>dummies</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>get_dummies</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>category</span><span class=p>,</span> <span class=n>prefix</span><span class=o>=</span><span class=s1>&#39;category&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>27</span><span class=p>]:</span> <span class=n>data_with_dummies</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;category&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>dummies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>28</span><span class=p>]:</span> <span class=n>data_with_dummies</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>28</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>x0</span>    <span class=n>x1</span>    <span class=n>y</span>  <span class=n>category_a</span>  <span class=n>category_b</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=mi>1</span>  <span class=mf>0.01</span> <span class=o>-</span><span class=mf>1.5</span>           <span class=mi>1</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>2</span> <span class=o>-</span><span class=mf>0.01</span>  <span class=mf>0.0</span>           <span class=mi>0</span>           <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mi>3</span>  <span class=mf>0.25</span>  <span class=mf>3.6</span>           <span class=mi>1</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=mi>4</span> <span class=o>-</span><span class=mf>4.10</span>  <span class=mf>1.3</span>           <span class=mi>1</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=mi>5</span>  <span class=mf>0.00</span> <span class=o>-</span><span class=mf>2.0</span>           <span class=mi>0</span>           <span class=mi>1</span></span></span></code></pre></td></tr></table></div></div><p>用虚变量拟合某些统计模型会有一些细微差别。当你不只有数字列时，使用Patsy（下一节的主题）可能更简单，更不容易出错。</p><h2 id=132-用patsy创建模型描述>13.2 用Patsy创建模型描述
<a class=header-anchor href=#132-%e7%94%a8patsy%e5%88%9b%e5%bb%ba%e6%a8%a1%e5%9e%8b%e6%8f%8f%e8%bf%b0></a></h2><p><code>Patsy</code>是Python的一个库，使用简短的字符串“公式语法”描述统计模型（尤其是线性模型），可能是受到了R和S统计编程语言的公式语法的启发。</p><p>Patsy适合描述statsmodels的线性模型，因此我会关注于它的主要特点，让你尽快掌握。Patsy的公式是一个特殊的字符串语法，如下所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>y</span> <span class=o>~</span> <span class=n>x0</span> <span class=o>+</span> <span class=n>x1</span></span></span></code></pre></td></tr></table></div></div><p>a+b不是将a与b相加的意思，而是为模型创建的设计矩阵。patsy.dmatrices函数接收一个公式字符串和一个数据集（可以是DataFrame或数组的字典），为线性模型创建设计矩阵：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>29</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;x0&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;x1&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>0.01</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.25</span><span class=p>,</span> <span class=o>-</span><span class=mf>4.1</span><span class=p>,</span> <span class=mf>0.</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;y&#39;</span><span class=p>:</span> <span class=p>[</span><span class=o>-</span><span class=mf>1.5</span><span class=p>,</span> <span class=mf>0.</span><span class=p>,</span> <span class=mf>3.6</span><span class=p>,</span> <span class=mf>1.3</span><span class=p>,</span> <span class=o>-</span><span class=mf>2.</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>30</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>30</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>x0</span>    <span class=n>x1</span>    <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=mi>1</span>  <span class=mf>0.01</span> <span class=o>-</span><span class=mf>1.5</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>2</span> <span class=o>-</span><span class=mf>0.01</span>  <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mi>3</span>  <span class=mf>0.25</span>  <span class=mf>3.6</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=mi>4</span> <span class=o>-</span><span class=mf>4.10</span>  <span class=mf>1.3</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=mi>5</span>  <span class=mf>0.00</span> <span class=o>-</span><span class=mf>2.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>31</span><span class=p>]:</span> <span class=kn>import</span> <span class=nn>patsy</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>32</span><span class=p>]:</span> <span class=n>y</span><span class=p>,</span> <span class=n>X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;y ~ x0 + x1&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>现在有：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a>
</span><span class=lnt id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a>
</span><span class=lnt id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a>
</span><span class=lnt id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a>
</span><span class=lnt id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a>
</span><span class=lnt id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a>
</span><span class=lnt id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a>
</span><span class=lnt id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a>
</span><span class=lnt id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a>
</span><span class=lnt id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a>
</span><span class=lnt id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a>
</span><span class=lnt id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a>
</span><span class=lnt id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a>
</span><span class=lnt id=hl-8-23><a class=lnlinks href=#hl-8-23>23</a>
</span><span class=lnt id=hl-8-24><a class=lnlinks href=#hl-8-24>24</a>
</span><span class=lnt id=hl-8-25><a class=lnlinks href=#hl-8-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>33</span><span class=p>]:</span> <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>33</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=n>y</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=mf>1.5</span>
</span></span><span class=line><span class=cl>   <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>   <span class=mf>3.6</span>
</span></span><span class=line><span class=cl>   <span class=mf>1.3</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=mf>2.0</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;y&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>34</span><span class=p>]:</span> <span class=n>X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>34</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Intercept</span>  <span class=n>x0</span>     <span class=n>x1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>1</span>   <span class=mf>0.01</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>2</span>  <span class=o>-</span><span class=mf>0.01</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>3</span>   <span class=mf>0.25</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>4</span>  <span class=o>-</span><span class=mf>4.10</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>5</span>   <span class=mf>0.00</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Intercept&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;x0&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;x1&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>2</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>这些Patsy的DesignMatrix实例是NumPy的ndarray，带有附加元数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>35</span><span class=p>]:</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>35</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([[</span><span class=o>-</span><span class=mf>1.5</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>0.</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>3.6</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span><span class=o>-</span><span class=mf>2.</span> <span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>36</span><span class=p>]:</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>X</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>36</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([[</span> <span class=mf>1.</span>  <span class=p>,</span>  <span class=mf>1.</span>  <span class=p>,</span>  <span class=mf>0.01</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.</span>  <span class=p>,</span>  <span class=mf>2.</span>  <span class=p>,</span> <span class=o>-</span><span class=mf>0.01</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.</span>  <span class=p>,</span>  <span class=mf>3.</span>  <span class=p>,</span>  <span class=mf>0.25</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.</span>  <span class=p>,</span>  <span class=mf>4.</span>  <span class=p>,</span> <span class=o>-</span><span class=mf>4.1</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.</span>  <span class=p>,</span>  <span class=mf>5.</span>  <span class=p>,</span>  <span class=mf>0.</span>  <span class=p>]])</span></span></span></code></pre></td></tr></table></div></div><p>你可能想Intercept是哪里来的。这是线性模型（比如普通最小二乘回归）的惯例用法。添加 +0 到模型可以不显示intercept：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span><span class=lnt id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>37</span><span class=p>]:</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;y ~ x0 + x1 + 0&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>37</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>x0</span>     <span class=n>x1</span>
</span></span><span class=line><span class=cl>   <span class=mi>1</span>   <span class=mf>0.01</span>
</span></span><span class=line><span class=cl>   <span class=mi>2</span>  <span class=o>-</span><span class=mf>0.01</span>
</span></span><span class=line><span class=cl>   <span class=mi>3</span>   <span class=mf>0.25</span>
</span></span><span class=line><span class=cl>   <span class=mi>4</span>  <span class=o>-</span><span class=mf>4.10</span>
</span></span><span class=line><span class=cl>   <span class=mi>5</span>   <span class=mf>0.00</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;x0&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;x1&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>Patsy对象可以直接传递到算法（比如numpy.linalg.lstsq）中，它执行普通最小二乘回归：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>38</span><span class=p>]:</span> <span class=n>coef</span><span class=p>,</span> <span class=n>resid</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>lstsq</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>模型的元数据保留在design_info属性中，因此你可以重新附加列名到拟合系数，以获得一个Series，例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>39</span><span class=p>]:</span> <span class=n>coef</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>39</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([[</span> <span class=mf>0.3129</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span><span class=o>-</span><span class=mf>0.0791</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span><span class=o>-</span><span class=mf>0.2655</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>40</span><span class=p>]:</span> <span class=n>coef</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>coef</span><span class=o>.</span><span class=n>squeeze</span><span class=p>(),</span> <span class=n>index</span><span class=o>=</span><span class=n>X</span><span class=o>.</span><span class=n>design_info</span><span class=o>.</span><span class=n>column_names</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>41</span><span class=p>]:</span> <span class=n>coef</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>41</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Intercept</span>    <span class=mf>0.312910</span>
</span></span><span class=line><span class=cl><span class=n>x0</span>          <span class=o>-</span><span class=mf>0.079106</span>
</span></span><span class=line><span class=cl><span class=n>x1</span>          <span class=o>-</span><span class=mf>0.265464</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><h3 id=1321-用patsy公式进行数据转换>13.2.1 用Patsy公式进行数据转换
<a class=header-anchor href=#1321-%e7%94%a8patsy%e5%85%ac%e5%bc%8f%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bd%ac%e6%8d%a2></a></h3><p>你可以将Python代码与patsy公式结合。在评估公式时，库将尝试查找在封闭作用域内使用的函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>42</span><span class=p>]:</span> <span class=n>y</span><span class=p>,</span> <span class=n>X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;y ~ x0 + np.log(np.abs(x1) + 1)&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>43</span><span class=p>]:</span> <span class=n>X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>43</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Intercept</span>  <span class=n>x0</span>  <span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>x1</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>1</span>                 <span class=mf>0.00995</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>2</span>                 <span class=mf>0.00995</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>3</span>                 <span class=mf>0.22314</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>4</span>                 <span class=mf>1.62924</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>   <span class=mi>5</span>                 <span class=mf>0.00000</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Intercept&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;x0&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;np.log(np.abs(x1) + 1)&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>2</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>常见的变量转换包括标准化（平均值为0，方差为1）和中心化（减去平均值）。Patsy有内置的函数进行这样的工作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>44</span><span class=p>]:</span> <span class=n>y</span><span class=p>,</span> <span class=n>X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;y ~ standardize(x0) + center(x1)&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>45</span><span class=p>]:</span> <span class=n>X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>45</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Intercept</span>  <span class=n>standardize</span><span class=p>(</span><span class=n>x0</span><span class=p>)</span>  <span class=n>center</span><span class=p>(</span><span class=n>x1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>         <span class=o>-</span><span class=mf>1.41421</span>        <span class=mf>0.78</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>         <span class=o>-</span><span class=mf>0.70711</span>        <span class=mf>0.76</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mf>0.00000</span>        <span class=mf>1.02</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mf>0.70711</span>       <span class=o>-</span><span class=mf>3.33</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mf>1.41421</span>        <span class=mf>0.77</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Intercept&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;standardize(x0)&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;center(x1)&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>2</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>作为建模的一步，你可能拟合模型到一个数据集，然后用另一个数据集评估模型。另一个数据集可能是剩余的部分或是新数据。当执行中心化和标准化转变，用新数据进行预测要格外小心。因为你必须使用平均值或标准差转换新数据集，这也称作状态转换。</p><p>patsy.build_design_matrices函数可以使用原始样本数据集的保存信息，来转换新数据，：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>46</span><span class=p>]:</span> <span class=n>new_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;x0&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;x1&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mf>3.1</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mf>2.3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;y&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>47</span><span class=p>]:</span> <span class=n>new_X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>build_design_matrices</span><span class=p>([</span><span class=n>X</span><span class=o>.</span><span class=n>design_info</span><span class=p>],</span> <span class=n>new_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>48</span><span class=p>]:</span> <span class=n>new_X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>48</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>Intercept</span>  <span class=n>standardize</span><span class=p>(</span><span class=n>x0</span><span class=p>)</span>  <span class=n>center</span><span class=p>(</span><span class=n>x1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>           <span class=mi>1</span>          <span class=mf>2.12132</span>        <span class=mf>3.87</span>
</span></span><span class=line><span class=cl>           <span class=mi>1</span>          <span class=mf>2.82843</span>        <span class=mf>0.27</span>
</span></span><span class=line><span class=cl>           <span class=mi>1</span>          <span class=mf>3.53553</span>        <span class=mf>0.77</span>
</span></span><span class=line><span class=cl>           <span class=mi>1</span>          <span class=mf>4.24264</span>        <span class=mf>3.07</span>
</span></span><span class=line><span class=cl>   <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>     <span class=s1>&#39;Intercept&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=s1>&#39;standardize(x0)&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=s1>&#39;center(x1)&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>2</span><span class=p>)]</span></span></span></code></pre></td></tr></table></div></div><p>因为Patsy中的加号不是加法的意义，当你按照名称将数据集的列相加时，你必须用特殊I函数将它们封装起来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>49</span><span class=p>]:</span> <span class=n>y</span><span class=p>,</span> <span class=n>X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;y ~ I(x0 + x1)&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>50</span><span class=p>]:</span> <span class=n>X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>50</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Intercept</span>  <span class=n>I</span><span class=p>(</span><span class=n>x0</span> <span class=o>+</span> <span class=n>x1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>        <span class=mf>1.01</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>        <span class=mf>1.99</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>        <span class=mf>3.25</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>       <span class=o>-</span><span class=mf>0.10</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>        <span class=mf>5.00</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Intercept&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;I(x0 + x1)&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>Patsy的patsy.builtins模块还有一些其它的内置转换。请查看线上文档。</p><p>分类数据有一个特殊的转换类，下面进行讲解。</p><h3 id=1322-分类数据和patsy>13.2.2 分类数据和Patsy
<a class=header-anchor href=#1322-%e5%88%86%e7%b1%bb%e6%95%b0%e6%8d%ae%e5%92%8cpatsy></a></h3><p>非数值数据可以用多种方式转换为模型设计矩阵。完整的讲解超出了本书范围，最好和统计课一起学习。</p><p>当你在Patsy公式中使用非数值数据，它们会默认转换为虚变量。如果有截距，会去掉一个，避免共线性：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>51</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;key1&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;key2&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;v1&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>],</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>     <span class=s1>&#39;v2&#39;</span><span class=p>:</span> <span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mf>2.5</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>4.0</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.2</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.7</span><span class=p>]</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>52</span><span class=p>]:</span> <span class=n>y</span><span class=p>,</span> <span class=n>X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;v2 ~ key1&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>53</span><span class=p>]:</span> <span class=n>X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>53</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Intercept</span>  <span class=n>key1</span><span class=p>[</span><span class=n>T</span><span class=o>.</span><span class=n>b</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Intercept&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key1&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>如果你从模型中忽略截距，每个分类值的列都会包括在设计矩阵的模型中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a>
</span><span class=lnt id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a>
</span><span class=lnt id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a>
</span><span class=lnt id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a>
</span><span class=lnt id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a>
</span><span class=lnt id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a>
</span><span class=lnt id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a>
</span><span class=lnt id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a>
</span><span class=lnt id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a>
</span><span class=lnt id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a>
</span><span class=lnt id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a>
</span><span class=lnt id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a>
</span><span class=lnt id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>54</span><span class=p>]:</span> <span class=n>y</span><span class=p>,</span> <span class=n>X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;v2 ~ key1 + 0&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>55</span><span class=p>]:</span> <span class=n>X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>55</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>key1</span><span class=p>[</span><span class=n>a</span><span class=p>]</span>  <span class=n>key1</span><span class=p>[</span><span class=n>b</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=mi>1</span>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=mi>1</span>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>        <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>        <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=mi>1</span>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>        <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=mi>1</span>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>        <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key1&#39;</span> <span class=p>(</span><span class=n>columns</span> <span class=mi>0</span><span class=p>:</span><span class=mi>2</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>使用C函数，数值列可以截取为分类量：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span><span class=lnt id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a>
</span><span class=lnt id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a>
</span><span class=lnt id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a>
</span><span class=lnt id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a>
</span><span class=lnt id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>56</span><span class=p>]:</span> <span class=n>y</span><span class=p>,</span> <span class=n>X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;v2 ~ C(key2)&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>57</span><span class=p>]:</span> <span class=n>X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>57</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Intercept</span>  <span class=n>C</span><span class=p>(</span><span class=n>key2</span><span class=p>)[</span><span class=n>T</span><span class=mf>.1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>             <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>             <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>             <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Intercept&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;C(key2)&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>当你在模型中使用多个分类名，事情就会变复杂，因为会包括key1:key2形式的相交部分，它可以用在方差（ANOVA）模型分析中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1> 1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2> 2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3> 3</a>
</span><span class=lnt id=hl-20-4><a class=lnlinks href=#hl-20-4> 4</a>
</span><span class=lnt id=hl-20-5><a class=lnlinks href=#hl-20-5> 5</a>
</span><span class=lnt id=hl-20-6><a class=lnlinks href=#hl-20-6> 6</a>
</span><span class=lnt id=hl-20-7><a class=lnlinks href=#hl-20-7> 7</a>
</span><span class=lnt id=hl-20-8><a class=lnlinks href=#hl-20-8> 8</a>
</span><span class=lnt id=hl-20-9><a class=lnlinks href=#hl-20-9> 9</a>
</span><span class=lnt id=hl-20-10><a class=lnlinks href=#hl-20-10>10</a>
</span><span class=lnt id=hl-20-11><a class=lnlinks href=#hl-20-11>11</a>
</span><span class=lnt id=hl-20-12><a class=lnlinks href=#hl-20-12>12</a>
</span><span class=lnt id=hl-20-13><a class=lnlinks href=#hl-20-13>13</a>
</span><span class=lnt id=hl-20-14><a class=lnlinks href=#hl-20-14>14</a>
</span><span class=lnt id=hl-20-15><a class=lnlinks href=#hl-20-15>15</a>
</span><span class=lnt id=hl-20-16><a class=lnlinks href=#hl-20-16>16</a>
</span><span class=lnt id=hl-20-17><a class=lnlinks href=#hl-20-17>17</a>
</span><span class=lnt id=hl-20-18><a class=lnlinks href=#hl-20-18>18</a>
</span><span class=lnt id=hl-20-19><a class=lnlinks href=#hl-20-19>19</a>
</span><span class=lnt id=hl-20-20><a class=lnlinks href=#hl-20-20>20</a>
</span><span class=lnt id=hl-20-21><a class=lnlinks href=#hl-20-21>21</a>
</span><span class=lnt id=hl-20-22><a class=lnlinks href=#hl-20-22>22</a>
</span><span class=lnt id=hl-20-23><a class=lnlinks href=#hl-20-23>23</a>
</span><span class=lnt id=hl-20-24><a class=lnlinks href=#hl-20-24>24</a>
</span><span class=lnt id=hl-20-25><a class=lnlinks href=#hl-20-25>25</a>
</span><span class=lnt id=hl-20-26><a class=lnlinks href=#hl-20-26>26</a>
</span><span class=lnt id=hl-20-27><a class=lnlinks href=#hl-20-27>27</a>
</span><span class=lnt id=hl-20-28><a class=lnlinks href=#hl-20-28>28</a>
</span><span class=lnt id=hl-20-29><a class=lnlinks href=#hl-20-29>29</a>
</span><span class=lnt id=hl-20-30><a class=lnlinks href=#hl-20-30>30</a>
</span><span class=lnt id=hl-20-31><a class=lnlinks href=#hl-20-31>31</a>
</span><span class=lnt id=hl-20-32><a class=lnlinks href=#hl-20-32>32</a>
</span><span class=lnt id=hl-20-33><a class=lnlinks href=#hl-20-33>33</a>
</span><span class=lnt id=hl-20-34><a class=lnlinks href=#hl-20-34>34</a>
</span><span class=lnt id=hl-20-35><a class=lnlinks href=#hl-20-35>35</a>
</span><span class=lnt id=hl-20-36><a class=lnlinks href=#hl-20-36>36</a>
</span><span class=lnt id=hl-20-37><a class=lnlinks href=#hl-20-37>37</a>
</span><span class=lnt id=hl-20-38><a class=lnlinks href=#hl-20-38>38</a>
</span><span class=lnt id=hl-20-39><a class=lnlinks href=#hl-20-39>39</a>
</span><span class=lnt id=hl-20-40><a class=lnlinks href=#hl-20-40>40</a>
</span><span class=lnt id=hl-20-41><a class=lnlinks href=#hl-20-41>41</a>
</span><span class=lnt id=hl-20-42><a class=lnlinks href=#hl-20-42>42</a>
</span><span class=lnt id=hl-20-43><a class=lnlinks href=#hl-20-43>43</a>
</span><span class=lnt id=hl-20-44><a class=lnlinks href=#hl-20-44>44</a>
</span><span class=lnt id=hl-20-45><a class=lnlinks href=#hl-20-45>45</a>
</span><span class=lnt id=hl-20-46><a class=lnlinks href=#hl-20-46>46</a>
</span><span class=lnt id=hl-20-47><a class=lnlinks href=#hl-20-47>47</a>
</span><span class=lnt id=hl-20-48><a class=lnlinks href=#hl-20-48>48</a>
</span><span class=lnt id=hl-20-49><a class=lnlinks href=#hl-20-49>49</a>
</span><span class=lnt id=hl-20-50><a class=lnlinks href=#hl-20-50>50</a>
</span><span class=lnt id=hl-20-51><a class=lnlinks href=#hl-20-51>51</a>
</span><span class=lnt id=hl-20-52><a class=lnlinks href=#hl-20-52>52</a>
</span><span class=lnt id=hl-20-53><a class=lnlinks href=#hl-20-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>58</span><span class=p>]:</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;key2&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;key2&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>map</span><span class=p>({</span><span class=mi>0</span><span class=p>:</span> <span class=s1>&#39;zero&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>:</span> <span class=s1>&#39;one&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>59</span><span class=p>]:</span> <span class=n>data</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>59</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>  <span class=n>key1</span>  <span class=n>key2</span>  <span class=n>v1</span>   <span class=n>v2</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=n>a</span>  <span class=n>zero</span>   <span class=mi>1</span> <span class=o>-</span><span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>a</span>   <span class=n>one</span>   <span class=mi>2</span>  <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=n>b</span>  <span class=n>zero</span>   <span class=mi>3</span>  <span class=mf>2.5</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>b</span>   <span class=n>one</span>   <span class=mi>4</span> <span class=o>-</span><span class=mf>0.5</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=n>a</span>  <span class=n>zero</span>   <span class=mi>5</span>  <span class=mf>4.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=n>b</span>   <span class=n>one</span>   <span class=mi>6</span> <span class=o>-</span><span class=mf>1.2</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>    <span class=n>a</span>  <span class=n>zero</span>   <span class=mi>7</span>  <span class=mf>0.2</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>    <span class=n>b</span>  <span class=n>zero</span>   <span class=mi>8</span> <span class=o>-</span><span class=mf>1.7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>60</span><span class=p>]:</span> <span class=n>y</span><span class=p>,</span> <span class=n>X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;v2 ~ key1 + key2&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>61</span><span class=p>]:</span> <span class=n>X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>61</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Intercept</span>  <span class=n>key1</span><span class=p>[</span><span class=n>T</span><span class=o>.</span><span class=n>b</span><span class=p>]</span>  <span class=n>key2</span><span class=p>[</span><span class=n>T</span><span class=o>.</span><span class=n>zero</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>             <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>             <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>             <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>             <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>             <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Intercept&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key1&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key2&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>62</span><span class=p>]:</span> <span class=n>y</span><span class=p>,</span> <span class=n>X</span> <span class=o>=</span> <span class=n>patsy</span><span class=o>.</span><span class=n>dmatrices</span><span class=p>(</span><span class=s1>&#39;v2 ~ key1 + key2 + key1:key2&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>63</span><span class=p>]:</span> <span class=n>X</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>63</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>DesignMatrix</span> <span class=k>with</span> <span class=n>shape</span> <span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Intercept</span>  <span class=n>key1</span><span class=p>[</span><span class=n>T</span><span class=o>.</span><span class=n>b</span><span class=p>]</span>  <span class=n>key2</span><span class=p>[</span><span class=n>T</span><span class=o>.</span><span class=n>zero</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>key1</span><span class=p>[</span><span class=n>T</span><span class=o>.</span><span class=n>b</span><span class=p>]:</span><span class=n>key2</span><span class=p>[</span><span class=n>T</span><span class=o>.</span><span class=n>zero</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>             <span class=mi>1</span>                       <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>             <span class=mi>0</span>                       <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>             <span class=mi>1</span>                       <span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>             <span class=mi>0</span>                       <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>             <span class=mi>1</span>                       <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>             <span class=mi>0</span>                       <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>0</span>             <span class=mi>1</span>                       <span class=mi>0</span>
</span></span><span class=line><span class=cl>          <span class=mi>1</span>          <span class=mi>1</span>             <span class=mi>1</span>                       <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=n>Terms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Intercept&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key1&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key2&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key1:key2&#39;</span> <span class=p>(</span><span class=n>column</span> <span class=mi>3</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>Patsy提供转换分类数据的其它方法，包括以特定顺序转换。请参阅线上文档。</p><h2 id=133-statsmodels介绍>13.3 statsmodels介绍
<a class=header-anchor href=#133-statsmodels%e4%bb%8b%e7%bb%8d></a></h2><p>statsmodels是Python进行拟合多种统计模型、进行统计试验和数据探索可视化的库。Statsmodels包含许多经典的统计方法，但没有贝叶斯方法和机器学习模型。</p><p>statsmodels包含的模型有：</p><ul><li>线性模型，广义线性模型和健壮线性模型</li><li>线性混合效应模型</li><li>方差（ANOVA）方法分析</li><li>时间序列过程和状态空间模型</li><li>广义矩估计</li></ul><p>下面，我会使用一些基本的statsmodels工具，探索Patsy公式和pandasDataFrame对象如何使用模型接口。</p><h3 id=1331-估计线性模型>13.3.1 估计线性模型
<a class=header-anchor href=#1331-%e4%bc%b0%e8%ae%a1%e7%ba%bf%e6%80%a7%e6%a8%a1%e5%9e%8b></a></h3><p>statsmodels有多种线性回归模型，包括从基本（比如普通最小二乘）到复杂（比如迭代加权最小二乘法）的。</p><p>statsmodels的线性模型有两种不同的接口：基于数组和基于公式。它们可以通过API模块引入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>statsmodels.api</span> <span class=k>as</span> <span class=nn>sm</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>statsmodels.formula.api</span> <span class=k>as</span> <span class=nn>smf</span></span></span></code></pre></td></tr></table></div></div><p>为了展示它们的使用方法，我们从一些随机数据生成一个线性模型：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span><span class=lnt id=hl-22-15><a class=lnlinks href=#hl-22-15>15</a>
</span><span class=lnt id=hl-22-16><a class=lnlinks href=#hl-22-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>dnorm</span><span class=p>(</span><span class=n>mean</span><span class=p>,</span> <span class=n>variance</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>size</span> <span class=o>=</span> <span class=n>size</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>mean</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>variance</span><span class=p>)</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=o>*</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># For reproducibility</span>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>12345</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>dnorm</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>N</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=n>dnorm</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mf>0.6</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>N</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=n>dnorm</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>N</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>eps</span> <span class=o>=</span> <span class=n>dnorm</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>beta</span> <span class=o>=</span> <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>beta</span><span class=p>)</span> <span class=o>+</span> <span class=n>eps</span></span></span></code></pre></td></tr></table></div></div><p>这里，我使用了“真实”模型和可知参数beta。此时，dnorm可用来生成正态分布数据，带有特定均值和方差。现在有：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>66</span><span class=p>]:</span> <span class=n>X</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>66</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([[</span><span class=o>-</span><span class=mf>0.1295</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.2128</span><span class=p>,</span>  <span class=mf>0.5042</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>0.3029</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.4357</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.2542</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span><span class=o>-</span><span class=mf>0.3285</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0253</span><span class=p>,</span>  <span class=mf>0.1384</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span><span class=o>-</span><span class=mf>0.3515</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.7196</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.2582</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.2433</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.3738</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5226</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>67</span><span class=p>]:</span> <span class=n>y</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>67</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span> <span class=mf>0.4279</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.6735</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0909</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.4895</span><span class=p>,</span><span class=o>-</span><span class=mf>0.1289</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>像之前Patsy看到的，线性模型通常要拟合一个截距。sm.add_constant函数可以添加一个截距的列到现存的矩阵：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1>1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2>2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3>3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4>4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5>5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6>6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7>7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8>8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>68</span><span class=p>]:</span> <span class=n>X_model</span> <span class=o>=</span> <span class=n>sm</span><span class=o>.</span><span class=n>add_constant</span><span class=p>(</span><span class=n>X</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>69</span><span class=p>]:</span> <span class=n>X_model</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>69</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([[</span> <span class=mf>1.</span>    <span class=p>,</span> <span class=o>-</span><span class=mf>0.1295</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.2128</span><span class=p>,</span>  <span class=mf>0.5042</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.</span>    <span class=p>,</span>  <span class=mf>0.3029</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.4357</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.2542</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.</span>    <span class=p>,</span> <span class=o>-</span><span class=mf>0.3285</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0253</span><span class=p>,</span>  <span class=mf>0.1384</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.</span>    <span class=p>,</span> <span class=o>-</span><span class=mf>0.3515</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.7196</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.2582</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span> <span class=mf>1.</span>    <span class=p>,</span>  <span class=mf>1.2433</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.3738</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5226</span><span class=p>]])</span></span></span></code></pre></td></tr></table></div></div><p>sm.OLS类可以拟合一个普通最小二乘回归：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>70</span><span class=p>]:</span> <span class=n>model</span> <span class=o>=</span> <span class=n>sm</span><span class=o>.</span><span class=n>OLS</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>X</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>这个模型的fit方法返回了一个回归结果对象，它包含估计的模型参数和其它内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>1</a>
</span><span class=lnt id=hl-26-2><a class=lnlinks href=#hl-26-2>2</a>
</span><span class=lnt id=hl-26-3><a class=lnlinks href=#hl-26-3>3</a>
</span><span class=lnt id=hl-26-4><a class=lnlinks href=#hl-26-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>71</span><span class=p>]:</span> <span class=n>results</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>72</span><span class=p>]:</span> <span class=n>results</span><span class=o>.</span><span class=n>params</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>72</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span> <span class=mf>0.1783</span><span class=p>,</span>  <span class=mf>0.223</span> <span class=p>,</span>  <span class=mf>0.501</span> <span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>对结果使用summary方法可以打印模型的详细诊断结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span><span class=lnt id=hl-27-12><a class=lnlinks href=#hl-27-12>12</a>
</span><span class=lnt id=hl-27-13><a class=lnlinks href=#hl-27-13>13</a>
</span><span class=lnt id=hl-27-14><a class=lnlinks href=#hl-27-14>14</a>
</span><span class=lnt id=hl-27-15><a class=lnlinks href=#hl-27-15>15</a>
</span><span class=lnt id=hl-27-16><a class=lnlinks href=#hl-27-16>16</a>
</span><span class=lnt id=hl-27-17><a class=lnlinks href=#hl-27-17>17</a>
</span><span class=lnt id=hl-27-18><a class=lnlinks href=#hl-27-18>18</a>
</span><span class=lnt id=hl-27-19><a class=lnlinks href=#hl-27-19>19</a>
</span><span class=lnt id=hl-27-20><a class=lnlinks href=#hl-27-20>20</a>
</span><span class=lnt id=hl-27-21><a class=lnlinks href=#hl-27-21>21</a>
</span><span class=lnt id=hl-27-22><a class=lnlinks href=#hl-27-22>22</a>
</span><span class=lnt id=hl-27-23><a class=lnlinks href=#hl-27-23>23</a>
</span><span class=lnt id=hl-27-24><a class=lnlinks href=#hl-27-24>24</a>
</span><span class=lnt id=hl-27-25><a class=lnlinks href=#hl-27-25>25</a>
</span><span class=lnt id=hl-27-26><a class=lnlinks href=#hl-27-26>26</a>
</span><span class=lnt id=hl-27-27><a class=lnlinks href=#hl-27-27>27</a>
</span><span class=lnt id=hl-27-28><a class=lnlinks href=#hl-27-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>73</span><span class=p>]:</span> <span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=o>.</span><span class=n>summary</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>OLS</span> <span class=n>Regression</span> <span class=n>Results</span>                            
</span></span><span class=line><span class=cl><span class=o>==============================================================================</span>
</span></span><span class=line><span class=cl><span class=n>Dep</span><span class=o>.</span> <span class=n>Variable</span><span class=p>:</span>                      <span class=n>y</span>   <span class=n>R</span><span class=o>-</span><span class=n>squared</span><span class=p>:</span>                       <span class=mf>0.430</span>
</span></span><span class=line><span class=cl><span class=n>Model</span><span class=p>:</span>                            <span class=n>OLS</span>   <span class=n>Adj</span><span class=o>.</span> <span class=n>R</span><span class=o>-</span><span class=n>squared</span><span class=p>:</span>                  <span class=mf>0.413</span>
</span></span><span class=line><span class=cl><span class=n>Method</span><span class=p>:</span>                 <span class=n>Least</span> <span class=n>Squares</span>   <span class=n>F</span><span class=o>-</span><span class=n>statistic</span><span class=p>:</span>                     <span class=mf>24.42</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=p>:</span>                <span class=n>Mon</span><span class=p>,</span> <span class=mi>25</span> <span class=n>Sep</span> <span class=mi>2017</span>   <span class=n>Prob</span> <span class=p>(</span><span class=n>F</span><span class=o>-</span><span class=n>statistic</span><span class=p>):</span>           <span class=mf>7.44e-12</span>
</span></span><span class=line><span class=cl><span class=n>Time</span><span class=p>:</span>                        <span class=mi>14</span><span class=p>:</span><span class=mi>06</span><span class=p>:</span><span class=mi>15</span>   <span class=n>Log</span><span class=o>-</span><span class=n>Likelihood</span><span class=p>:</span>                <span class=o>-</span><span class=mf>34.305</span>
</span></span><span class=line><span class=cl><span class=n>No</span><span class=o>.</span> <span class=n>Observations</span><span class=p>:</span>                 <span class=mi>100</span>   <span class=n>AIC</span><span class=p>:</span>                             <span class=mf>74.61</span>
</span></span><span class=line><span class=cl><span class=n>Df</span> <span class=n>Residuals</span><span class=p>:</span>                      <span class=mi>97</span>   <span class=n>BIC</span><span class=p>:</span>                             <span class=mf>82.42</span>
</span></span><span class=line><span class=cl><span class=n>Df</span> <span class=n>Model</span><span class=p>:</span>                           <span class=mi>3</span>                                         
</span></span><span class=line><span class=cl><span class=n>Covariance</span> <span class=n>Type</span><span class=p>:</span>            <span class=n>nonrobust</span>                                         
</span></span><span class=line><span class=cl><span class=o>==============================================================================</span>
</span></span><span class=line><span class=cl>                 <span class=n>coef</span>    <span class=n>std</span> <span class=n>err</span>          <span class=n>t</span>      <span class=n>P</span><span class=o>&gt;|</span><span class=n>t</span><span class=o>|</span>      <span class=p>[</span><span class=mf>0.025</span>      <span class=mf>0.975</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=n>x1</span>             <span class=mf>0.1783</span>      <span class=mf>0.053</span>      <span class=mf>3.364</span>      <span class=mf>0.001</span>       <span class=mf>0.073</span>       <span class=mf>0.283</span>
</span></span><span class=line><span class=cl><span class=n>x2</span>             <span class=mf>0.2230</span>      <span class=mf>0.046</span>      <span class=mf>4.818</span>      <span class=mf>0.000</span>       <span class=mf>0.131</span>       <span class=mf>0.315</span>
</span></span><span class=line><span class=cl><span class=n>x3</span>             <span class=mf>0.5010</span>      <span class=mf>0.080</span>      <span class=mf>6.237</span>      <span class=mf>0.000</span>       <span class=mf>0.342</span>       <span class=mf>0.660</span>
</span></span><span class=line><span class=cl><span class=o>==============================================================================</span>
</span></span><span class=line><span class=cl><span class=n>Omnibus</span><span class=p>:</span>                        <span class=mf>4.662</span>   <span class=n>Durbin</span><span class=o>-</span><span class=n>Watson</span><span class=p>:</span>                   <span class=mf>2.201</span>
</span></span><span class=line><span class=cl><span class=n>Prob</span><span class=p>(</span><span class=n>Omnibus</span><span class=p>):</span>                  <span class=mf>0.097</span>   <span class=n>Jarque</span><span class=o>-</span><span class=n>Bera</span> <span class=p>(</span><span class=n>JB</span><span class=p>):</span>                <span class=mf>4.098</span>
</span></span><span class=line><span class=cl><span class=n>Skew</span><span class=p>:</span>                           <span class=mf>0.481</span>   <span class=n>Prob</span><span class=p>(</span><span class=n>JB</span><span class=p>):</span>                        <span class=mf>0.129</span>
</span></span><span class=line><span class=cl><span class=n>Kurtosis</span><span class=p>:</span>                       <span class=mf>3.243</span>   <span class=n>Cond</span><span class=o>.</span> <span class=n>No</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=mf>1.74</span>
</span></span><span class=line><span class=cl><span class=o>==============================================================================</span>
</span></span><span class=line><span class=cl><span class=n>Warnings</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=n>Standard</span> <span class=n>Errors</span> <span class=n>assume</span> <span class=n>that</span> <span class=n>the</span> <span class=n>covariance</span> <span class=n>matrix</span> <span class=n>of</span> <span class=n>the</span> <span class=n>errors</span> <span class=ow>is</span> <span class=n>correctly</span> 
</span></span><span class=line><span class=cl><span class=n>specified</span><span class=o>.</span></span></span></code></pre></td></tr></table></div></div><p>这里的参数名为通用名x1, x2等等。假设所有的模型参数都在一个DataFrame中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>74</span><span class=p>]:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;col0&#39;</span><span class=p>,</span> <span class=s1>&#39;col1&#39;</span><span class=p>,</span> <span class=s1>&#39;col2&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>75</span><span class=p>]:</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;y&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>76</span><span class=p>]:</span> <span class=n>data</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>76</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>       <span class=n>col0</span>      <span class=n>col1</span>      <span class=n>col2</span>         <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=mi>0</span> <span class=o>-</span><span class=mf>0.129468</span> <span class=o>-</span><span class=mf>1.212753</span>  <span class=mf>0.504225</span>  <span class=mf>0.427863</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mf>0.302910</span> <span class=o>-</span><span class=mf>0.435742</span> <span class=o>-</span><span class=mf>0.254180</span> <span class=o>-</span><span class=mf>0.673480</span>
</span></span><span class=line><span class=cl><span class=mi>2</span> <span class=o>-</span><span class=mf>0.328522</span> <span class=o>-</span><span class=mf>0.025302</span>  <span class=mf>0.138351</span> <span class=o>-</span><span class=mf>0.090878</span>
</span></span><span class=line><span class=cl><span class=mi>3</span> <span class=o>-</span><span class=mf>0.351475</span> <span class=o>-</span><span class=mf>0.719605</span> <span class=o>-</span><span class=mf>0.258215</span> <span class=o>-</span><span class=mf>0.489494</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mf>1.243269</span> <span class=o>-</span><span class=mf>0.373799</span> <span class=o>-</span><span class=mf>0.522629</span> <span class=o>-</span><span class=mf>0.128941</span></span></span></code></pre></td></tr></table></div></div><p>现在，我们使用statsmodels的公式API和Patsy的公式字符串：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1> 1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2> 2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3> 3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4> 4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5> 5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6> 6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7> 7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8> 8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9> 9</a>
</span><span class=lnt id=hl-29-10><a class=lnlinks href=#hl-29-10>10</a>
</span><span class=lnt id=hl-29-11><a class=lnlinks href=#hl-29-11>11</a>
</span><span class=lnt id=hl-29-12><a class=lnlinks href=#hl-29-12>12</a>
</span><span class=lnt id=hl-29-13><a class=lnlinks href=#hl-29-13>13</a>
</span><span class=lnt id=hl-29-14><a class=lnlinks href=#hl-29-14>14</a>
</span><span class=lnt id=hl-29-15><a class=lnlinks href=#hl-29-15>15</a>
</span><span class=lnt id=hl-29-16><a class=lnlinks href=#hl-29-16>16</a>
</span><span class=lnt id=hl-29-17><a class=lnlinks href=#hl-29-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>77</span><span class=p>]:</span> <span class=n>results</span> <span class=o>=</span> <span class=n>smf</span><span class=o>.</span><span class=n>ols</span><span class=p>(</span><span class=s1>&#39;y ~ col0 + col1 + col2&#39;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>fit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>78</span><span class=p>]:</span> <span class=n>results</span><span class=o>.</span><span class=n>params</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>78</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Intercept</span>    <span class=mf>0.033559</span>
</span></span><span class=line><span class=cl><span class=n>col0</span>         <span class=mf>0.176149</span>
</span></span><span class=line><span class=cl><span class=n>col1</span>         <span class=mf>0.224826</span>
</span></span><span class=line><span class=cl><span class=n>col2</span>         <span class=mf>0.514808</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>79</span><span class=p>]:</span> <span class=n>results</span><span class=o>.</span><span class=n>tvalues</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>79</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>Intercept</span>    <span class=mf>0.952188</span>
</span></span><span class=line><span class=cl><span class=n>col0</span>         <span class=mf>3.319754</span>
</span></span><span class=line><span class=cl><span class=n>col1</span>         <span class=mf>4.850730</span>
</span></span><span class=line><span class=cl><span class=n>col2</span>         <span class=mf>6.303971</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>观察下statsmodels是如何返回Series结果的，附带有DataFrame的列名。当使用公式和pandas对象时，我们不需要使用add_constant。</p><p>给出一个样本外数据，你可以根据估计的模型参数计算预测值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1>1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2>2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3>3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4>4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5>5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6>6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7>7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>80</span><span class=p>]:</span> <span class=n>results</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>data</span><span class=p>[:</span><span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>80</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=o>-</span><span class=mf>0.002327</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=o>-</span><span class=mf>0.141904</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=mf>0.041226</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=o>-</span><span class=mf>0.323070</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=o>-</span><span class=mf>0.100535</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>statsmodels的线性模型结果还有其它的分析、诊断和可视化工具。除了普通最小二乘模型，还有其它的线性模型。</p><h3 id=1332-估计时间序列过程>13.3.2 估计时间序列过程
<a class=header-anchor href=#1332-%e4%bc%b0%e8%ae%a1%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97%e8%bf%87%e7%a8%8b></a></h3><p>statsmodels的另一模型类是进行时间序列分析，包括自回归过程、卡尔曼滤波和其它态空间模型，和多元自回归模型。</p><p>用自回归结构和噪声来模拟一些时间序列数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>init_x</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=n>values</span> <span class=o>=</span> <span class=p>[</span><span class=n>init_x</span><span class=p>,</span> <span class=n>init_x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>b0</span> <span class=o>=</span> <span class=mf>0.8</span>
</span></span><span class=line><span class=cl><span class=n>b1</span> <span class=o>=</span> <span class=o>-</span><span class=mf>0.4</span>
</span></span><span class=line><span class=cl><span class=n>noise</span> <span class=o>=</span> <span class=n>dnorm</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>new_x</span> <span class=o>=</span> <span class=n>values</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=n>b0</span> <span class=o>+</span> <span class=n>values</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>]</span> <span class=o>*</span> <span class=n>b1</span> <span class=o>+</span> <span class=n>noise</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>values</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>new_x</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>这个数据有AR(2)结构（两个延迟），参数是0.8和-0.4。拟合AR模型时，你可能不知道滞后项的个数，因此可以用较多的滞后量来拟合这个模型：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1>1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2>2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3>3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4>4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>82</span><span class=p>]:</span> <span class=n>MAXLAGS</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>83</span><span class=p>]:</span> <span class=n>model</span> <span class=o>=</span> <span class=n>sm</span><span class=o>.</span><span class=n>tsa</span><span class=o>.</span><span class=n>AR</span><span class=p>(</span><span class=n>values</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>84</span><span class=p>]:</span> <span class=n>results</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>MAXLAGS</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>结果中的估计参数首先是截距，其次是前两个参数的估计值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1>1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>85</span><span class=p>]:</span> <span class=n>results</span><span class=o>.</span><span class=n>params</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>85</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=o>-</span><span class=mf>0.0062</span><span class=p>,</span>  <span class=mf>0.7845</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.4085</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0136</span><span class=p>,</span>  <span class=mf>0.015</span> <span class=p>,</span>  <span class=mf>0.0143</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>更多的细节以及如何解释结果超出了本书的范围，可以通过statsmodels文档学习更多。</p><h2 id=134-scikit-learn介绍>13.4 scikit-learn介绍
<a class=header-anchor href=#134-scikit-learn%e4%bb%8b%e7%bb%8d></a></h2><p>scikit-learn是一个广泛使用、用途多样的Python机器学习库。它包含多种标准监督和非监督机器学习方法和模型选择和评估、数据转换、数据加载和模型持久化工具。这些模型可以用于分类、聚合、预测和其它任务。</p><p>机器学习方面的学习和应用scikit-learn和TensorFlow解决实际问题的线上和纸质资料很多。本节中，我会简要介绍scikit-learn API的风格。</p><p>写作此书的时候，scikit-learn并没有和pandas深度结合，但是有些第三方包在开发中。尽管如此，pandas非常适合在模型拟合前处理数据集。</p><p>举个例子，我用一个Kaggle竞赛的经典数据集，关于泰坦尼克号乘客的生还率。我们用pandas加载测试和训练数据集：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1> 1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2> 2</a>
</span><span class=lnt id=hl-34-3><a class=lnlinks href=#hl-34-3> 3</a>
</span><span class=lnt id=hl-34-4><a class=lnlinks href=#hl-34-4> 4</a>
</span><span class=lnt id=hl-34-5><a class=lnlinks href=#hl-34-5> 5</a>
</span><span class=lnt id=hl-34-6><a class=lnlinks href=#hl-34-6> 6</a>
</span><span class=lnt id=hl-34-7><a class=lnlinks href=#hl-34-7> 7</a>
</span><span class=lnt id=hl-34-8><a class=lnlinks href=#hl-34-8> 8</a>
</span><span class=lnt id=hl-34-9><a class=lnlinks href=#hl-34-9> 9</a>
</span><span class=lnt id=hl-34-10><a class=lnlinks href=#hl-34-10>10</a>
</span><span class=lnt id=hl-34-11><a class=lnlinks href=#hl-34-11>11</a>
</span><span class=lnt id=hl-34-12><a class=lnlinks href=#hl-34-12>12</a>
</span><span class=lnt id=hl-34-13><a class=lnlinks href=#hl-34-13>13</a>
</span><span class=lnt id=hl-34-14><a class=lnlinks href=#hl-34-14>14</a>
</span><span class=lnt id=hl-34-15><a class=lnlinks href=#hl-34-15>15</a>
</span><span class=lnt id=hl-34-16><a class=lnlinks href=#hl-34-16>16</a>
</span><span class=lnt id=hl-34-17><a class=lnlinks href=#hl-34-17>17</a>
</span><span class=lnt id=hl-34-18><a class=lnlinks href=#hl-34-18>18</a>
</span><span class=lnt id=hl-34-19><a class=lnlinks href=#hl-34-19>19</a>
</span><span class=lnt id=hl-34-20><a class=lnlinks href=#hl-34-20>20</a>
</span><span class=lnt id=hl-34-21><a class=lnlinks href=#hl-34-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>86</span><span class=p>]:</span> <span class=n>train</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;datasets/titanic/train.csv&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>87</span><span class=p>]:</span> <span class=n>test</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;datasets/titanic/test.csv&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>88</span><span class=p>]:</span> <span class=n>train</span><span class=p>[:</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>88</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>PassengerId</span>  <span class=n>Survived</span>  <span class=n>Pclass</span>  \
</span></span><span class=line><span class=cl><span class=mi>0</span>            <span class=mi>1</span>         <span class=mi>0</span>       <span class=mi>3</span>   
</span></span><span class=line><span class=cl><span class=mi>1</span>            <span class=mi>2</span>         <span class=mi>1</span>       <span class=mi>1</span>   
</span></span><span class=line><span class=cl><span class=mi>2</span>            <span class=mi>3</span>         <span class=mi>1</span>       <span class=mi>3</span>   
</span></span><span class=line><span class=cl><span class=mi>3</span>            <span class=mi>4</span>         <span class=mi>1</span>       <span class=mi>1</span>   
</span></span><span class=line><span class=cl>                                                <span class=n>Name</span>     <span class=n>Sex</span>   <span class=n>Age</span>  <span class=n>SibSp</span>  \
</span></span><span class=line><span class=cl><span class=mi>0</span>                            <span class=n>Braund</span><span class=p>,</span> <span class=n>Mr</span><span class=o>.</span> <span class=n>Owen</span> <span class=n>Harris</span>    <span class=n>male</span>  <span class=mf>22.0</span>      <span class=mi>1</span>   
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=n>Cumings</span><span class=p>,</span> <span class=n>Mrs</span><span class=o>.</span> <span class=n>John</span> <span class=n>Bradley</span> <span class=p>(</span><span class=n>Florence</span> <span class=n>Briggs</span> <span class=n>Th</span><span class=o>...</span>  <span class=n>female</span>  <span class=mf>38.0</span>      <span class=mi>1</span>   
</span></span><span class=line><span class=cl><span class=mi>2</span>                             <span class=n>Heikkinen</span><span class=p>,</span> <span class=n>Miss</span><span class=o>.</span> <span class=n>Laina</span>  <span class=n>female</span>  <span class=mf>26.0</span>      <span class=mi>0</span>   
</span></span><span class=line><span class=cl><span class=mi>3</span>       <span class=n>Futrelle</span><span class=p>,</span> <span class=n>Mrs</span><span class=o>.</span> <span class=n>Jacques</span> <span class=n>Heath</span> <span class=p>(</span><span class=n>Lily</span> <span class=n>May</span> <span class=n>Peel</span><span class=p>)</span>  <span class=n>female</span>  <span class=mf>35.0</span>      <span class=mi>1</span>   
</span></span><span class=line><span class=cl>   <span class=n>Parch</span>            <span class=n>Ticket</span>     <span class=n>Fare</span> <span class=n>Cabin</span> <span class=n>Embarked</span>  
</span></span><span class=line><span class=cl><span class=mi>0</span>      <span class=mi>0</span>         <span class=n>A</span><span class=o>/</span><span class=mi>5</span> <span class=mi>21171</span>   <span class=mf>7.2500</span>   <span class=n>NaN</span>        <span class=n>S</span>  
</span></span><span class=line><span class=cl><span class=mi>1</span>      <span class=mi>0</span>          <span class=n>PC</span> <span class=mi>17599</span>  <span class=mf>71.2833</span>   <span class=n>C85</span>        <span class=n>C</span>  
</span></span><span class=line><span class=cl><span class=mi>2</span>      <span class=mi>0</span>  <span class=n>STON</span><span class=o>/</span><span class=n>O2</span><span class=o>.</span> <span class=mi>3101282</span>   <span class=mf>7.9250</span>   <span class=n>NaN</span>        <span class=n>S</span>  
</span></span><span class=line><span class=cl><span class=mi>3</span>      <span class=mi>0</span>            <span class=mi>113803</span>  <span class=mf>53.1000</span>  <span class=n>C123</span>        <span class=n>S</span></span></span></code></pre></td></tr></table></div></div><p>statsmodels和scikit-learn通常不能接收缺失数据，因此我们要查看列是否包含缺失值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>89</span><span class=p>]:</span> <span class=n>train</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>89</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>PassengerId</span>      <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Survived</span>         <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Pclass</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Name</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Sex</span>              <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Age</span>            <span class=mi>177</span>
</span></span><span class=line><span class=cl><span class=n>SibSp</span>            <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Parch</span>            <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Ticket</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Fare</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Cabin</span>          <span class=mi>687</span>
</span></span><span class=line><span class=cl><span class=n>Embarked</span>         <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>90</span><span class=p>]:</span> <span class=n>test</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>90</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>PassengerId</span>      <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Pclass</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Name</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Sex</span>              <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Age</span>             <span class=mi>86</span>
</span></span><span class=line><span class=cl><span class=n>SibSp</span>            <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Parch</span>            <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Ticket</span>           <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Fare</span>             <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Cabin</span>          <span class=mi>327</span>
</span></span><span class=line><span class=cl><span class=n>Embarked</span>         <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int64</span></span></span></code></pre></td></tr></table></div></div><p>在统计和机器学习的例子中，根据数据中的特征，一个典型的任务是预测乘客能否生还。模型现在训练数据集中拟合，然后用样本外测试数据集评估。</p><p>我想用年龄作为预测值，但是它包含缺失值。缺失数据补全的方法有多种，我用的是一种简单方法，用训练数据集的中位数补全两个表的空值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1>1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2>2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3>3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4>4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>91</span><span class=p>]:</span> <span class=n>impute_value</span> <span class=o>=</span> <span class=n>train</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>median</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>92</span><span class=p>]:</span> <span class=n>train</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>train</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>impute_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>93</span><span class=p>]:</span> <span class=n>test</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>test</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>impute_value</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>现在我们需要指定模型。我增加了一个列IsFemale，作为“Sex”列的编码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1>1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2>2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>94</span><span class=p>]:</span> <span class=n>train</span><span class=p>[</span><span class=s1>&#39;IsFemale&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>train</span><span class=p>[</span><span class=s1>&#39;Sex&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;female&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>95</span><span class=p>]:</span> <span class=n>test</span><span class=p>[</span><span class=s1>&#39;IsFemale&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>test</span><span class=p>[</span><span class=s1>&#39;Sex&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;female&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>然后，我们确定一些模型变量，并创建NumPy数组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1> 1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2> 2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3> 3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4> 4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5> 5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6> 6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7> 7</a>
</span><span class=lnt id=hl-38-8><a class=lnlinks href=#hl-38-8> 8</a>
</span><span class=lnt id=hl-38-9><a class=lnlinks href=#hl-38-9> 9</a>
</span><span class=lnt id=hl-38-10><a class=lnlinks href=#hl-38-10>10</a>
</span><span class=lnt id=hl-38-11><a class=lnlinks href=#hl-38-11>11</a>
</span><span class=lnt id=hl-38-12><a class=lnlinks href=#hl-38-12>12</a>
</span><span class=lnt id=hl-38-13><a class=lnlinks href=#hl-38-13>13</a>
</span><span class=lnt id=hl-38-14><a class=lnlinks href=#hl-38-14>14</a>
</span><span class=lnt id=hl-38-15><a class=lnlinks href=#hl-38-15>15</a>
</span><span class=lnt id=hl-38-16><a class=lnlinks href=#hl-38-16>16</a>
</span><span class=lnt id=hl-38-17><a class=lnlinks href=#hl-38-17>17</a>
</span><span class=lnt id=hl-38-18><a class=lnlinks href=#hl-38-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>96</span><span class=p>]:</span> <span class=n>predictors</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Pclass&#39;</span><span class=p>,</span> <span class=s1>&#39;IsFemale&#39;</span><span class=p>,</span> <span class=s1>&#39;Age&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>97</span><span class=p>]:</span> <span class=n>X_train</span> <span class=o>=</span> <span class=n>train</span><span class=p>[</span><span class=n>predictors</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>98</span><span class=p>]:</span> <span class=n>X_test</span> <span class=o>=</span> <span class=n>test</span><span class=p>[</span><span class=n>predictors</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>99</span><span class=p>]:</span> <span class=n>y_train</span> <span class=o>=</span> <span class=n>train</span><span class=p>[</span><span class=s1>&#39;Survived&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>100</span><span class=p>]:</span> <span class=n>X_train</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>100</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>array</span><span class=p>([[</span>  <span class=mf>3.</span><span class=p>,</span>   <span class=mf>0.</span><span class=p>,</span>  <span class=mf>22.</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span>  <span class=mf>1.</span><span class=p>,</span>   <span class=mf>1.</span><span class=p>,</span>  <span class=mf>38.</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span>  <span class=mf>3.</span><span class=p>,</span>   <span class=mf>1.</span><span class=p>,</span>  <span class=mf>26.</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span>  <span class=mf>1.</span><span class=p>,</span>   <span class=mf>1.</span><span class=p>,</span>  <span class=mf>35.</span><span class=p>],</span>
</span></span><span class=line><span class=cl>       <span class=p>[</span>  <span class=mf>3.</span><span class=p>,</span>   <span class=mf>0.</span><span class=p>,</span>  <span class=mf>35.</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>101</span><span class=p>]:</span> <span class=n>y_train</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>101</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>我不能保证这是一个好模型，但它的特征都符合。我们用scikit-learn的LogisticRegression模型，创建一个模型实例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1>1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2>2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>102</span><span class=p>]:</span> <span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>LogisticRegression</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>103</span><span class=p>]:</span> <span class=n>model</span> <span class=o>=</span> <span class=n>LogisticRegression</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>与statsmodels类似，我们可以用模型的fit方法，将它拟合到训练数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1>1</a>
</span><span class=lnt id=hl-40-2><a class=lnlinks href=#hl-40-2>2</a>
</span><span class=lnt id=hl-40-3><a class=lnlinks href=#hl-40-3>3</a>
</span><span class=lnt id=hl-40-4><a class=lnlinks href=#hl-40-4>4</a>
</span><span class=lnt id=hl-40-5><a class=lnlinks href=#hl-40-5>5</a>
</span><span class=lnt id=hl-40-6><a class=lnlinks href=#hl-40-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>104</span><span class=p>]:</span> <span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>104</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>LogisticRegression</span><span class=p>(</span><span class=n>C</span><span class=o>=</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>class_weight</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>dual</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>fit_intercept</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=n>intercept_scaling</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_iter</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>multi_class</span><span class=o>=</span><span class=s1>&#39;ovr&#39;</span><span class=p>,</span> <span class=n>n_jobs</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=n>penalty</span><span class=o>=</span><span class=s1>&#39;l2&#39;</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>solver</span><span class=o>=</span><span class=s1>&#39;liblinear&#39;</span><span class=p>,</span> <span class=n>tol</span><span class=o>=</span><span class=mf>0.0001</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=n>verbose</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>warm_start</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>现在，我们可以用model.predict，对测试数据进行预测：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1>1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2>2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3>3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>105</span><span class=p>]:</span> <span class=n>y_predict</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>X_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>106</span><span class=p>]:</span> <span class=n>y_predict</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>106</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>如果你有测试数据集的真是值，你可以计算准确率或其它错误度量值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>(</span><span class=n>y_true</span> <span class=o>==</span> <span class=n>y_predict</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>在实际中，模型训练经常有许多额外的复杂因素。许多模型有可以调节的参数，有些方法（比如交叉验证）可以用来进行参数调节，避免对训练数据过拟合。这通常可以提高预测性或对新数据的健壮性。</p><p>交叉验证通过分割训练数据来模拟样本外预测。基于模型的精度得分（比如均方差），可以对模型参数进行网格搜索。有些模型，如logistic回归，有内置的交叉验证的估计类。例如，logisticregressioncv类可以用一个参数指定网格搜索对模型的正则化参数C的粒度：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1> 1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2> 2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3> 3</a>
</span><span class=lnt id=hl-43-4><a class=lnlinks href=#hl-43-4> 4</a>
</span><span class=lnt id=hl-43-5><a class=lnlinks href=#hl-43-5> 5</a>
</span><span class=lnt id=hl-43-6><a class=lnlinks href=#hl-43-6> 6</a>
</span><span class=lnt id=hl-43-7><a class=lnlinks href=#hl-43-7> 7</a>
</span><span class=lnt id=hl-43-8><a class=lnlinks href=#hl-43-8> 8</a>
</span><span class=lnt id=hl-43-9><a class=lnlinks href=#hl-43-9> 9</a>
</span><span class=lnt id=hl-43-10><a class=lnlinks href=#hl-43-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>107</span><span class=p>]:</span> <span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>LogisticRegressionCV</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>108</span><span class=p>]:</span> <span class=n>model_cv</span> <span class=o>=</span> <span class=n>LogisticRegressionCV</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>109</span><span class=p>]:</span> <span class=n>model_cv</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>109</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>LogisticRegressionCV</span><span class=p>(</span><span class=n>Cs</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>class_weight</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>cv</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>dual</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>           <span class=n>fit_intercept</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>intercept_scaling</span><span class=o>=</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>max_iter</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>           <span class=n>multi_class</span><span class=o>=</span><span class=s1>&#39;ovr&#39;</span><span class=p>,</span> <span class=n>n_jobs</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>penalty</span><span class=o>=</span><span class=s1>&#39;l2&#39;</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>           <span class=n>refit</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>scoring</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>solver</span><span class=o>=</span><span class=s1>&#39;lbfgs&#39;</span><span class=p>,</span> <span class=n>tol</span><span class=o>=</span><span class=mf>0.0001</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>要手动进行交叉验证，你可以使用cross_val_score帮助函数，它可以处理数据分割。例如，要交叉验证我们的带有四个不重叠训练数据的模型，可以这样做：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1>1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2>2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3>3</a>
</span><span class=lnt id=hl-44-4><a class=lnlinks href=#hl-44-4>4</a>
</span><span class=lnt id=hl-44-5><a class=lnlinks href=#hl-44-5>5</a>
</span><span class=lnt id=hl-44-6><a class=lnlinks href=#hl-44-6>6</a>
</span><span class=lnt id=hl-44-7><a class=lnlinks href=#hl-44-7>7</a>
</span><span class=lnt id=hl-44-8><a class=lnlinks href=#hl-44-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>110</span><span class=p>]:</span> <span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>cross_val_score</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>111</span><span class=p>]:</span> <span class=n>model</span> <span class=o>=</span> <span class=n>LogisticRegression</span><span class=p>(</span><span class=n>C</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>112</span><span class=p>]:</span> <span class=n>scores</span> <span class=o>=</span> <span class=n>cross_val_score</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>X_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>cv</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>113</span><span class=p>]:</span> <span class=n>scores</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>113</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span> <span class=mf>0.7723</span><span class=p>,</span>  <span class=mf>0.8027</span><span class=p>,</span>  <span class=mf>0.7703</span><span class=p>,</span>  <span class=mf>0.7883</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>默认的评分指标取决于模型本身，但是可以明确指定一个评分。交叉验证过的模型需要更长时间来训练，但会有更高的模型性能。</p><h2 id=135-继续学习>13.5 继续学习
<a class=header-anchor href=#135-%e7%bb%a7%e7%bb%ad%e5%ad%a6%e4%b9%a0></a></h2><p>我只是介绍了一些Python建模库的表面内容，现在有越来越多的框架用于各种统计和机器学习，它们都是用Python或Python用户界面实现的。</p><p>这本书的重点是数据规整，有其它的书是关注建模和数据科学工具的。其中优秀的有：</p><ul><li>Andreas Mueller and Sarah Guido (O’Reilly)的 《Introduction to Machine Learning with Python》</li><li>Jake VanderPlas (O’Reilly)的 《Python Data Science Handbook》</li><li>Joel Grus (O’Reilly) 的 《Data Science from Scratch: First Principles》</li><li>Sebastian Raschka (Packt Publishing) 的《Python Machine Learning》</li><li>Aurélien Géron (O’Reilly) 的《Hands-On Machine Learning with Scikit-Learn and TensorFlow》</li></ul><p>虽然书是学习的好资源，但是随着底层开源软件的发展，书的内容会过时。最好是不断熟悉各种统计和机器学习框架的文档，学习最新的功能和API。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/python/>python</a></div><div class=post-share-tools><div class=post-share-loading><i class="fa-solid fa-ellipsis fa-spin"></i></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class=a2a_dd href=https://www.addtoany.com/share></a><a class=a2a_button_wechat></a><a class=a2a_button_qzone></a><a class=a2a_button_sina_weibo></a><a class=a2a_button_douban></a><a class=a2a_button_facebook></a><a class=a2a_button_x></a><a class=a2a_button_email></a><a class=a2a_button_printfriendly></a></div></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="Rich - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="Rich - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
第十三章 Python 建模库介绍</li><li class=post-copyright-author><strong>本文作者： </strong>Rich</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=http://localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch13-python%E5%BB%BA%E6%A8%A1%E5%BA%93%E4%BB%8B%E7%BB%8D/ title="第十三章 Python 建模库介绍">http://localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch13-python%E5%BB%BA%E6%A8%A1%E5%BA%93%E4%BB%8B%E7%BB%8D/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/white.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/rss.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch12-pandas%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/ rel=next title="第十二章 Pandas 高级应用"><i class="fa fa-chevron-left"></i> 第十二章 Pandas 高级应用</a></div><div class="post-nav-prev post-nav-item"><a href=/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch14-%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%A1%88%E4%BE%8B/ rel=prev title="第十四章 数据分析案例">第十四章 数据分析案例
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=i18n-translate class=i18n-translate><i class="fa fa-language"></i><div id=lang-select class=lang-select><div id=lang-selected class=selected-option><span class="flag-icon flag-icon-zh-cn"></span>
<span class=selected-language>简体中文</span>
<i class="fa fa-chevron-down"></i></div><div id=lang-options class=lang-options><div class=lang-option lang-code=zh-cn lang-name=简体中文 lang-url=/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch13-python%E5%BB%BA%E6%A8%A1%E5%BA%93%E4%BB%8B%E7%BB%8D/><span class="flag-icon flag-icon-zh-cn"></span>
<span class=lang-name>简体中文</span></div></div></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rich</span></div></div></footer><script class=next-config data-name=page type=application/json>{"clipboard":{"js":{"alias":"clipboard","file":"dist/clipboard.min.js","name":"clipboard.js","version":"2.0.11"}},"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"ch13-python%E5%BB%BA%E6%A8%A1%E5%BA%93%E4%BB%8B%E7%BB%8D","permalink":"http://localhost:1313/post/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch13-python%E5%BB%BA%E6%A8%A1%E5%BA%93%E4%BB%8B%E7%BB%8D/","title":"第十三章 Python 建模库介绍","toc":true}</script><script type=text/javascript src=http://localhost:1313/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=http://localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"algolia":{"cfg":{"apikey":"24dfda5a193a1833e5b17606053cdc78","appid":"HP3W07LYYY","enable":true,"hits":{"perpage":10},"indexname":"hugo","limit":1e3},"instantjs":{"file":"dist/instantsearch.production.min.js","name":"instantsearch.js","version":"4.73.2"},"js":{"file":"dist/algoliasearch-lite.umd.js","name":"algoliasearch","version":"4.24.0"}},"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"hostname":"http://localhost:1313/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":true,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"slideInRight","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":true},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"http://localhost:1313/js/3rd"}},"version":"4.8.3","waline":{"cfg":{"category":"General","categoryid":"DIC_kwDOOaTx8c4CrmZE","emit":false,"emoji":false,"imguploader":false,"inputposition":"top","mapping":"title","placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactions":false,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","repo":"richbridge/hugo-next","repoid":"R_kgDOOaTx8Q","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","theme":"preferred_color_scheme","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src="/js/main.js?=1750143568" defer></script><script type=text/javascript src="/js/clipboard.js?=1750143569" defer></script></body></html>