<!doctype html><html lang=zh-CN data-theme=dark><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.147.7"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="第十二章 Pandas 高级应用"><meta itemprop=description content="保持简单的易用性和强大的功能。"><meta name=description content="保持简单的易用性和强大的功能。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif"><meta itemprop=keywords content="python"><meta property="og:type" content="article"><meta property="og:title" content="第十二章 Pandas 高级应用"><meta property="og:description" content="保持简单的易用性和强大的功能。"><meta property="og:image" content="https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="//localhost:1313/chinese/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch12-pandas%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/"><meta property="og:site_name" content="樊尘刹记"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rich"><meta property="article:published_time" content="2023-09-25 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2023-09-25 00:00:00 +0000 UTC"><link type=text/css rel=stylesheet href=//localhost:1313/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=//localhost:1313/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=//localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.css?=1750130235"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><link rel=stylesheet type=text/css href="/css/custom_style.css?=1750130235"><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>第十二章 Pandas 高级应用 - 樊尘刹记</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>樊尘刹记</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>红尘湮灭，唯有尘刹</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-flinks"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>友情链接</a></li><li class="menu-item menu-item-example"><a href=/ class="menus-parent hvr-icon-pulse" rel=section><i class="fa fa-angles-down hvr-icon"></i>语法示例
<span class=menu-item-shrink-icon><i class="fa fa-angle-right"></i></span></a><ul class=menu-children><li class=menu-child-item><a href=/ class=hvr-icon-pulse rel=section><i class="fa hvr-icon"></i>语法高亮</a></li><li class=menu-child-item><a href=/ class=hvr-icon-pulse rel=section><i class="fa hvr-icon"></i>数学公式</a></li><li class=menu-child-item><a href=/ class=hvr-icon-pulse rel=section><i class="fa hvr-icon"></i>流程图</a></li></ul></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>0</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#121-分类数据>12.1 分类数据</a><ul><li><a href=#1211-背景和目的>12.1.1 背景和目的</a></li><li><a href=#1212-pandas的分类类型>12.1.2 pandas的分类类型</a></li><li><a href=#1213-用分类进行计算>12.1.3 用分类进行计算</a></li><li><a href=#1214-用分类提高性能>12.1.4 用分类提高性能</a></li><li><a href=#1215-分类方法>12.1.5 分类方法</a></li><li><a href=#1216-为建模创建虚拟变量>12.1.6 为建模创建虚拟变量</a></li></ul></li><li><a href=#122-groupby高级应用>12.2 GroupBy高级应用</a><ul><li><a href=#1221-分组转换和解封groupby>12.2.1 分组转换和“解封”GroupBy</a></li><li><a href=#1222-分组的时间重采样>12.2.2 分组的时间重采样</a></li></ul></li><li><a href=#123-链式编程技术>12.3 链式编程技术</a><ul><li><a href=#1231-管道方法>12.3.1 管道方法</a></li></ul></li><li><a href=#124-总结>12.4 总结</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rich src=/imgs/img-lazy-loading.gif data-src=https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif><p class=site-author-name itemprop=name>Rich</p><div class=site-description itemprop=description>保持简单的易用性和强大的功能。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>0</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>8</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>99</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/richbridge title="Github → https://github.com/richbridge" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/richfan-38 title="知乎 → https://www.zhihu.com/people/richfan-38" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div><div class="mydefined animated" itemprop=custom><span>支持自定义CSS和Sidebar布局啦💄💄💄</span></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-i18n-translate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/richbridge rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=//localhost:1313/chinese/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch12-pandas%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="https://jsd.cdn.zzko.cn/gh/richbridge/picx-images-hosting@master/avatar.avif"><meta itemprop=name content="Rich"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rich"><meta itemprop=description content="保持简单的易用性和强大的功能。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="第十二章 Pandas 高级应用"><meta itemprop=description content="前面的章节关注于不同类型的数据规整流程和NumPy、pandas与其它库的特点。随着时间的发展，pandas发展出了更多适合高级用户的功能。本章就要深入学习pandas的高级功能。"></span><header class=post-header><h1 class=post-title itemprop="name headline">第十二章 Pandas 高级应用</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023-09-25 00:00:00 +00:00" itemprop="dateCreated datePublished" datetime="2023-09-25 00:00:00 +0000 UTC">2023-09-25
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E7%A8%8B%E6%8A%80/ itemprop=url rel=index><span itemprop=name>程技</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>6003</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>12分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/chinese/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch12-pandas%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>前面的章节关注于不同类型的数据规整流程和NumPy、pandas与其它库的特点。随着时间的发展，pandas发展出了更多适合高级用户的功能。本章就要深入学习pandas的高级功能。</p><a id=more></a><h2 id=121-分类数据>12.1 分类数据
<a class=header-anchor href=#121-%e5%88%86%e7%b1%bb%e6%95%b0%e6%8d%ae></a></h2><p>这一节介绍的是pandas的分类类型。我会向你展示通过使用它，提高性能和内存的使用率。我还会介绍一些在统计和机器学习中使用分类数据的工具。</p><h3 id=1211-背景和目的>12.1.1 背景和目的
<a class=header-anchor href=#1211-%e8%83%8c%e6%99%af%e5%92%8c%e7%9b%ae%e7%9a%84></a></h3><p>表中的一列通常会有重复的包含不同值的小集合的情况。我们已经学过了unique和value_counts，它们可以从数组提取出不同的值，并分别计算频率：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span><span class=lnt id=hl-0-24><a class=lnlinks href=#hl-0-24>24</a>
</span><span class=lnt id=hl-0-25><a class=lnlinks href=#hl-0-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>10</span><span class=p>]:</span> <span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span><span class=p>;</span> <span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>11</span><span class=p>]:</span> <span class=n>values</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=s1>&#39;apple&#39;</span><span class=p>,</span> <span class=s1>&#39;orange&#39;</span><span class=p>,</span> <span class=s1>&#39;apple&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                     <span class=s1>&#39;apple&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>12</span><span class=p>]:</span> <span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>12</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>orange</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=n>orange</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>13</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>values</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>13</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=s1>&#39;apple&#39;</span><span class=p>,</span> <span class=s1>&#39;orange&#39;</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>object</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>14</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>value_counts</span><span class=p>(</span><span class=n>values</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>14</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>apple</span>     <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>orange</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int64</span></span></span></code></pre></td></tr></table></div></div><p>许多数据系统（数据仓库、统计计算或其它应用）都发展出了特定的表征重复值的方法，以进行高效的存储和计算。在数据仓库中，最好的方法是使用所谓的包含不同值的维表(Dimension Table)，将主要的参数存储为引用维表整数键：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>15</span><span class=p>]:</span> <span class=n>values</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>16</span><span class=p>]:</span> <span class=n>dim</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=s1>&#39;apple&#39;</span><span class=p>,</span> <span class=s1>&#39;orange&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>17</span><span class=p>]:</span> <span class=n>values</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>17</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>18</span><span class=p>]:</span> <span class=n>dim</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>18</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>orange</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span></span></span></code></pre></td></tr></table></div></div><p>可以使用take方法存储原始的字符串Series：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>19</span><span class=p>]:</span> <span class=n>dim</span><span class=o>.</span><span class=n>take</span><span class=p>(</span><span class=n>values</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>19</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>orange</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>orange</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=nb>object</span></span></span></code></pre></td></tr></table></div></div><p>这种用整数表示的方法称为分类或字典编码表示法。不同值得数组称为分类、字典或数据级。本书中，我们使用分类的说法。表示分类的整数值称为分类编码或简单地称为编码。</p><p>分类表示可以在进行分析时大大的提高性能。你也可以在保持编码不变的情况下，对分类进行转换。一些相对简单的转变例子包括：</p><ul><li>重命名分类。</li><li>加入一个新的分类，不改变已经存在的分类的顺序或位置。</li></ul><h3 id=1212-pandas的分类类型>12.1.2 pandas的分类类型
<a class=header-anchor href=#1212-pandas%e7%9a%84%e5%88%86%e7%b1%bb%e7%b1%bb%e5%9e%8b></a></h3><p>pandas有一个特殊的分类类型，用于保存使用整数分类表示法的数据。看一个之前的Series例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>20</span><span class=p>]:</span> <span class=n>fruits</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;apple&#39;</span><span class=p>,</span> <span class=s1>&#39;orange&#39;</span><span class=p>,</span> <span class=s1>&#39;apple&#39;</span><span class=p>,</span> <span class=s1>&#39;apple&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>21</span><span class=p>]:</span> <span class=n>N</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>fruits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>22</span><span class=p>]:</span> <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s1>&#39;fruit&#39;</span><span class=p>:</span> <span class=n>fruits</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                    <span class=s1>&#39;basket_id&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>N</span><span class=p>),</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                    <span class=s1>&#39;count&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>N</span><span class=p>),</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                    <span class=s1>&#39;weight&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>N</span><span class=p>)},</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                   <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;basket_id&#39;</span><span class=p>,</span> <span class=s1>&#39;fruit&#39;</span><span class=p>,</span> <span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=s1>&#39;weight&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>23</span><span class=p>]:</span> <span class=n>df</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>23</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>basket_id</span>   <span class=n>fruit</span>  <span class=n>count</span>    <span class=n>weight</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>          <span class=mi>0</span>   <span class=n>apple</span>      <span class=mi>5</span>  <span class=mf>3.858058</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>          <span class=mi>1</span>  <span class=n>orange</span>      <span class=mi>8</span>  <span class=mf>2.612708</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>          <span class=mi>2</span>   <span class=n>apple</span>      <span class=mi>4</span>  <span class=mf>2.995627</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>          <span class=mi>3</span>   <span class=n>apple</span>      <span class=mi>7</span>  <span class=mf>2.614279</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>          <span class=mi>4</span>   <span class=n>apple</span>     <span class=mi>12</span>  <span class=mf>2.990859</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>          <span class=mi>5</span>  <span class=n>orange</span>      <span class=mi>8</span>  <span class=mf>3.845227</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>          <span class=mi>6</span>   <span class=n>apple</span>      <span class=mi>5</span>  <span class=mf>0.033553</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>          <span class=mi>7</span>   <span class=n>apple</span>      <span class=mi>4</span>  <span class=mf>0.425778</span></span></span></code></pre></td></tr></table></div></div><p>这里，df[&lsquo;fruit&rsquo;]是一个Python字符串对象的数组。我们可以通过调用它，将它转变为分类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>24</span><span class=p>]:</span> <span class=n>fruit_cat</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;fruit&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s1>&#39;category&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>25</span><span class=p>]:</span> <span class=n>fruit_cat</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>25</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>orange</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=n>orange</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>fruit</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>category</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>apple</span><span class=p>,</span> <span class=n>orange</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>fruit_cat的值不是NumPy数组，而是一个pandas.Categorical实例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>26</span><span class=p>]:</span> <span class=n>c</span> <span class=o>=</span> <span class=n>fruit_cat</span><span class=o>.</span><span class=n>values</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>27</span><span class=p>]:</span> <span class=nb>type</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>27</span><span class=p>]:</span> <span class=n>pandas</span><span class=o>.</span><span class=n>core</span><span class=o>.</span><span class=n>categorical</span><span class=o>.</span><span class=n>Categorical</span></span></span></code></pre></td></tr></table></div></div><p>分类对象有categories和codes属性：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>28</span><span class=p>]:</span> <span class=n>c</span><span class=o>.</span><span class=n>categories</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>28</span><span class=p>]:</span> <span class=n>Index</span><span class=p>([</span><span class=s1>&#39;apple&#39;</span><span class=p>,</span> <span class=s1>&#39;orange&#39;</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=s1>&#39;object&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>29</span><span class=p>]:</span> <span class=n>c</span><span class=o>.</span><span class=n>codes</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>29</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=n>int8</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>你可将DataFrame的列通过分配转换结果，转换为分类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>30</span><span class=p>]:</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;fruit&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;fruit&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s1>&#39;category&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>31</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>fruit</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>31</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>orange</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=n>orange</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=n>apple</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>fruit</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>category</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>apple</span><span class=p>,</span> <span class=n>orange</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>你还可以从其它Python序列直接创建pandas.Categorical：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>32</span><span class=p>]:</span> <span class=n>my_categories</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Categorical</span><span class=p>([</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=s1>&#39;baz&#39;</span><span class=p>,</span> <span class=s1>&#39;foo&#39;</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>33</span><span class=p>]:</span> <span class=n>my_categories</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>33</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>foo</span><span class=p>,</span> <span class=n>bar</span><span class=p>,</span> <span class=n>baz</span><span class=p>,</span> <span class=n>foo</span><span class=p>,</span> <span class=n>bar</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>bar</span><span class=p>,</span> <span class=n>baz</span><span class=p>,</span> <span class=n>foo</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>如果你已经从其它源获得了分类编码，你还可以使用from_codes构造器：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>34</span><span class=p>]:</span> <span class=n>categories</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=s1>&#39;baz&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>35</span><span class=p>]:</span> <span class=n>codes</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>36</span><span class=p>]:</span> <span class=n>my_cats_2</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Categorical</span><span class=o>.</span><span class=n>from_codes</span><span class=p>(</span><span class=n>codes</span><span class=p>,</span> <span class=n>categories</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>37</span><span class=p>]:</span> <span class=n>my_cats_2</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>37</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>foo</span><span class=p>,</span> <span class=n>bar</span><span class=p>,</span> <span class=n>baz</span><span class=p>,</span> <span class=n>foo</span><span class=p>,</span> <span class=n>foo</span><span class=p>,</span> <span class=n>bar</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>foo</span><span class=p>,</span> <span class=n>bar</span><span class=p>,</span> <span class=n>baz</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>与显示指定不同，分类变换不认定指定的分类顺序。因此取决于输入数据的顺序，categories数组的顺序会不同。当使用from_codes或其它的构造器时，你可以指定分类一个有意义的顺序：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>38</span><span class=p>]:</span> <span class=n>ordered_cat</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Categorical</span><span class=o>.</span><span class=n>from_codes</span><span class=p>(</span><span class=n>codes</span><span class=p>,</span> <span class=n>categories</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                                         <span class=n>ordered</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>39</span><span class=p>]:</span> <span class=n>ordered_cat</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>39</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>foo</span><span class=p>,</span> <span class=n>bar</span><span class=p>,</span> <span class=n>baz</span><span class=p>,</span> <span class=n>foo</span><span class=p>,</span> <span class=n>foo</span><span class=p>,</span> <span class=n>bar</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>foo</span> <span class=o>&lt;</span> <span class=n>bar</span> <span class=o>&lt;</span> <span class=n>baz</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>输出[foo &lt; bar &lt; baz]指明‘foo’位于‘bar’的前面，以此类推。无序的分类实例可以通过as_ordered排序：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3>3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>40</span><span class=p>]:</span> <span class=n>my_cats_2</span><span class=o>.</span><span class=n>as_ordered</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>40</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>foo</span><span class=p>,</span> <span class=n>bar</span><span class=p>,</span> <span class=n>baz</span><span class=p>,</span> <span class=n>foo</span><span class=p>,</span> <span class=n>foo</span><span class=p>,</span> <span class=n>bar</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>foo</span> <span class=o>&lt;</span> <span class=n>bar</span> <span class=o>&lt;</span> <span class=n>baz</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>最后要注意，分类数据不需要字符串，尽管我仅仅展示了字符串的例子。分类数组可以包括任意不可变类型。</p><h3 id=1213-用分类进行计算>12.1.3 用分类进行计算
<a class=header-anchor href=#1213-%e7%94%a8%e5%88%86%e7%b1%bb%e8%bf%9b%e8%a1%8c%e8%ae%a1%e7%ae%97></a></h3><p>与非编码版本（比如字符串数组）相比，使用pandas的Categorical有些类似。某些pandas组件，比如groupby函数，更适合进行分类。还有一些函数可以使用有序标志位。</p><p>来看一些随机的数值数据，使用pandas.qcut面元函数。它会返回pandas.Categorical，我们之前使用过pandas.cut，但没解释分类是如何工作的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>41</span><span class=p>]:</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>12345</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>42</span><span class=p>]:</span> <span class=n>draws</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>43</span><span class=p>]:</span> <span class=n>draws</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>43</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=o>-</span><span class=mf>0.2047</span><span class=p>,</span>  <span class=mf>0.4789</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5194</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5557</span><span class=p>,</span>  <span class=mf>1.9658</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>计算这个数据的分位面元，提取一些统计信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>44</span><span class=p>]:</span> <span class=n>bins</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>qcut</span><span class=p>(</span><span class=n>draws</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>45</span><span class=p>]:</span> <span class=n>bins</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>45</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[(</span><span class=o>-</span><span class=mf>0.684</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0101</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.0101</span><span class=p>,</span> <span class=mf>0.63</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.684</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0101</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.684</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0101</span><span class=p>],</span> <span class=p>(</span><span class=mf>0.63</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=mf>3.928</span><span class=p>],</span> <span class=o>...</span><span class=p>,</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.0101</span><span class=p>,</span> <span class=mf>0.63</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.684</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0101</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>2.95</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.684</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.0101</span><span class=p>,</span> <span class=mf>0.63</span>
</span></span><span class=line><span class=cl><span class=p>],</span> <span class=p>(</span><span class=mf>0.63</span><span class=p>,</span> <span class=mf>3.928</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>Length</span><span class=p>:</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=n>float64</span><span class=p>]):</span> <span class=p>[(</span><span class=o>-</span><span class=mf>2.95</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.684</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.684</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.0101</span><span class=p>]</span> <span class=o>&lt;</span> <span class=p>(</span><span class=o>-</span><span class=mf>0.010</span>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=p>,</span> <span class=mf>0.63</span><span class=p>]</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>                                    <span class=p>(</span><span class=mf>0.63</span><span class=p>,</span> <span class=mf>3.928</span><span class=p>]]</span></span></span></code></pre></td></tr></table></div></div><p>虽然有用，确切的样本分位数与分位的名称相比，不利于生成汇总。我们可以使用labels参数qcut，实现目的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>46</span><span class=p>]:</span> <span class=n>bins</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>qcut</span><span class=p>(</span><span class=n>draws</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=n>labels</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;Q1&#39;</span><span class=p>,</span> <span class=s1>&#39;Q2&#39;</span><span class=p>,</span> <span class=s1>&#39;Q3&#39;</span><span class=p>,</span> <span class=s1>&#39;Q4&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>47</span><span class=p>]:</span> <span class=n>bins</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>47</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>Q2</span><span class=p>,</span> <span class=n>Q3</span><span class=p>,</span> <span class=n>Q2</span><span class=p>,</span> <span class=n>Q2</span><span class=p>,</span> <span class=n>Q4</span><span class=p>,</span> <span class=o>...</span><span class=p>,</span> <span class=n>Q3</span><span class=p>,</span> <span class=n>Q2</span><span class=p>,</span> <span class=n>Q1</span><span class=p>,</span> <span class=n>Q3</span><span class=p>,</span> <span class=n>Q4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Length</span><span class=p>:</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>Q1</span> <span class=o>&lt;</span> <span class=n>Q2</span> <span class=o>&lt;</span> <span class=n>Q3</span> <span class=o>&lt;</span> <span class=n>Q4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>48</span><span class=p>]:</span> <span class=n>bins</span><span class=o>.</span><span class=n>codes</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>48</span><span class=p>]:</span> <span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=n>int8</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>加上标签的面元分类不包含数据面元边界的信息，因此可以使用groupby提取一些汇总信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>49</span><span class=p>]:</span> <span class=n>bins</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>bins</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;quartile&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>50</span><span class=p>]:</span> <span class=n>results</span> <span class=o>=</span> <span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>draws</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>            <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>bins</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>            <span class=o>.</span><span class=n>agg</span><span class=p>([</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>            <span class=o>.</span><span class=n>reset_index</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>51</span><span class=p>]:</span> <span class=n>results</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>51</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>  <span class=n>quartile</span>  <span class=n>count</span>       <span class=nb>min</span>       <span class=nb>max</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>       <span class=n>Q1</span>    <span class=mi>250</span> <span class=o>-</span><span class=mf>2.949343</span> <span class=o>-</span><span class=mf>0.685484</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>       <span class=n>Q2</span>    <span class=mi>250</span> <span class=o>-</span><span class=mf>0.683066</span> <span class=o>-</span><span class=mf>0.010115</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>       <span class=n>Q3</span>    <span class=mi>250</span> <span class=o>-</span><span class=mf>0.010032</span>  <span class=mf>0.628894</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>       <span class=n>Q4</span>    <span class=mi>250</span>  <span class=mf>0.634238</span>  <span class=mf>3.927528</span></span></span></code></pre></td></tr></table></div></div><p>分位数列保存了原始的面元分类信息，包括排序：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6>6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7>7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>52</span><span class=p>]:</span> <span class=n>results</span><span class=p>[</span><span class=s1>&#39;quartile&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>52</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=n>Q1</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>Q2</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=n>Q3</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>Q4</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>quartile</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>category</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>Q1</span> <span class=o>&lt;</span> <span class=n>Q2</span> <span class=o>&lt;</span> <span class=n>Q3</span> <span class=o>&lt;</span> <span class=n>Q4</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><h3 id=1214-用分类提高性能>12.1.4 用分类提高性能
<a class=header-anchor href=#1214-%e7%94%a8%e5%88%86%e7%b1%bb%e6%8f%90%e9%ab%98%e6%80%a7%e8%83%bd></a></h3><p>如果你是在一个特定数据集上做大量分析，将其转换为分类可以极大地提高效率。DataFrame列的分类使用的内存通常少的多。来看一些包含一千万元素的Series，和一些不同的分类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>53</span><span class=p>]:</span> <span class=n>N</span> <span class=o>=</span> <span class=mi>10000000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>54</span><span class=p>]:</span> <span class=n>draws</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>N</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>55</span><span class=p>]:</span> <span class=n>labels</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=s1>&#39;baz&#39;</span><span class=p>,</span> <span class=s1>&#39;qux&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>N</span> <span class=o>//</span> <span class=mi>4</span><span class=p>))</span></span></span></code></pre></td></tr></table></div></div><p>现在，将标签转换为分类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>56</span><span class=p>]:</span> <span class=n>categories</span> <span class=o>=</span> <span class=n>labels</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s1>&#39;category&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>这时，可以看到标签使用的内存远比分类多：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2>2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3>3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4>4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>57</span><span class=p>]:</span> <span class=n>labels</span><span class=o>.</span><span class=n>memory_usage</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>57</span><span class=p>]:</span> <span class=mi>80000080</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>58</span><span class=p>]:</span> <span class=n>categories</span><span class=o>.</span><span class=n>memory_usage</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>58</span><span class=p>]:</span> <span class=mi>10000272</span></span></span></code></pre></td></tr></table></div></div><p>转换为分类不是没有代价的，但这是一次性的代价：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span><span class=lnt id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a>
</span><span class=lnt id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>59</span><span class=p>]:</span> <span class=o>%</span><span class=n>time</span> <span class=n>_</span> <span class=o>=</span> <span class=n>labels</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s1>&#39;category&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>CPU</span> <span class=n>times</span><span class=p>:</span> <span class=n>user</span> <span class=mi>490</span> <span class=n>ms</span><span class=p>,</span> <span class=n>sys</span><span class=p>:</span> <span class=mi>240</span> <span class=n>ms</span><span class=p>,</span> <span class=n>total</span><span class=p>:</span> <span class=mi>730</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=n>Wall</span> <span class=n>time</span><span class=p>:</span> <span class=mi>726</span> <span class=n>ms</span></span></span></code></pre></td></tr></table></div></div><p>GroupBy使用分类操作明显更快，是因为底层的算法使用整数编码数组，而不是字符串数组。</p><h3 id=1215-分类方法>12.1.5 分类方法
<a class=header-anchor href=#1215-%e5%88%86%e7%b1%bb%e6%96%b9%e6%b3%95></a></h3><p>包含分类数据的Series有一些特殊的方法，类似于Series.str字符串方法。它还提供了方便的分类和编码的使用方法。看下面的Series：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1> 1</a>
</span><span class=lnt id=hl-21-2><a class=lnlinks href=#hl-21-2> 2</a>
</span><span class=lnt id=hl-21-3><a class=lnlinks href=#hl-21-3> 3</a>
</span><span class=lnt id=hl-21-4><a class=lnlinks href=#hl-21-4> 4</a>
</span><span class=lnt id=hl-21-5><a class=lnlinks href=#hl-21-5> 5</a>
</span><span class=lnt id=hl-21-6><a class=lnlinks href=#hl-21-6> 6</a>
</span><span class=lnt id=hl-21-7><a class=lnlinks href=#hl-21-7> 7</a>
</span><span class=lnt id=hl-21-8><a class=lnlinks href=#hl-21-8> 8</a>
</span><span class=lnt id=hl-21-9><a class=lnlinks href=#hl-21-9> 9</a>
</span><span class=lnt id=hl-21-10><a class=lnlinks href=#hl-21-10>10</a>
</span><span class=lnt id=hl-21-11><a class=lnlinks href=#hl-21-11>11</a>
</span><span class=lnt id=hl-21-12><a class=lnlinks href=#hl-21-12>12</a>
</span><span class=lnt id=hl-21-13><a class=lnlinks href=#hl-21-13>13</a>
</span><span class=lnt id=hl-21-14><a class=lnlinks href=#hl-21-14>14</a>
</span><span class=lnt id=hl-21-15><a class=lnlinks href=#hl-21-15>15</a>
</span><span class=lnt id=hl-21-16><a class=lnlinks href=#hl-21-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>60</span><span class=p>]:</span> <span class=n>s</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>61</span><span class=p>]:</span> <span class=n>cat_s</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s1>&#39;category&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>62</span><span class=p>]:</span> <span class=n>cat_s</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>62</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>d</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>    <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>    <span class=n>d</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>category</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>特别的cat属性提供了分类方法的入口：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1> 1</a>
</span><span class=lnt id=hl-22-2><a class=lnlinks href=#hl-22-2> 2</a>
</span><span class=lnt id=hl-22-3><a class=lnlinks href=#hl-22-3> 3</a>
</span><span class=lnt id=hl-22-4><a class=lnlinks href=#hl-22-4> 4</a>
</span><span class=lnt id=hl-22-5><a class=lnlinks href=#hl-22-5> 5</a>
</span><span class=lnt id=hl-22-6><a class=lnlinks href=#hl-22-6> 6</a>
</span><span class=lnt id=hl-22-7><a class=lnlinks href=#hl-22-7> 7</a>
</span><span class=lnt id=hl-22-8><a class=lnlinks href=#hl-22-8> 8</a>
</span><span class=lnt id=hl-22-9><a class=lnlinks href=#hl-22-9> 9</a>
</span><span class=lnt id=hl-22-10><a class=lnlinks href=#hl-22-10>10</a>
</span><span class=lnt id=hl-22-11><a class=lnlinks href=#hl-22-11>11</a>
</span><span class=lnt id=hl-22-12><a class=lnlinks href=#hl-22-12>12</a>
</span><span class=lnt id=hl-22-13><a class=lnlinks href=#hl-22-13>13</a>
</span><span class=lnt id=hl-22-14><a class=lnlinks href=#hl-22-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>63</span><span class=p>]:</span> <span class=n>cat_s</span><span class=o>.</span><span class=n>cat</span><span class=o>.</span><span class=n>codes</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>63</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>    <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>64</span><span class=p>]:</span> <span class=n>cat_s</span><span class=o>.</span><span class=n>cat</span><span class=o>.</span><span class=n>categories</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>64</span><span class=p>]:</span> <span class=n>Index</span><span class=p>([</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=s1>&#39;object&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>假设我们知道这个数据的实际分类集，超出了数据中的四个值。我们可以使用set_categories方法改变它们：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-23-1><a class=lnlinks href=#hl-23-1> 1</a>
</span><span class=lnt id=hl-23-2><a class=lnlinks href=#hl-23-2> 2</a>
</span><span class=lnt id=hl-23-3><a class=lnlinks href=#hl-23-3> 3</a>
</span><span class=lnt id=hl-23-4><a class=lnlinks href=#hl-23-4> 4</a>
</span><span class=lnt id=hl-23-5><a class=lnlinks href=#hl-23-5> 5</a>
</span><span class=lnt id=hl-23-6><a class=lnlinks href=#hl-23-6> 6</a>
</span><span class=lnt id=hl-23-7><a class=lnlinks href=#hl-23-7> 7</a>
</span><span class=lnt id=hl-23-8><a class=lnlinks href=#hl-23-8> 8</a>
</span><span class=lnt id=hl-23-9><a class=lnlinks href=#hl-23-9> 9</a>
</span><span class=lnt id=hl-23-10><a class=lnlinks href=#hl-23-10>10</a>
</span><span class=lnt id=hl-23-11><a class=lnlinks href=#hl-23-11>11</a>
</span><span class=lnt id=hl-23-12><a class=lnlinks href=#hl-23-12>12</a>
</span><span class=lnt id=hl-23-13><a class=lnlinks href=#hl-23-13>13</a>
</span><span class=lnt id=hl-23-14><a class=lnlinks href=#hl-23-14>14</a>
</span><span class=lnt id=hl-23-15><a class=lnlinks href=#hl-23-15>15</a>
</span><span class=lnt id=hl-23-16><a class=lnlinks href=#hl-23-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>65</span><span class=p>]:</span> <span class=n>actual_categories</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>,</span> <span class=s1>&#39;e&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>66</span><span class=p>]:</span> <span class=n>cat_s2</span> <span class=o>=</span> <span class=n>cat_s</span><span class=o>.</span><span class=n>cat</span><span class=o>.</span><span class=n>set_categories</span><span class=p>(</span><span class=n>actual_categories</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>67</span><span class=p>]:</span> <span class=n>cat_s2</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>67</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>d</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>    <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>    <span class=n>d</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>category</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>e</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>虽然数据看起来没变，新的分类将反映在它们的操作中。例如，如果有的话，value_counts表示分类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-24-1><a class=lnlinks href=#hl-24-1> 1</a>
</span><span class=lnt id=hl-24-2><a class=lnlinks href=#hl-24-2> 2</a>
</span><span class=lnt id=hl-24-3><a class=lnlinks href=#hl-24-3> 3</a>
</span><span class=lnt id=hl-24-4><a class=lnlinks href=#hl-24-4> 4</a>
</span><span class=lnt id=hl-24-5><a class=lnlinks href=#hl-24-5> 5</a>
</span><span class=lnt id=hl-24-6><a class=lnlinks href=#hl-24-6> 6</a>
</span><span class=lnt id=hl-24-7><a class=lnlinks href=#hl-24-7> 7</a>
</span><span class=lnt id=hl-24-8><a class=lnlinks href=#hl-24-8> 8</a>
</span><span class=lnt id=hl-24-9><a class=lnlinks href=#hl-24-9> 9</a>
</span><span class=lnt id=hl-24-10><a class=lnlinks href=#hl-24-10>10</a>
</span><span class=lnt id=hl-24-11><a class=lnlinks href=#hl-24-11>11</a>
</span><span class=lnt id=hl-24-12><a class=lnlinks href=#hl-24-12>12</a>
</span><span class=lnt id=hl-24-13><a class=lnlinks href=#hl-24-13>13</a>
</span><span class=lnt id=hl-24-14><a class=lnlinks href=#hl-24-14>14</a>
</span><span class=lnt id=hl-24-15><a class=lnlinks href=#hl-24-15>15</a>
</span><span class=lnt id=hl-24-16><a class=lnlinks href=#hl-24-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>68</span><span class=p>]:</span> <span class=n>cat_s</span><span class=o>.</span><span class=n>value_counts</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>68</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>d</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>c</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>b</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>a</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>69</span><span class=p>]:</span> <span class=n>cat_s2</span><span class=o>.</span><span class=n>value_counts</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>69</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>d</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>c</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>b</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>a</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>e</span>    <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>int64</span></span></span></code></pre></td></tr></table></div></div><p>在大数据集中，分类经常作为节省内存和高性能的便捷工具。过滤完大DataFrame或Series之后，许多分类可能不会出现在数据中。我们可以使用remove_unused_categories方法删除没看到的分类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-25-1><a class=lnlinks href=#hl-25-1> 1</a>
</span><span class=lnt id=hl-25-2><a class=lnlinks href=#hl-25-2> 2</a>
</span><span class=lnt id=hl-25-3><a class=lnlinks href=#hl-25-3> 3</a>
</span><span class=lnt id=hl-25-4><a class=lnlinks href=#hl-25-4> 4</a>
</span><span class=lnt id=hl-25-5><a class=lnlinks href=#hl-25-5> 5</a>
</span><span class=lnt id=hl-25-6><a class=lnlinks href=#hl-25-6> 6</a>
</span><span class=lnt id=hl-25-7><a class=lnlinks href=#hl-25-7> 7</a>
</span><span class=lnt id=hl-25-8><a class=lnlinks href=#hl-25-8> 8</a>
</span><span class=lnt id=hl-25-9><a class=lnlinks href=#hl-25-9> 9</a>
</span><span class=lnt id=hl-25-10><a class=lnlinks href=#hl-25-10>10</a>
</span><span class=lnt id=hl-25-11><a class=lnlinks href=#hl-25-11>11</a>
</span><span class=lnt id=hl-25-12><a class=lnlinks href=#hl-25-12>12</a>
</span><span class=lnt id=hl-25-13><a class=lnlinks href=#hl-25-13>13</a>
</span><span class=lnt id=hl-25-14><a class=lnlinks href=#hl-25-14>14</a>
</span><span class=lnt id=hl-25-15><a class=lnlinks href=#hl-25-15>15</a>
</span><span class=lnt id=hl-25-16><a class=lnlinks href=#hl-25-16>16</a>
</span><span class=lnt id=hl-25-17><a class=lnlinks href=#hl-25-17>17</a>
</span><span class=lnt id=hl-25-18><a class=lnlinks href=#hl-25-18>18</a>
</span><span class=lnt id=hl-25-19><a class=lnlinks href=#hl-25-19>19</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>70</span><span class=p>]:</span> <span class=n>cat_s3</span> <span class=o>=</span> <span class=n>cat_s</span><span class=p>[</span><span class=n>cat_s</span><span class=o>.</span><span class=n>isin</span><span class=p>([</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>])]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>71</span><span class=p>]:</span> <span class=n>cat_s3</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>71</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>category</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>72</span><span class=p>]:</span> <span class=n>cat_s3</span><span class=o>.</span><span class=n>cat</span><span class=o>.</span><span class=n>remove_unused_categories</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>72</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=n>dtype</span><span class=p>:</span> <span class=n>category</span>
</span></span><span class=line><span class=cl><span class=n>Categories</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=nb>object</span><span class=p>):</span> <span class=p>[</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>表12-1列出了可用的分类方法。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://gitee.com/wugenqiang/images/raw/master/02/1240-20201031140400402.png alt="表12-1 pandas的Series的分类方法"></p><h3 id=1216-为建模创建虚拟变量>12.1.6 为建模创建虚拟变量
<a class=header-anchor href=#1216-%e4%b8%ba%e5%bb%ba%e6%a8%a1%e5%88%9b%e5%bb%ba%e8%99%9a%e6%8b%9f%e5%8f%98%e9%87%8f></a></h3><p>当你使用统计或机器学习工具时，通常会将分类数据转换为虚拟变量，也称为one-hot编码。这包括创建一个不同类别的列的DataFrame；这些列包含给定分类的1s，其它为0。</p><p>看前面的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-26-1><a class=lnlinks href=#hl-26-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>73</span><span class=p>]:</span> <span class=n>cat_s</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=s1>&#39;category&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>前面的第7章提到过，pandas.get_dummies函数可以转换这个分类数据为包含虚拟变量的DataFrame：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-27-1><a class=lnlinks href=#hl-27-1> 1</a>
</span><span class=lnt id=hl-27-2><a class=lnlinks href=#hl-27-2> 2</a>
</span><span class=lnt id=hl-27-3><a class=lnlinks href=#hl-27-3> 3</a>
</span><span class=lnt id=hl-27-4><a class=lnlinks href=#hl-27-4> 4</a>
</span><span class=lnt id=hl-27-5><a class=lnlinks href=#hl-27-5> 5</a>
</span><span class=lnt id=hl-27-6><a class=lnlinks href=#hl-27-6> 6</a>
</span><span class=lnt id=hl-27-7><a class=lnlinks href=#hl-27-7> 7</a>
</span><span class=lnt id=hl-27-8><a class=lnlinks href=#hl-27-8> 8</a>
</span><span class=lnt id=hl-27-9><a class=lnlinks href=#hl-27-9> 9</a>
</span><span class=lnt id=hl-27-10><a class=lnlinks href=#hl-27-10>10</a>
</span><span class=lnt id=hl-27-11><a class=lnlinks href=#hl-27-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>74</span><span class=p>]:</span> <span class=n>pd</span><span class=o>.</span><span class=n>get_dummies</span><span class=p>(</span><span class=n>cat_s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>74</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>a</span>  <span class=n>b</span>  <span class=n>c</span>  <span class=n>d</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mi>1</span>  <span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mi>0</span>  <span class=mi>1</span>  <span class=mi>0</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>1</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mi>1</span>  <span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=mi>0</span>  <span class=mi>1</span>  <span class=mi>0</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>1</span>  <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>  <span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>0</span>  <span class=mi>1</span></span></span></code></pre></td></tr></table></div></div><h2 id=122-groupby高级应用>12.2 GroupBy高级应用
<a class=header-anchor href=#122-groupby%e9%ab%98%e7%ba%a7%e5%ba%94%e7%94%a8></a></h2><p>尽管我们在第10章已经深度学习了Series和DataFrame的Groupby方法，还有一些方法也是很有用的。</p><h3 id=1221-分组转换和解封groupby>12.2.1 分组转换和“解封”GroupBy
<a class=header-anchor href=#1221-%e5%88%86%e7%bb%84%e8%bd%ac%e6%8d%a2%e5%92%8c%e8%a7%a3%e5%b0%81groupby></a></h3><p>在第10章，我们在分组操作中学习了apply方法，进行转换。还有另一个transform方法，它与apply很像，但是对使用的函数有一定限制：</p><ul><li>它可以产生向分组形状广播标量值</li><li>它可以产生一个和输入组形状相同的对象</li><li>它不能修改输入</li></ul><p>来看一个简单的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-28-1><a class=lnlinks href=#hl-28-1> 1</a>
</span><span class=lnt id=hl-28-2><a class=lnlinks href=#hl-28-2> 2</a>
</span><span class=lnt id=hl-28-3><a class=lnlinks href=#hl-28-3> 3</a>
</span><span class=lnt id=hl-28-4><a class=lnlinks href=#hl-28-4> 4</a>
</span><span class=lnt id=hl-28-5><a class=lnlinks href=#hl-28-5> 5</a>
</span><span class=lnt id=hl-28-6><a class=lnlinks href=#hl-28-6> 6</a>
</span><span class=lnt id=hl-28-7><a class=lnlinks href=#hl-28-7> 7</a>
</span><span class=lnt id=hl-28-8><a class=lnlinks href=#hl-28-8> 8</a>
</span><span class=lnt id=hl-28-9><a class=lnlinks href=#hl-28-9> 9</a>
</span><span class=lnt id=hl-28-10><a class=lnlinks href=#hl-28-10>10</a>
</span><span class=lnt id=hl-28-11><a class=lnlinks href=#hl-28-11>11</a>
</span><span class=lnt id=hl-28-12><a class=lnlinks href=#hl-28-12>12</a>
</span><span class=lnt id=hl-28-13><a class=lnlinks href=#hl-28-13>13</a>
</span><span class=lnt id=hl-28-14><a class=lnlinks href=#hl-28-14>14</a>
</span><span class=lnt id=hl-28-15><a class=lnlinks href=#hl-28-15>15</a>
</span><span class=lnt id=hl-28-16><a class=lnlinks href=#hl-28-16>16</a>
</span><span class=lnt id=hl-28-17><a class=lnlinks href=#hl-28-17>17</a>
</span><span class=lnt id=hl-28-18><a class=lnlinks href=#hl-28-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>75</span><span class=p>]:</span> <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s1>&#39;key&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                    <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mf>12.</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>76</span><span class=p>]:</span> <span class=n>df</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>76</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>   <span class=n>key</span>  <span class=n>value</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=n>a</span>    <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=n>b</span>    <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=n>c</span>    <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>a</span>    <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=n>b</span>    <span class=mf>4.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=n>c</span>    <span class=mf>5.0</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>    <span class=n>a</span>    <span class=mf>6.0</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>    <span class=n>b</span>    <span class=mf>7.0</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>    <span class=n>c</span>    <span class=mf>8.0</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>    <span class=n>a</span>    <span class=mf>9.0</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>   <span class=n>b</span>   <span class=mf>10.0</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>   <span class=n>c</span>   <span class=mf>11.0</span></span></span></code></pre></td></tr></table></div></div><p>按键进行分组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-29-1><a class=lnlinks href=#hl-29-1>1</a>
</span><span class=lnt id=hl-29-2><a class=lnlinks href=#hl-29-2>2</a>
</span><span class=lnt id=hl-29-3><a class=lnlinks href=#hl-29-3>3</a>
</span><span class=lnt id=hl-29-4><a class=lnlinks href=#hl-29-4>4</a>
</span><span class=lnt id=hl-29-5><a class=lnlinks href=#hl-29-5>5</a>
</span><span class=lnt id=hl-29-6><a class=lnlinks href=#hl-29-6>6</a>
</span><span class=lnt id=hl-29-7><a class=lnlinks href=#hl-29-7>7</a>
</span><span class=lnt id=hl-29-8><a class=lnlinks href=#hl-29-8>8</a>
</span><span class=lnt id=hl-29-9><a class=lnlinks href=#hl-29-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>77</span><span class=p>]:</span> <span class=n>g</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>78</span><span class=p>]:</span> <span class=n>g</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>78</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=n>key</span>
</span></span><span class=line><span class=cl><span class=n>a</span>    <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=n>b</span>    <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=n>c</span>    <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>假设我们想产生一个和df[&lsquo;value&rsquo;]形状相同的Series，但值替换为按键分组的平均值。我们可以传递函数lambda x: x.mean()进行转换：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-30-1><a class=lnlinks href=#hl-30-1> 1</a>
</span><span class=lnt id=hl-30-2><a class=lnlinks href=#hl-30-2> 2</a>
</span><span class=lnt id=hl-30-3><a class=lnlinks href=#hl-30-3> 3</a>
</span><span class=lnt id=hl-30-4><a class=lnlinks href=#hl-30-4> 4</a>
</span><span class=lnt id=hl-30-5><a class=lnlinks href=#hl-30-5> 5</a>
</span><span class=lnt id=hl-30-6><a class=lnlinks href=#hl-30-6> 6</a>
</span><span class=lnt id=hl-30-7><a class=lnlinks href=#hl-30-7> 7</a>
</span><span class=lnt id=hl-30-8><a class=lnlinks href=#hl-30-8> 8</a>
</span><span class=lnt id=hl-30-9><a class=lnlinks href=#hl-30-9> 9</a>
</span><span class=lnt id=hl-30-10><a class=lnlinks href=#hl-30-10>10</a>
</span><span class=lnt id=hl-30-11><a class=lnlinks href=#hl-30-11>11</a>
</span><span class=lnt id=hl-30-12><a class=lnlinks href=#hl-30-12>12</a>
</span><span class=lnt id=hl-30-13><a class=lnlinks href=#hl-30-13>13</a>
</span><span class=lnt id=hl-30-14><a class=lnlinks href=#hl-30-14>14</a>
</span><span class=lnt id=hl-30-15><a class=lnlinks href=#hl-30-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>79</span><span class=p>]:</span> <span class=n>g</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>79</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>     <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>     <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>     <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>     <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>    <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>    <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>对于内置的聚合函数，我们可以传递一个字符串假名作为GroupBy的agg方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-31-1><a class=lnlinks href=#hl-31-1> 1</a>
</span><span class=lnt id=hl-31-2><a class=lnlinks href=#hl-31-2> 2</a>
</span><span class=lnt id=hl-31-3><a class=lnlinks href=#hl-31-3> 3</a>
</span><span class=lnt id=hl-31-4><a class=lnlinks href=#hl-31-4> 4</a>
</span><span class=lnt id=hl-31-5><a class=lnlinks href=#hl-31-5> 5</a>
</span><span class=lnt id=hl-31-6><a class=lnlinks href=#hl-31-6> 6</a>
</span><span class=lnt id=hl-31-7><a class=lnlinks href=#hl-31-7> 7</a>
</span><span class=lnt id=hl-31-8><a class=lnlinks href=#hl-31-8> 8</a>
</span><span class=lnt id=hl-31-9><a class=lnlinks href=#hl-31-9> 9</a>
</span><span class=lnt id=hl-31-10><a class=lnlinks href=#hl-31-10>10</a>
</span><span class=lnt id=hl-31-11><a class=lnlinks href=#hl-31-11>11</a>
</span><span class=lnt id=hl-31-12><a class=lnlinks href=#hl-31-12>12</a>
</span><span class=lnt id=hl-31-13><a class=lnlinks href=#hl-31-13>13</a>
</span><span class=lnt id=hl-31-14><a class=lnlinks href=#hl-31-14>14</a>
</span><span class=lnt id=hl-31-15><a class=lnlinks href=#hl-31-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>80</span><span class=p>]:</span> <span class=n>g</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=s1>&#39;mean&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>80</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>     <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>     <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>     <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>     <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>    <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>    <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>与apply类似，transform的函数会返回Series，但是结果必须与输入大小相同。举个例子，我们可以用lambda函数将每个分组乘以2：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-32-1><a class=lnlinks href=#hl-32-1> 1</a>
</span><span class=lnt id=hl-32-2><a class=lnlinks href=#hl-32-2> 2</a>
</span><span class=lnt id=hl-32-3><a class=lnlinks href=#hl-32-3> 3</a>
</span><span class=lnt id=hl-32-4><a class=lnlinks href=#hl-32-4> 4</a>
</span><span class=lnt id=hl-32-5><a class=lnlinks href=#hl-32-5> 5</a>
</span><span class=lnt id=hl-32-6><a class=lnlinks href=#hl-32-6> 6</a>
</span><span class=lnt id=hl-32-7><a class=lnlinks href=#hl-32-7> 7</a>
</span><span class=lnt id=hl-32-8><a class=lnlinks href=#hl-32-8> 8</a>
</span><span class=lnt id=hl-32-9><a class=lnlinks href=#hl-32-9> 9</a>
</span><span class=lnt id=hl-32-10><a class=lnlinks href=#hl-32-10>10</a>
</span><span class=lnt id=hl-32-11><a class=lnlinks href=#hl-32-11>11</a>
</span><span class=lnt id=hl-32-12><a class=lnlinks href=#hl-32-12>12</a>
</span><span class=lnt id=hl-32-13><a class=lnlinks href=#hl-32-13>13</a>
</span><span class=lnt id=hl-32-14><a class=lnlinks href=#hl-32-14>14</a>
</span><span class=lnt id=hl-32-15><a class=lnlinks href=#hl-32-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>81</span><span class=p>]:</span> <span class=n>g</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>81</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>      <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>      <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>      <span class=mf>4.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>      <span class=mf>6.0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>      <span class=mf>8.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>     <span class=mf>10.0</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=mf>12.0</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=mf>14.0</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=mf>16.0</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>     <span class=mf>18.0</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>    <span class=mf>20.0</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>    <span class=mf>22.0</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>再举一个复杂的例子，我们可以计算每个分组的降序排名：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-33-1><a class=lnlinks href=#hl-33-1> 1</a>
</span><span class=lnt id=hl-33-2><a class=lnlinks href=#hl-33-2> 2</a>
</span><span class=lnt id=hl-33-3><a class=lnlinks href=#hl-33-3> 3</a>
</span><span class=lnt id=hl-33-4><a class=lnlinks href=#hl-33-4> 4</a>
</span><span class=lnt id=hl-33-5><a class=lnlinks href=#hl-33-5> 5</a>
</span><span class=lnt id=hl-33-6><a class=lnlinks href=#hl-33-6> 6</a>
</span><span class=lnt id=hl-33-7><a class=lnlinks href=#hl-33-7> 7</a>
</span><span class=lnt id=hl-33-8><a class=lnlinks href=#hl-33-8> 8</a>
</span><span class=lnt id=hl-33-9><a class=lnlinks href=#hl-33-9> 9</a>
</span><span class=lnt id=hl-33-10><a class=lnlinks href=#hl-33-10>10</a>
</span><span class=lnt id=hl-33-11><a class=lnlinks href=#hl-33-11>11</a>
</span><span class=lnt id=hl-33-12><a class=lnlinks href=#hl-33-12>12</a>
</span><span class=lnt id=hl-33-13><a class=lnlinks href=#hl-33-13>13</a>
</span><span class=lnt id=hl-33-14><a class=lnlinks href=#hl-33-14>14</a>
</span><span class=lnt id=hl-33-15><a class=lnlinks href=#hl-33-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>82</span><span class=p>]:</span> <span class=n>g</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>rank</span><span class=p>(</span><span class=n>ascending</span><span class=o>=</span><span class=kc>False</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>82</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=mf>4.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>     <span class=mf>4.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>     <span class=mf>4.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>     <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>     <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>     <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>     <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>    <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>    <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>看一个由简单聚合构造的的分组转换函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-34-1><a class=lnlinks href=#hl-34-1>1</a>
</span><span class=lnt id=hl-34-2><a class=lnlinks href=#hl-34-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>normalize</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>x</span> <span class=o>-</span> <span class=n>x</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span> <span class=o>/</span> <span class=n>x</span><span class=o>.</span><span class=n>std</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>我们用transform或apply可以获得等价的结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-35-1><a class=lnlinks href=#hl-35-1> 1</a>
</span><span class=lnt id=hl-35-2><a class=lnlinks href=#hl-35-2> 2</a>
</span><span class=lnt id=hl-35-3><a class=lnlinks href=#hl-35-3> 3</a>
</span><span class=lnt id=hl-35-4><a class=lnlinks href=#hl-35-4> 4</a>
</span><span class=lnt id=hl-35-5><a class=lnlinks href=#hl-35-5> 5</a>
</span><span class=lnt id=hl-35-6><a class=lnlinks href=#hl-35-6> 6</a>
</span><span class=lnt id=hl-35-7><a class=lnlinks href=#hl-35-7> 7</a>
</span><span class=lnt id=hl-35-8><a class=lnlinks href=#hl-35-8> 8</a>
</span><span class=lnt id=hl-35-9><a class=lnlinks href=#hl-35-9> 9</a>
</span><span class=lnt id=hl-35-10><a class=lnlinks href=#hl-35-10>10</a>
</span><span class=lnt id=hl-35-11><a class=lnlinks href=#hl-35-11>11</a>
</span><span class=lnt id=hl-35-12><a class=lnlinks href=#hl-35-12>12</a>
</span><span class=lnt id=hl-35-13><a class=lnlinks href=#hl-35-13>13</a>
</span><span class=lnt id=hl-35-14><a class=lnlinks href=#hl-35-14>14</a>
</span><span class=lnt id=hl-35-15><a class=lnlinks href=#hl-35-15>15</a>
</span><span class=lnt id=hl-35-16><a class=lnlinks href=#hl-35-16>16</a>
</span><span class=lnt id=hl-35-17><a class=lnlinks href=#hl-35-17>17</a>
</span><span class=lnt id=hl-35-18><a class=lnlinks href=#hl-35-18>18</a>
</span><span class=lnt id=hl-35-19><a class=lnlinks href=#hl-35-19>19</a>
</span><span class=lnt id=hl-35-20><a class=lnlinks href=#hl-35-20>20</a>
</span><span class=lnt id=hl-35-21><a class=lnlinks href=#hl-35-21>21</a>
</span><span class=lnt id=hl-35-22><a class=lnlinks href=#hl-35-22>22</a>
</span><span class=lnt id=hl-35-23><a class=lnlinks href=#hl-35-23>23</a>
</span><span class=lnt id=hl-35-24><a class=lnlinks href=#hl-35-24>24</a>
</span><span class=lnt id=hl-35-25><a class=lnlinks href=#hl-35-25>25</a>
</span><span class=lnt id=hl-35-26><a class=lnlinks href=#hl-35-26>26</a>
</span><span class=lnt id=hl-35-27><a class=lnlinks href=#hl-35-27>27</a>
</span><span class=lnt id=hl-35-28><a class=lnlinks href=#hl-35-28>28</a>
</span><span class=lnt id=hl-35-29><a class=lnlinks href=#hl-35-29>29</a>
</span><span class=lnt id=hl-35-30><a class=lnlinks href=#hl-35-30>30</a>
</span><span class=lnt id=hl-35-31><a class=lnlinks href=#hl-35-31>31</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>84</span><span class=p>]:</span> <span class=n>g</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>normalize</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>84</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=o>-</span><span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=o>-</span><span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=o>-</span><span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=o>-</span><span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=o>-</span><span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=o>-</span><span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>     <span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>    <span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>    <span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>85</span><span class=p>]:</span> <span class=n>g</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>normalize</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>85</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=o>-</span><span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=o>-</span><span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=o>-</span><span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=o>-</span><span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=o>-</span><span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=o>-</span><span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>     <span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>    <span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>    <span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>内置的聚合函数，比如mean或sum，通常比apply函数快，也比transform快。这允许我们进行一个所谓的解封（unwrapped）分组操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-36-1><a class=lnlinks href=#hl-36-1> 1</a>
</span><span class=lnt id=hl-36-2><a class=lnlinks href=#hl-36-2> 2</a>
</span><span class=lnt id=hl-36-3><a class=lnlinks href=#hl-36-3> 3</a>
</span><span class=lnt id=hl-36-4><a class=lnlinks href=#hl-36-4> 4</a>
</span><span class=lnt id=hl-36-5><a class=lnlinks href=#hl-36-5> 5</a>
</span><span class=lnt id=hl-36-6><a class=lnlinks href=#hl-36-6> 6</a>
</span><span class=lnt id=hl-36-7><a class=lnlinks href=#hl-36-7> 7</a>
</span><span class=lnt id=hl-36-8><a class=lnlinks href=#hl-36-8> 8</a>
</span><span class=lnt id=hl-36-9><a class=lnlinks href=#hl-36-9> 9</a>
</span><span class=lnt id=hl-36-10><a class=lnlinks href=#hl-36-10>10</a>
</span><span class=lnt id=hl-36-11><a class=lnlinks href=#hl-36-11>11</a>
</span><span class=lnt id=hl-36-12><a class=lnlinks href=#hl-36-12>12</a>
</span><span class=lnt id=hl-36-13><a class=lnlinks href=#hl-36-13>13</a>
</span><span class=lnt id=hl-36-14><a class=lnlinks href=#hl-36-14>14</a>
</span><span class=lnt id=hl-36-15><a class=lnlinks href=#hl-36-15>15</a>
</span><span class=lnt id=hl-36-16><a class=lnlinks href=#hl-36-16>16</a>
</span><span class=lnt id=hl-36-17><a class=lnlinks href=#hl-36-17>17</a>
</span><span class=lnt id=hl-36-18><a class=lnlinks href=#hl-36-18>18</a>
</span><span class=lnt id=hl-36-19><a class=lnlinks href=#hl-36-19>19</a>
</span><span class=lnt id=hl-36-20><a class=lnlinks href=#hl-36-20>20</a>
</span><span class=lnt id=hl-36-21><a class=lnlinks href=#hl-36-21>21</a>
</span><span class=lnt id=hl-36-22><a class=lnlinks href=#hl-36-22>22</a>
</span><span class=lnt id=hl-36-23><a class=lnlinks href=#hl-36-23>23</a>
</span><span class=lnt id=hl-36-24><a class=lnlinks href=#hl-36-24>24</a>
</span><span class=lnt id=hl-36-25><a class=lnlinks href=#hl-36-25>25</a>
</span><span class=lnt id=hl-36-26><a class=lnlinks href=#hl-36-26>26</a>
</span><span class=lnt id=hl-36-27><a class=lnlinks href=#hl-36-27>27</a>
</span><span class=lnt id=hl-36-28><a class=lnlinks href=#hl-36-28>28</a>
</span><span class=lnt id=hl-36-29><a class=lnlinks href=#hl-36-29>29</a>
</span><span class=lnt id=hl-36-30><a class=lnlinks href=#hl-36-30>30</a>
</span><span class=lnt id=hl-36-31><a class=lnlinks href=#hl-36-31>31</a>
</span><span class=lnt id=hl-36-32><a class=lnlinks href=#hl-36-32>32</a>
</span><span class=lnt id=hl-36-33><a class=lnlinks href=#hl-36-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>86</span><span class=p>]:</span> <span class=n>g</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=s1>&#39;mean&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>86</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>     <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>     <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>     <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>     <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>     <span class=mf>4.5</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>    <span class=mf>5.5</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>    <span class=mf>6.5</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>87</span><span class=p>]:</span> <span class=n>normalized</span> <span class=o>=</span> <span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;value&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>g</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=s1>&#39;mean&#39;</span><span class=p>))</span> <span class=o>/</span> <span class=n>g</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=s1>&#39;std&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>88</span><span class=p>]:</span> <span class=n>normalized</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>88</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=o>-</span><span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=o>-</span><span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=o>-</span><span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=o>-</span><span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=o>-</span><span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>    <span class=o>-</span><span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>     <span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>     <span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>     <span class=mf>0.387298</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>     <span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>    <span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>    <span class=mf>1.161895</span>
</span></span><span class=line><span class=cl><span class=n>Name</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span> <span class=n>dtype</span><span class=p>:</span> <span class=n>float64</span></span></span></code></pre></td></tr></table></div></div><p>解封分组操作可能包括多个分组聚合，但是矢量化操作还是会带来收益。</p><h3 id=1222-分组的时间重采样>12.2.2 分组的时间重采样
<a class=header-anchor href=#1222-%e5%88%86%e7%bb%84%e7%9a%84%e6%97%b6%e9%97%b4%e9%87%8d%e9%87%87%e6%a0%b7></a></h3><p>对于时间序列数据，resample方法从语义上是一个基于内在时间的分组操作。下面是一个示例表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-37-1><a class=lnlinks href=#hl-37-1> 1</a>
</span><span class=lnt id=hl-37-2><a class=lnlinks href=#hl-37-2> 2</a>
</span><span class=lnt id=hl-37-3><a class=lnlinks href=#hl-37-3> 3</a>
</span><span class=lnt id=hl-37-4><a class=lnlinks href=#hl-37-4> 4</a>
</span><span class=lnt id=hl-37-5><a class=lnlinks href=#hl-37-5> 5</a>
</span><span class=lnt id=hl-37-6><a class=lnlinks href=#hl-37-6> 6</a>
</span><span class=lnt id=hl-37-7><a class=lnlinks href=#hl-37-7> 7</a>
</span><span class=lnt id=hl-37-8><a class=lnlinks href=#hl-37-8> 8</a>
</span><span class=lnt id=hl-37-9><a class=lnlinks href=#hl-37-9> 9</a>
</span><span class=lnt id=hl-37-10><a class=lnlinks href=#hl-37-10>10</a>
</span><span class=lnt id=hl-37-11><a class=lnlinks href=#hl-37-11>11</a>
</span><span class=lnt id=hl-37-12><a class=lnlinks href=#hl-37-12>12</a>
</span><span class=lnt id=hl-37-13><a class=lnlinks href=#hl-37-13>13</a>
</span><span class=lnt id=hl-37-14><a class=lnlinks href=#hl-37-14>14</a>
</span><span class=lnt id=hl-37-15><a class=lnlinks href=#hl-37-15>15</a>
</span><span class=lnt id=hl-37-16><a class=lnlinks href=#hl-37-16>16</a>
</span><span class=lnt id=hl-37-17><a class=lnlinks href=#hl-37-17>17</a>
</span><span class=lnt id=hl-37-18><a class=lnlinks href=#hl-37-18>18</a>
</span><span class=lnt id=hl-37-19><a class=lnlinks href=#hl-37-19>19</a>
</span><span class=lnt id=hl-37-20><a class=lnlinks href=#hl-37-20>20</a>
</span><span class=lnt id=hl-37-21><a class=lnlinks href=#hl-37-21>21</a>
</span><span class=lnt id=hl-37-22><a class=lnlinks href=#hl-37-22>22</a>
</span><span class=lnt id=hl-37-23><a class=lnlinks href=#hl-37-23>23</a>
</span><span class=lnt id=hl-37-24><a class=lnlinks href=#hl-37-24>24</a>
</span><span class=lnt id=hl-37-25><a class=lnlinks href=#hl-37-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>89</span><span class=p>]:</span> <span class=n>N</span> <span class=o>=</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>90</span><span class=p>]:</span> <span class=n>times</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s1>&#39;2017-05-20 00:00&#39;</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s1>&#39;1min&#39;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>91</span><span class=p>]:</span> <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s1>&#39;time&#39;</span><span class=p>:</span> <span class=n>times</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                    <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>N</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>92</span><span class=p>]:</span> <span class=n>df</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>92</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>                  <span class=n>time</span>  <span class=n>value</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>02</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>03</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>04</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>05</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>06</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>08</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>  <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>09</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>9</span>
</span></span><span class=line><span class=cl><span class=mi>10</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>00</span>     <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=mi>11</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=mi>00</span>     <span class=mi>11</span>
</span></span><span class=line><span class=cl><span class=mi>12</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>12</span><span class=p>:</span><span class=mi>00</span>     <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=mi>13</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>00</span>     <span class=mi>13</span>
</span></span><span class=line><span class=cl><span class=mi>14</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>14</span><span class=p>:</span><span class=mi>00</span>     <span class=mi>14</span></span></span></code></pre></td></tr></table></div></div><p>这里，我们可以用time作为索引，然后重采样：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-38-1><a class=lnlinks href=#hl-38-1>1</a>
</span><span class=lnt id=hl-38-2><a class=lnlinks href=#hl-38-2>2</a>
</span><span class=lnt id=hl-38-3><a class=lnlinks href=#hl-38-3>3</a>
</span><span class=lnt id=hl-38-4><a class=lnlinks href=#hl-38-4>4</a>
</span><span class=lnt id=hl-38-5><a class=lnlinks href=#hl-38-5>5</a>
</span><span class=lnt id=hl-38-6><a class=lnlinks href=#hl-38-6>6</a>
</span><span class=lnt id=hl-38-7><a class=lnlinks href=#hl-38-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>93</span><span class=p>]:</span> <span class=n>df</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;time&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;5min&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>93</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>                     <span class=n>value</span>
</span></span><span class=line><span class=cl><span class=n>time</span>                      
</span></span><span class=line><span class=cl><span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>05</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>00</span>      <span class=mi>5</span></span></span></code></pre></td></tr></table></div></div><p>假设DataFrame包含多个时间序列，用一个额外的分组键的列进行标记：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-39-1><a class=lnlinks href=#hl-39-1> 1</a>
</span><span class=lnt id=hl-39-2><a class=lnlinks href=#hl-39-2> 2</a>
</span><span class=lnt id=hl-39-3><a class=lnlinks href=#hl-39-3> 3</a>
</span><span class=lnt id=hl-39-4><a class=lnlinks href=#hl-39-4> 4</a>
</span><span class=lnt id=hl-39-5><a class=lnlinks href=#hl-39-5> 5</a>
</span><span class=lnt id=hl-39-6><a class=lnlinks href=#hl-39-6> 6</a>
</span><span class=lnt id=hl-39-7><a class=lnlinks href=#hl-39-7> 7</a>
</span><span class=lnt id=hl-39-8><a class=lnlinks href=#hl-39-8> 8</a>
</span><span class=lnt id=hl-39-9><a class=lnlinks href=#hl-39-9> 9</a>
</span><span class=lnt id=hl-39-10><a class=lnlinks href=#hl-39-10>10</a>
</span><span class=lnt id=hl-39-11><a class=lnlinks href=#hl-39-11>11</a>
</span><span class=lnt id=hl-39-12><a class=lnlinks href=#hl-39-12>12</a>
</span><span class=lnt id=hl-39-13><a class=lnlinks href=#hl-39-13>13</a>
</span><span class=lnt id=hl-39-14><a class=lnlinks href=#hl-39-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>94</span><span class=p>]:</span> <span class=n>df2</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s1>&#39;time&#39;</span><span class=p>:</span> <span class=n>times</span><span class=o>.</span><span class=n>repeat</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                     <span class=s1>&#39;key&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>tile</span><span class=p>([</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>],</span> <span class=n>N</span><span class=p>),</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>                     <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>N</span> <span class=o>*</span> <span class=mf>3.</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>95</span><span class=p>]:</span> <span class=n>df2</span><span class=p>[:</span><span class=mi>7</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>95</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>  <span class=n>key</span>                <span class=n>time</span>  <span class=n>value</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=n>a</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>    <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=n>b</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>    <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=n>c</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>    <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=n>a</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>00</span>    <span class=mf>3.0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=n>b</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>00</span>    <span class=mf>4.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>   <span class=n>c</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>00</span>    <span class=mf>5.0</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>   <span class=n>a</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>02</span><span class=p>:</span><span class=mi>00</span>    <span class=mf>6.0</span></span></span></code></pre></td></tr></table></div></div><p>要对每个key值进行相同的重采样，我们引入pandas.TimeGrouper对象：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-40-1><a class=lnlinks href=#hl-40-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>96</span><span class=p>]:</span> <span class=n>time_key</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>TimeGrouper</span><span class=p>(</span><span class=s1>&#39;5min&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>我们然后设定时间索引，用key和time_key分组，然后聚合：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-41-1><a class=lnlinks href=#hl-41-1> 1</a>
</span><span class=lnt id=hl-41-2><a class=lnlinks href=#hl-41-2> 2</a>
</span><span class=lnt id=hl-41-3><a class=lnlinks href=#hl-41-3> 3</a>
</span><span class=lnt id=hl-41-4><a class=lnlinks href=#hl-41-4> 4</a>
</span><span class=lnt id=hl-41-5><a class=lnlinks href=#hl-41-5> 5</a>
</span><span class=lnt id=hl-41-6><a class=lnlinks href=#hl-41-6> 6</a>
</span><span class=lnt id=hl-41-7><a class=lnlinks href=#hl-41-7> 7</a>
</span><span class=lnt id=hl-41-8><a class=lnlinks href=#hl-41-8> 8</a>
</span><span class=lnt id=hl-41-9><a class=lnlinks href=#hl-41-9> 9</a>
</span><span class=lnt id=hl-41-10><a class=lnlinks href=#hl-41-10>10</a>
</span><span class=lnt id=hl-41-11><a class=lnlinks href=#hl-41-11>11</a>
</span><span class=lnt id=hl-41-12><a class=lnlinks href=#hl-41-12>12</a>
</span><span class=lnt id=hl-41-13><a class=lnlinks href=#hl-41-13>13</a>
</span><span class=lnt id=hl-41-14><a class=lnlinks href=#hl-41-14>14</a>
</span><span class=lnt id=hl-41-15><a class=lnlinks href=#hl-41-15>15</a>
</span><span class=lnt id=hl-41-16><a class=lnlinks href=#hl-41-16>16</a>
</span><span class=lnt id=hl-41-17><a class=lnlinks href=#hl-41-17>17</a>
</span><span class=lnt id=hl-41-18><a class=lnlinks href=#hl-41-18>18</a>
</span><span class=lnt id=hl-41-19><a class=lnlinks href=#hl-41-19>19</a>
</span><span class=lnt id=hl-41-20><a class=lnlinks href=#hl-41-20>20</a>
</span><span class=lnt id=hl-41-21><a class=lnlinks href=#hl-41-21>21</a>
</span><span class=lnt id=hl-41-22><a class=lnlinks href=#hl-41-22>22</a>
</span><span class=lnt id=hl-41-23><a class=lnlinks href=#hl-41-23>23</a>
</span><span class=lnt id=hl-41-24><a class=lnlinks href=#hl-41-24>24</a>
</span><span class=lnt id=hl-41-25><a class=lnlinks href=#hl-41-25>25</a>
</span><span class=lnt id=hl-41-26><a class=lnlinks href=#hl-41-26>26</a>
</span><span class=lnt id=hl-41-27><a class=lnlinks href=#hl-41-27>27</a>
</span><span class=lnt id=hl-41-28><a class=lnlinks href=#hl-41-28>28</a>
</span><span class=lnt id=hl-41-29><a class=lnlinks href=#hl-41-29>29</a>
</span><span class=lnt id=hl-41-30><a class=lnlinks href=#hl-41-30>30</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>97</span><span class=p>]:</span> <span class=n>resampled</span> <span class=o>=</span> <span class=p>(</span><span class=n>df2</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;time&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>              <span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=n>time_key</span><span class=p>])</span>
</span></span><span class=line><span class=cl>   <span class=o>....</span><span class=p>:</span>              <span class=o>.</span><span class=n>sum</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>98</span><span class=p>]:</span> <span class=n>resampled</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>98</span><span class=p>]:</span> 
</span></span><span class=line><span class=cl>                         <span class=n>value</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=n>time</span>                      
</span></span><span class=line><span class=cl><span class=n>a</span>   <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>   <span class=mf>30.0</span>
</span></span><span class=line><span class=cl>    <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>05</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>105.0</span>
</span></span><span class=line><span class=cl>    <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>180.0</span>
</span></span><span class=line><span class=cl><span class=n>b</span>   <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>   <span class=mf>35.0</span>
</span></span><span class=line><span class=cl>    <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>05</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>110.0</span>
</span></span><span class=line><span class=cl>    <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>185.0</span>
</span></span><span class=line><span class=cl><span class=n>c</span>   <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>   <span class=mf>40.0</span>
</span></span><span class=line><span class=cl>    <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>05</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>115.0</span>
</span></span><span class=line><span class=cl>    <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>190.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=p>[</span><span class=mi>99</span><span class=p>]:</span> <span class=n>resampled</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>Out</span><span class=p>[</span><span class=mi>99</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=n>key</span>                <span class=n>time</span>  <span class=n>value</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>   <span class=n>a</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>   <span class=mf>30.0</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=n>a</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>05</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>105.0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=n>a</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>180.0</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=n>b</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>   <span class=mf>35.0</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>   <span class=n>b</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>05</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>110.0</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>   <span class=n>b</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>185.0</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>   <span class=n>c</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>   <span class=mf>40.0</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>   <span class=n>c</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>05</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>115.0</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>   <span class=n>c</span> <span class=mi>2017</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>20</span> <span class=mi>00</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>00</span>  <span class=mf>190.0</span></span></span></code></pre></td></tr></table></div></div><p>使用TimeGrouper的限制是时间必须是Series或DataFrame的索引。</p><h2 id=123-链式编程技术>12.3 链式编程技术
<a class=header-anchor href=#123-%e9%93%be%e5%bc%8f%e7%bc%96%e7%a8%8b%e6%8a%80%e6%9c%af></a></h2><p>当对数据集进行一系列变换时，你可能发现创建的多个临时变量其实并没有在分析中用到。看下面的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-42-1><a class=lnlinks href=#hl-42-1>1</a>
</span><span class=lnt id=hl-42-2><a class=lnlinks href=#hl-42-2>2</a>
</span><span class=lnt id=hl-42-3><a class=lnlinks href=#hl-42-3>3</a>
</span><span class=lnt id=hl-42-4><a class=lnlinks href=#hl-42-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>load_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>df2</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;col2&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>df2</span><span class=p>[</span><span class=s1>&#39;col1_demeaned&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df2</span><span class=p>[</span><span class=s1>&#39;col1&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>df2</span><span class=p>[</span><span class=s1>&#39;col1&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>df2</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>col1_demeaned</span><span class=o>.</span><span class=n>std</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div><p>虽然这里没有使用真实的数据，这个例子却指出了一些新方法。首先，DataFrame.assign方法是一个df[k] = v形式的函数式的列分配方法。它不是就地修改对象，而是返回新的修改过的DataFrame。因此，下面的语句是等价的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-43-1><a class=lnlinks href=#hl-43-1>1</a>
</span><span class=lnt id=hl-43-2><a class=lnlinks href=#hl-43-2>2</a>
</span><span class=lnt id=hl-43-3><a class=lnlinks href=#hl-43-3>3</a>
</span><span class=lnt id=hl-43-4><a class=lnlinks href=#hl-43-4>4</a>
</span><span class=lnt id=hl-43-5><a class=lnlinks href=#hl-43-5>5</a>
</span><span class=lnt id=hl-43-6><a class=lnlinks href=#hl-43-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Usual non-functional way</span>
</span></span><span class=line><span class=cl><span class=n>df2</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>df2</span><span class=p>[</span><span class=s1>&#39;k&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Functional assign way</span>
</span></span><span class=line><span class=cl><span class=n>df2</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=n>k</span><span class=o>=</span><span class=n>v</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>就地分配可能会比assign快，但是assign可以方便地进行链式编程：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-44-1><a class=lnlinks href=#hl-44-1>1</a>
</span><span class=lnt id=hl-44-2><a class=lnlinks href=#hl-44-2>2</a>
</span><span class=lnt id=hl-44-3><a class=lnlinks href=#hl-44-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>df2</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=n>col1_demeaned</span><span class=o>=</span><span class=n>df2</span><span class=o>.</span><span class=n>col1</span> <span class=o>-</span> <span class=n>df2</span><span class=o>.</span><span class=n>col2</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=n>col1_demeaned</span><span class=o>.</span><span class=n>std</span><span class=p>())</span></span></span></code></pre></td></tr></table></div></div><p>我使用外括号，这样便于添加换行符。</p><p>使用链式编程时要注意，你可能会需要涉及临时对象。在前面的例子中，我们不能使用load_data的结果，直到它被赋值给临时变量df。为了这么做，assign和许多其它pandas函数可以接收类似函数的参数，即可调用对象（callable）。为了展示可调用对象，看一个前面例子的片段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-45-1><a class=lnlinks href=#hl-45-1>1</a>
</span><span class=lnt id=hl-45-2><a class=lnlinks href=#hl-45-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>load_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>df2</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;col2&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>它可以重写为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-46-1><a class=lnlinks href=#hl-46-1>1</a>
</span><span class=lnt id=hl-46-2><a class=lnlinks href=#hl-46-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=p>(</span><span class=n>load_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=s1>&#39;col2&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>])</span></span></span></code></pre></td></tr></table></div></div><p>这里，load_data的结果没有赋值给某个变量，因此传递到[ ]的函数在这一步被绑定到了对象。</p><p>我们可以把整个过程写为一个单链表达式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-47-1><a class=lnlinks href=#hl-47-1>1</a>
</span><span class=lnt id=hl-47-2><a class=lnlinks href=#hl-47-2>2</a>
</span><span class=lnt id=hl-47-3><a class=lnlinks href=#hl-47-3>3</a>
</span><span class=lnt id=hl-47-4><a class=lnlinks href=#hl-47-4>4</a>
</span><span class=lnt id=hl-47-5><a class=lnlinks href=#hl-47-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>load_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=p>[</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>col2</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=n>col1_demeaned</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>col1</span> <span class=o>-</span> <span class=n>x</span><span class=o>.</span><span class=n>col1</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=n>col1_demeaned</span><span class=o>.</span><span class=n>std</span><span class=p>())</span></span></span></code></pre></td></tr></table></div></div><p>是否将代码写成这种形式只是习惯而已，将它分开成若干步可以提高可读性。</p><h3 id=1231-管道方法>12.3.1 管道方法
<a class=header-anchor href=#1231-%e7%ae%a1%e9%81%93%e6%96%b9%e6%b3%95></a></h3><p>你可以用Python内置的pandas函数和方法，用带有可调用对象的链式编程做许多工作。但是，有时你需要使用自己的函数，或是第三方库的函数。这时就要用到管道方法。</p><p>看下面的函数调用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-48-1><a class=lnlinks href=#hl-48-1>1</a>
</span><span class=lnt id=hl-48-2><a class=lnlinks href=#hl-48-2>2</a>
</span><span class=lnt id=hl-48-3><a class=lnlinks href=#hl-48-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>f</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>arg1</span><span class=o>=</span><span class=n>v1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>g</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>v2</span><span class=p>,</span> <span class=n>arg3</span><span class=o>=</span><span class=n>v3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>h</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>arg4</span><span class=o>=</span><span class=n>v4</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>当使用接收、返回Series或DataFrame对象的函数式，你可以调用pipe将其重写：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-49-1><a class=lnlinks href=#hl-49-1>1</a>
</span><span class=lnt id=hl-49-2><a class=lnlinks href=#hl-49-2>2</a>
</span><span class=lnt id=hl-49-3><a class=lnlinks href=#hl-49-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>pipe</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>arg1</span><span class=o>=</span><span class=n>v1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=n>pipe</span><span class=p>(</span><span class=n>g</span><span class=p>,</span> <span class=n>v2</span><span class=p>,</span> <span class=n>arg3</span><span class=o>=</span><span class=n>v3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=n>pipe</span><span class=p>(</span><span class=n>h</span><span class=p>,</span> <span class=n>arg4</span><span class=o>=</span><span class=n>v4</span><span class=p>))</span></span></span></code></pre></td></tr></table></div></div><p>f(df)和df.pipe(f)是等价的，但是pipe使得链式声明更容易。</p><p>pipe的另一个有用的地方是提炼操作为可复用的函数。看一个从列减去分组方法的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-50-1><a class=lnlinks href=#hl-50-1>1</a>
</span><span class=lnt id=hl-50-2><a class=lnlinks href=#hl-50-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s1>&#39;key1&#39;</span><span class=p>,</span> <span class=s1>&#39;key2&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=p>[</span><span class=s1>&#39;col1&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;col1&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=n>g</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=s1>&#39;mean&#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>假设你想转换多列，并修改分组的键。另外，你想用链式编程做这个转换。下面就是一个方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-51-1><a class=lnlinks href=#hl-51-1>1</a>
</span><span class=lnt id=hl-51-2><a class=lnlinks href=#hl-51-2>2</a>
</span><span class=lnt id=hl-51-3><a class=lnlinks href=#hl-51-3>3</a>
</span><span class=lnt id=hl-51-4><a class=lnlinks href=#hl-51-4>4</a>
</span><span class=lnt id=hl-51-5><a class=lnlinks href=#hl-51-5>5</a>
</span><span class=lnt id=hl-51-6><a class=lnlinks href=#hl-51-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>group_demean</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>by</span><span class=p>,</span> <span class=n>cols</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>by</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>cols</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=p>[</span><span class=n>c</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>c</span><span class=p>]</span> <span class=o>-</span> <span class=n>g</span><span class=p>[</span><span class=n>c</span><span class=p>]</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=s1>&#39;mean&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span></span></span></code></pre></td></tr></table></div></div><p>然后可以写为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-52-1><a class=lnlinks href=#hl-52-1>1</a>
</span><span class=lnt id=hl-52-2><a class=lnlinks href=#hl-52-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=o>.</span><span class=n>col1</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=n>pipe</span><span class=p>(</span><span class=n>group_demean</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;key1&#39;</span><span class=p>,</span> <span class=s1>&#39;key2&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;col1&#39;</span><span class=p>]))</span></span></span></code></pre></td></tr></table></div></div><h2 id=124-总结>12.4 总结
<a class=header-anchor href=#124-%e6%80%bb%e7%bb%93></a></h2><p>和其它许多开源项目一样，pandas仍然在不断的变化和进步中。和本书中其它地方一样，这里的重点是放在接下来几年不会发生什么改变且稳定的功能。</p><p>为了深入学习pandas的知识，我建议你学习官方文档，并阅读开发团队发布的文档更新。我们还邀请你加入pandas的开发工作：修改bug、创建新功能、完善文档。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/python/>python</a></div><div class=post-share-tools><div class=post-share-loading><i class="fa-solid fa-ellipsis fa-spin"></i></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class=a2a_dd href=https://www.addtoany.com/share></a><a class=a2a_button_wechat></a><a class=a2a_button_qzone></a><a class=a2a_button_sina_weibo></a><a class=a2a_button_douban></a><a class=a2a_button_facebook></a><a class=a2a_button_x></a><a class=a2a_button_email></a><a class=a2a_button_printfriendly></a></div></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="Rich - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="Rich - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
第十二章 Pandas 高级应用</li><li class=post-copyright-author><strong>本文作者： </strong>Rich</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=//localhost:1313/chinese/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch12-pandas%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/ title="第十二章 Pandas 高级应用">//localhost:1313/chinese/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch12-pandas%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/white.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/rss.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/chinese/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch03-python%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%87%BD%E6%95%B0%E5%92%8C%E6%96%87%E4%BB%B6/ rel=next title="第三章 Python 的数据结构、函数和文件"><i class="fa fa-chevron-left"></i> 第三章 Python 的数据结构、函数和文件</a></div><div class="post-nav-prev post-nav-item"><a href=/chinese/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch13-python%E5%BB%BA%E6%A8%A1%E5%BA%93%E4%BB%8B%E7%BB%8D/ rel=prev title="第十三章 Python 建模库介绍">第十三章 Python 建模库介绍
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=i18n-translate class=i18n-translate><i class="fa fa-language"></i><div id=lang-select class=lang-select><div id=lang-selected class=selected-option><span class="flag-icon flag-icon-zh-cn"></span>
<span class=selected-language>简体中文</span>
<i class="fa fa-chevron-down"></i></div><div id=lang-options class=lang-options><div class=lang-option lang-code=zh-cn lang-name=简体中文 lang-url=/chinese/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch12-pandas%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/><span class="flag-icon flag-icon-zh-cn"></span>
<span class=lang-name>简体中文</span></div></div></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rich</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.147.7 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>萌ICP备20250629号</a>
<img src=/imgs/gongan.png alt=萌公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>萌公网安备 31011402009770 号</a></div><div class=custom-footer>Website source code <a href=https://github.com/hugo-next/hugo-theme-next/blob/develop/exampleSite/layouts/partials/custom_footer.html target=_blank>here</a></div></div></footer><script class=next-config data-name=page type=application/json>{"clipboard":{"js":{"alias":"clipboard","file":"dist/clipboard.min.js","name":"clipboard.js","version":"2.0.11"}},"comments":false,"expired":false,"isHome":false,"isPage":true,"path":"ch12-pandas%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8","permalink":"//localhost:1313/chinese/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch12-pandas%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/","title":"第十二章 Pandas 高级应用","toc":true,"waline":{"commentcnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}}}</script><script type=text/javascript src=//localhost:1313/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=//localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"hostname":"//localhost:1313/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":true,"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"slideInRight","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":true},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"//localhost:1313/js/3rd"}},"version":"4.8.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src="/js/main.js?=1750130235" defer></script><script type=text/javascript src="/js/clipboard.js?=1750130236" defer></script></body></html>